<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>From C Source Code to Platform-Independent Executable Jarfile - Using NestedVM to Build JInChI | Depth-First</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="A recent series of articles discussed in some detail the process of compiling source code written in C and C&#43;&#43; to pure Java bytecode with NestedVM. But the full conversion process, starting with source and finishing with an executable jarfile, has to my knowledge never been documented. This article uses the InChI toolkit to illustrate the complete process for converting a real-world C source distribution into a platform-independent, executable jarfile that can be run with any modern Java Virtual Machine (JVM).">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/articles/2007/12/03/from-c-source-code-to-platform-independent-executable-jarfile-using-nestedvm-to-build-jinchi/">
    

    <meta property="og:url" content="http://localhost:1313/articles/2007/12/03/from-c-source-code-to-platform-independent-executable-jarfile-using-nestedvm-to-build-jinchi/">
  <meta property="og:site_name" content="Depth-First">
  <meta property="og:title" content="From C Source Code to Platform-Independent Executable Jarfile - Using NestedVM to Build JInChI">
  <meta property="og:description" content="A recent series of articles discussed in some detail the process of compiling source code written in C and C&#43;&#43; to pure Java bytecode with NestedVM. But the full conversion process, starting with source and finishing with an executable jarfile, has to my knowledge never been documented. This article uses the InChI toolkit to illustrate the complete process for converting a real-world C source distribution into a platform-independent, executable jarfile that can be run with any modern Java Virtual Machine (JVM).">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="articles">
    <meta property="article:published_time" content="2007-12-03T00:00:00+00:00">
    <meta property="article:modified_time" content="2007-12-03T00:00:00+00:00">

  <meta itemprop="name" content="From C Source Code to Platform-Independent Executable Jarfile - Using NestedVM to Build JInChI">
  <meta itemprop="description" content="A recent series of articles discussed in some detail the process of compiling source code written in C and C&#43;&#43; to pure Java bytecode with NestedVM. But the full conversion process, starting with source and finishing with an executable jarfile, has to my knowledge never been documented. This article uses the InChI toolkit to illustrate the complete process for converting a real-world C source distribution into a platform-independent, executable jarfile that can be run with any modern Java Virtual Machine (JVM).">
  <meta itemprop="datePublished" content="2007-12-03T00:00:00+00:00">
  <meta itemprop="dateModified" content="2007-12-03T00:00:00+00:00">
  <meta itemprop="wordCount" content="857">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="From C Source Code to Platform-Independent Executable Jarfile - Using NestedVM to Build JInChI">
  <meta name="twitter:description" content="A recent series of articles discussed in some detail the process of compiling source code written in C and C&#43;&#43; to pure Java bytecode with NestedVM. But the full conversion process, starting with source and finishing with an executable jarfile, has to my knowledge never been documented. This article uses the InChI toolkit to illustrate the complete process for converting a real-world C source distribution into a platform-independent, executable jarfile that can be run with any modern Java Virtual Machine (JVM).">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Depth-First
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Articles
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">From C Source Code to Platform-Independent Executable Jarfile - Using NestedVM to Build JInChI</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2007-12-03T00:00:00Z">December 3, 2007</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>A recent series of articles discussed in some detail the process of compiling source code written in C and C++ to pure Java bytecode with <a href="http://nestedvm.ibex.org/">NestedVM</a>. But the full conversion process, starting with source and finishing with an executable jarfile, has to my knowledge never been documented. This article uses the InChI toolkit to illustrate the complete process for converting a real-world C source distribution into a platform-independent, executable jarfile that can be run with any modern Java Virtual Machine (JVM).</p>
<h1 id="about-inchi">About InChI</h1>
<p>The previous article in this series <a href="/articles/2007/10/31/jinchi-run-inchi-anywhere-java-runs">introduced JInChI</a>, the first and only pure Java implementation of the <a href="http://www.iupac.org/inchi/">IUPAC/NIST InChI toolkit</a>. This toolkit is used to convert molecular connection tables encoded in <a href="http://www.mdli.com/downloads/public/ctfile/ctfile.jsp">MDL&rsquo;s SD File format</a> into ASCII character strings called &lsquo;InChIs&rsquo; that have a <a href="/articles/2007/09/27/inchi-for-newbies">variety of applications in the field of cheminformatics</a>. Although an excellent <a href="/articles/2007/10/10/jruby-for-cheminformatics-reading-and-writing-inchis-via-the-java-native-interface">JNI-InChI</a> interface is available, JNI won&rsquo;t be a viable option in every situation. Our pure Java implementation nicely complements the JNI-InChI library.</p>
<p>In this tutorial, we&rsquo;ll build version 1.0.2b of the InChI toolkit. This version, among other features, supports the generation of <a href="/articles/2007/05/09/hashing-inchis">InChI Keys</a>.</p>
<h1 id="prerequisites">Prerequisites</h1>
<p>This article assumes you&rsquo;ve already <a href="http://wiki.brianweb.net/NestedVM/QuickStartGuide">installed NestedVM</a> on your system. Building NestedVM required the installation of many dependencies and was a fairly lengthy, but straightforward, process on my Linux system.</p>
<h1 id="step-1-prepare-your-environment">Step 1: Prepare Your Environment</h1>
<p>Before building anything, we&rsquo;ll need to set up our environment. NestedVM makes this simple:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd /your/path/to/nestedvm/
</span></span><span style="display:flex;"><span>source env.sh
</span></span></code></pre></div><p>Next, let&rsquo;s create a directory to hold the various components we&rsquo;ll need during the build process:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd /your/projects/directory
</span></span><span style="display:flex;"><span>mkdir jinchi
</span></span><span style="display:flex;"><span>cd jinchi
</span></span></code></pre></div><p>Next, we&rsquo;ll download and unpack the InChI source distribution:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget http://www.iupac.org/inchi/download/inchi102b.zip
</span></span><span style="display:flex;"><span>unzip inchi102b.zip
</span></span></code></pre></div><h1 id="step-2-cross-compile-inchi">Step 2: Cross-Compile InChI</h1>
<p>We now have everything we need to begin cross-compiling. NestedVM uses a two-part process in which source code is first cross-compiled to a MIPS binary. That MIPS binary is then translated to Java bytecode. We start by invoking <code>make</code> with the appropriate cross-compiler flags (which I found by looking through the InChI <strong>Makefile</strong>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make C_COMPILER<span style="color:#f92672">=</span>mips-unknown-elf-gcc LINKER<span style="color:#f92672">=</span>mips-unknown-elf-gcc
</span></span></code></pre></div><p>This creates a MIPS binary (<code>cInChI-1</code>). Unless you&rsquo;re running on a MIPS machine, this binary won&rsquo;t be executable.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./cInChI-1
</span></span><span style="display:flex;"><span>bash: ./cInChI-1: cannot execute binary file
</span></span></code></pre></div><p>We can now translate the MIPS binary into pure Java bytecode:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>java org.ibex.nestedvm.Compiler -outfile JInChI.class JInChI cInChI-1
</span></span></code></pre></div><p>This produces a Java class file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ll JInChI.class
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> rich rich <span style="color:#ae81ff">4372362</span> Nov <span style="color:#ae81ff">30</span> 08:27 JInChI.class
</span></span></code></pre></div><p>We can verify that the classfile has been compiled correctly by running it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>java JInChI
</span></span><span style="display:flex;"><span>InChI ver 1, Software version 1.02-beta August 2007.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Usage:
</span></span><span style="display:flex;"><span>cInChI-1 inputFile <span style="color:#f92672">[</span>outputFile <span style="color:#f92672">[</span>logFile <span style="color:#f92672">[</span>problemFile<span style="color:#f92672">]]]</span> <span style="color:#f92672">[</span>-option<span style="color:#f92672">[</span> -option...<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Options:
</span></span><span style="display:flex;"><span>  SNon        Exclude stereo <span style="color:#f92672">(</span>Default: Include Absolute stereo<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  SRel        Relative stereo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-- truncated --
</span></span></code></pre></div><p>We have now done something truly remarkable: we&rsquo;ve taken a standard C source code distribution and converted it into an executable Java class file. It runs, but only because the NestedVM runtime is on our classpath (thanks to the <code>source</code> command we used at the beginning of the process).</p>
<p>What we really want is a self-contained, executable jarfile that can be run, unmodified, on any system with Java installed.</p>
<h1 id="step-3-build-the-jinchi-jarfile">Step 3: Build the JInChI Jarfile</h1>
<p>We begin by moving up the the root directory of our jinchi project, creating a new directory to hold our java-specific files (the <strong>JInChI.class</strong> file and the NestedVM runtime), and copying them into it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd ../../..
</span></span><span style="display:flex;"><span>mkdir jinchi-1.0.2b.1
</span></span><span style="display:flex;"><span>mv InChI-1-software-1-02-beta/cInChI/gcc_makefile/JInChI.class jinchi-1.0.2b.1/
</span></span><span style="display:flex;"><span>cp -r /your/path/to/nestedvm/build/org/ jinchi-1.0.2b.1
</span></span></code></pre></div><p>An executable jarfile generally needs a manifest to point to the main execution class. One way to do that is to first create a manifest:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vi jinchi-1.0.2b.1/MANIFEST.MF
</span></span></code></pre></div><p>It&rsquo;s essential that this file end with a newline.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat jinchi-1.0.2b.1/MANIFEST.MF
</span></span><span style="display:flex;"><span>Main-Class: JInChI
</span></span></code></pre></div><p>With everything in place, we can create the jarfile:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd jinchi-1.0.2b.1/
</span></span><span style="display:flex;"><span>ls
</span></span><span style="display:flex;"><span>JInChI.class  MANIFEST.MF  org/
</span></span><span style="display:flex;"><span>jar -cfm jinchi-1.0.2b.1.jar MANIFEST.MF *
</span></span><span style="display:flex;"><span>ls
</span></span><span style="display:flex;"><span>jinchi-1.0.2b.1.jar  JInChI.class  MANIFEST.MF  org/
</span></span></code></pre></div><p>We&rsquo;ve successfully converted standard C source code into a platform independent executable jarfile. But does it work?</p>
<h1 id="step-4-test-jinchi">Step 4: Test JInChI</h1>
<p>We can confirm that the process has worked by running the jarfile (you should do this in a new shell session to verify that the jarfile is indeed independent of your NestedVM installation).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>java -jar jinchi-1.0.2b.1.jar
</span></span><span style="display:flex;"><span>InChI ver 1, Software version 1.02-beta August 2007.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Usage:
</span></span><span style="display:flex;"><span>cInChI-1 inputFile <span style="color:#f92672">[</span>outputFile <span style="color:#f92672">[</span>logFile <span style="color:#f92672">[</span>problemFile<span style="color:#f92672">]]]</span> <span style="color:#f92672">[</span>-option<span style="color:#f92672">[</span> -option...<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Options:
</span></span><span style="display:flex;"><span>  SNon        Exclude stereo <span style="color:#f92672">(</span>Default: Include Absolute stereo<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  SRel        Relative stereo
</span></span></code></pre></div><p>That&rsquo;s all there is to it! Your shiny new jarfile can be run on any system with a JVM installed. The one created here has been successfully tested on Mac OS X, Linux, and Windows.</p>
<p>If you&rsquo;d prefer to download the JInChI jarfile, it can be obtained <a href="http://sourceforge.net/project/showfiles.php?group_id=142870&amp;package_id=250448&amp;release_id=558625">from SourceForge</a>.</p>
<h1 id="conclusions">Conclusions</h1>
<p>This article has illustrated in detail the process of converting a standard C source distribution into a platform-independent executable jarfile. Given the appropriate MIPS cross-compiler (many of which come with the NestedVM distribution), the same process can be repeated with code written in a variety of other languages.</p>
<p>You may be wondering what kind of performance hit you can expect with the approach outlined here. After all, we&rsquo;d be comparing a native binary to something running on top of two abstraction layers: the NestedVM runtime and a JVM. It&rsquo;s not as bad as you might think, but that&rsquo;s a story for another time.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  Depth-First 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
