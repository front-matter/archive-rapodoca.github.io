<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Hacking CiteULike - Metascripting with Ruby and Session | Depth-First</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="CiteULike lets users easily manage their bibliographies of scholarly works, and in the process discover other users&rsquo; papers on related subjects. One of the most powerful features of CiteULike is its ability to convert arbitrary URLs into fully-formatted bibliographical citations. CiteULike manages to do this while largely avoiding the Buggotea Problem in which multiple URLs pointing to the same work are saved. Wouldn&rsquo;t it be useful if this aspect of CiteULike could be independently scripted, tested, and re-integrated? This article describes how to do this using the powerful scripting language Ruby.">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    
      <meta name="author" content = "Richard L. Apodaca">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/articles/2007/06/22/hacking-citeulike-metascripting-with-ruby-and-session/">
    

    <meta property="og:url" content="http://localhost:1313/articles/2007/06/22/hacking-citeulike-metascripting-with-ruby-and-session/">
  <meta property="og:site_name" content="Depth-First">
  <meta property="og:title" content="Hacking CiteULike - Metascripting with Ruby and Session">
  <meta property="og:description" content="CiteULike lets users easily manage their bibliographies of scholarly works, and in the process discover other users’ papers on related subjects. One of the most powerful features of CiteULike is its ability to convert arbitrary URLs into fully-formatted bibliographical citations. CiteULike manages to do this while largely avoiding the Buggotea Problem in which multiple URLs pointing to the same work are saved. Wouldn’t it be useful if this aspect of CiteULike could be independently scripted, tested, and re-integrated? This article describes how to do this using the powerful scripting language Ruby.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2007-06-22T00:00:00+00:00">
    <meta property="article:modified_time" content="2007-06-22T00:00:00+00:00">

  <meta itemprop="name" content="Hacking CiteULike - Metascripting with Ruby and Session">
  <meta itemprop="description" content="CiteULike lets users easily manage their bibliographies of scholarly works, and in the process discover other users’ papers on related subjects. One of the most powerful features of CiteULike is its ability to convert arbitrary URLs into fully-formatted bibliographical citations. CiteULike manages to do this while largely avoiding the Buggotea Problem in which multiple URLs pointing to the same work are saved. Wouldn’t it be useful if this aspect of CiteULike could be independently scripted, tested, and re-integrated? This article describes how to do this using the powerful scripting language Ruby.">
  <meta itemprop="datePublished" content="2007-06-22T00:00:00+00:00">
  <meta itemprop="dateModified" content="2007-06-22T00:00:00+00:00">
  <meta itemprop="wordCount" content="803">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Hacking CiteULike - Metascripting with Ruby and Session">
  <meta name="twitter:description" content="CiteULike lets users easily manage their bibliographies of scholarly works, and in the process discover other users’ papers on related subjects. One of the most powerful features of CiteULike is its ability to convert arbitrary URLs into fully-formatted bibliographical citations. CiteULike manages to do this while largely avoiding the Buggotea Problem in which multiple URLs pointing to the same work are saved. Wouldn’t it be useful if this aspect of CiteULike could be independently scripted, tested, and re-integrated? This article describes how to do this using the powerful scripting language Ruby.">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Depth-First
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Hacking CiteULike - Metascripting with Ruby and Session</h1>
      
      <p class="tracked">
        By <strong>Richard L. Apodaca</strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2007-06-22T00:00:00Z">June 22, 2007</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p><a href="http://www.citeulike.org/">CiteULike</a> lets users easily manage their bibliographies of scholarly works, and in the process discover other users&rsquo; papers on related subjects. One of the most powerful features of CiteULike is its ability to convert arbitrary URLs into fully-formatted bibliographical citations. CiteULike manages to do this while largely avoiding the <a href="http://depth-first.com/articles/2007/06/15/buggotea-the-problem-with-abundance">Buggotea Problem</a> in which multiple URLs pointing to the same work are saved. Wouldn&rsquo;t it be useful if this aspect of CiteULike could be independently scripted, tested, and re-integrated? This article describes how to do this using the powerful scripting language Ruby.</p>
<h1 id="a-simple-test">A Simple Test</h1>
<p>The core of CiteULike&rsquo;s bibliography lookup system is contained in its <em>Filters</em>. Filters accept a URL they&rsquo;re interested in and return a bibliographical citation. Each filter generally works with a specific publisher&rsquo;s URLs and may be written in just about any scripting language.</p>
<p>CiteULike has released nearly all of its filters and the driver as an Open Source package distributed under a BSD-style license.
Complete documentation on using and writing filters is available <a href="http://svn.citeulike.org/svn/plugins/HOWTO.txt">here</a>, and the package can be obtained through subversion:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>svn co http://svn.citeulike.org/svn/ citeulike
</span></span></code></pre></div><p>After changing into the <strong>citeulike/drivers</strong> directory, you&rsquo;ll see a file called <strong>driver.tcl</strong>. This script coordinates the activities of the various filters contained under their respective language subdirectories. Let&rsquo;s say you want to parse the following URL:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>http://pubs.acs.org/cgi-bin/abstract.cgi/jmcmar/2007/50/i05/abs/jm0611509.html
</span></span></code></pre></div><p>The command to do so would be:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./driver.tcl parse http://pubs.acs.org/cgi-bin/abstract.cgi/jcisd8/2006/46/i03/abs/ci050400b.html
</span></span></code></pre></div><p>If you get an error starting with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>couldn<span style="color:#960050;background-color:#1e0010">&#39;</span>t execute <span style="color:#e6db74">&#34;./acs.py&#34;</span>: no such file or directory
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> executing
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;open &#34;</span>|./<span style="color:#f92672">[</span>file tail $exe<span style="color:#f92672">]</span><span style="color:#e6db74">&#34; &#34;</span>r+<span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">(</span>procedure <span style="color:#e6db74">&#34;parse_url&#34;</span> line 31<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    invoked from within
</span></span></code></pre></div><p>then the problem lies with the shebang line of the <strong>drivers/python/acs.py</strong> script. For example, on my system I need to change the shebang to:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/python2.5
</span></span></span></code></pre></div><p>Making this change and re-running the driver script gives the output I was expecting:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>parsing http://pubs.acs.org/cgi-bin/abstract.cgi/jcisd8/2006/46/i03/abs/ci050400b.html
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>serial -&gt; 1549-9596
</span></span><span style="display:flex;"><span>volume -&gt; <span style="color:#ae81ff">46</span>
</span></span><span style="display:flex;"><span>linkouts -&gt; <span style="color:#f92672">{</span>DOI <span style="color:#f92672">{}</span> 10.1021/ci050400b <span style="color:#f92672">{}</span> <span style="color:#f92672">{}}</span>
</span></span><span style="display:flex;"><span>year -&gt; <span style="color:#ae81ff">2006</span>
</span></span><span style="display:flex;"><span>type -&gt; JOUR
</span></span><span style="display:flex;"><span>start_page -&gt; <span style="color:#ae81ff">991</span>
</span></span><span style="display:flex;"><span>url -&gt; http://pubs3.acs.org/acs/journals/doilookup?in_doi<span style="color:#f92672">=</span>10.1021/ci050400b
</span></span><span style="display:flex;"><span>end_page -&gt; <span style="color:#ae81ff">998</span>
</span></span><span style="display:flex;"><span>plugin_version -&gt; <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>doi -&gt; 10.1021/ci050400b
</span></span><span style="display:flex;"><span>day -&gt; <span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span>issue -&gt; <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>title -&gt; The Blue Obelisk-Interoperability in Chemical Informatics
</span></span><span style="display:flex;"><span>journal -&gt; J. Chem. Inf. Model.
</span></span><span style="display:flex;"><span>abstract -&gt; Abstract: The Blue Obelisk Movement <span style="color:#f92672">(</span>http://www.blueobelisk.org/<span style="color:#f92672">)</span> is the name used by a diverse Internet group promoting reusable chemistry via open source software development, consistent and complimentary chemoinformatics research, open data, and open standards. We outline recent examples of cooperation in the Blue Obelisk group: a shared dictionary of algorithms and implementations in chemoinformatics algorithms drawing from our various software projects; a shared repository of chemoinformatics data including elemental properties, atomic radii, isotopes, atom typing rules, and so forth; and Web services <span style="color:#66d9ef">for</span> the platform-independent use of chemoinformatics programs.
</span></span><span style="display:flex;"><span>status -&gt; ok
</span></span><span style="display:flex;"><span>month -&gt; <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>authors -&gt; <span style="color:#f92672">{</span>Guha <span style="color:#f92672">{}</span> R <span style="color:#f92672">{</span>Guha, R.<span style="color:#f92672">}}</span> <span style="color:#f92672">{</span>Howard <span style="color:#f92672">{}</span> MT <span style="color:#f92672">{</span>Howard, M.T.<span style="color:#f92672">}}</span> <span style="color:#f92672">{</span>Hutchison <span style="color:#f92672">{}</span> GR <span style="color:#f92672">{</span>Hutchison, G.R.<span style="color:#f92672">}}</span> <span style="color:#f92672">{</span>Murray-Rust <span style="color:#f92672">{}</span> P <span style="color:#f92672">{</span>Murray-Rust, P.<span style="color:#f92672">}}</span> <span style="color:#f92672">{</span>Rzepa <span style="color:#f92672">{}</span> H <span style="color:#f92672">{</span>Rzepa, H.<span style="color:#f92672">}}</span> <span style="color:#f92672">{</span>Steinbeck <span style="color:#f92672">{}</span> C <span style="color:#f92672">{</span>Steinbeck, C.<span style="color:#f92672">}}</span> <span style="color:#f92672">{</span>Wegner <span style="color:#f92672">{}</span> J <span style="color:#f92672">{</span>Wegner, J.<span style="color:#f92672">}}</span> <span style="color:#f92672">{</span>Willighagen <span style="color:#f92672">{}</span> EL <span style="color:#f92672">{</span>Willighagen, E.L.<span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>address -&gt; Pennsylvania State University, University Park, Pennsylvania 16804-3000, Jmol Project, U. S. A., Cornell University, Ithaca, New York 14853, Cambridge University, Cambridge CB2 1TN, Great Britain, Imperial College, London SW7 2AZ, Great Britain, Cologne University Bioinformatics Center <span style="color:#f92672">(</span>CUBIC<span style="color:#f92672">)</span>, Zülpicher Str. 47, D-50674 Köln, Germany, University of Tübingen, Tübingen, Germany, and Jmol project, The Netherlands
</span></span><span style="display:flex;"><span>plugin -&gt; acs
</span></span></code></pre></div><h1 id="metascripting-with-ruby-and-session">Metascripting with Ruby and Session</h1>
<p>The CiteULike driver is written in <a href="http://tcl.sourceforge.net/">Tcl</a>, a language I&rsquo;ve been interested in and heard about, but which I just don&rsquo;t have the time to try to learn. Wouldn&rsquo;t it be great if we could direct the activities of the CiteULike driver from the comfort and power of Ruby?</p>
<p>It turns out that a handy little Ruby library exists which is perfect for the metascripting we&rsquo;ll need to do - <a href="http://raa.ruby-lang.org/project/session/">Session</a>. The Session library can be installed with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gem install session
</span></span></code></pre></div><p>Once installed, we can fire up interactive ruby (irb), and tell driver.tcl what to do:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>irb
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:001:0&gt; require <span style="color:#e6db74">&#39;rubygems&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; true
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:002:0&gt; require <span style="color:#e6db74">&#39;session&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; true
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:003:0&gt; url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://pubs.acs.org/cgi-bin/abstract.cgi/jcisd8/2006/46/i03/abs/ci050400b.html&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;http://pubs.acs.org/cgi-bin/abstract.cgi/jcisd8/2006/46/i03/abs/ci050400b.html&#34;</span>
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:004:0&gt; session <span style="color:#f92672">=</span> Session.new
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; <span style="color:#75715e">#&lt;Session::Sh:0xb7c03174 @stdout=#&lt;IO:0xb7c02ee0&gt;, @threads=[], @history=nil, @stdin=#&lt;IO:0xb7c02f30&gt;, @use_open3=nil, @opts={}, @errproc=nil, @use_spawn=nil, @debug=nil, @stderr=#&lt;IO:0xb7c02e7c&gt;, @outproc=nil, @track_history=nil, @prog=&#34;sh&#34;&gt;</span>
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:005:0&gt; result<span style="color:#f92672">=</span>session.execute <span style="color:#e6db74">&#34;./driver.tcl parse #{url}&#34;</span>
</span></span></code></pre></div><h1 id="reprocessing-the-bibliography">Reprocessing the Bibliography</h1>
<p>The last command of our interactive ruby session returns an Array called &ldquo;result&rdquo;, the first element of which is our article&rsquo;s bibliographical information. We can extract its title with the following commands:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:011:0&gt; result<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>.match /title -&gt; <span style="color:#f92672">(</span>.*<span style="color:#f92672">)</span>/
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; <span style="color:#75715e">#&lt;MatchData:0xb7b94828&gt;</span>
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:012:0&gt; $1
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;The Blue Obelisk-Interoperability in Chemical Informatics&#34;</span>
</span></span></code></pre></div><p>Using a series of similar regular expressions, we can re-construct the full bibliographical citation for the paper.</p>
<h1 id="conclusions">Conclusions</h1>
<p>The availability of the CiteULike filters and driver opens up many possibilities to build collaborative bibliographical management applications. By using some simple metascripting techniques, this can be done in any scripting language. Our little example here is but a glimpse of what might be possible.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  Depth-First 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
