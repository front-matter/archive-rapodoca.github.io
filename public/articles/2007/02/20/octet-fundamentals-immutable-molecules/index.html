<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Octet Fundamentals - Immutable Molecules | Depth-First</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="
The Immutable pattern increases the robustness of objects that share references to the same object and reduces the overhead of concurrent access to an object. It accomplishes this by forbidding any of an object&rsquo;s state information to change after the object is constructed. The Immutable pattern also avoids the need to synchronize multiple threads of execution that share an object.
Mark Grand">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    
      <meta name="author" content = "Richard L. Apodaca">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/articles/2007/02/20/octet-fundamentals-immutable-molecules/">
    

    <meta property="og:url" content="http://localhost:1313/articles/2007/02/20/octet-fundamentals-immutable-molecules/">
  <meta property="og:site_name" content="Depth-First">
  <meta property="og:title" content="Octet Fundamentals - Immutable Molecules">
  <meta property="og:description" content="The Immutable pattern increases the robustness of objects that share references to the same object and reduces the overhead of concurrent access to an object. It accomplishes this by forbidding any of an object’s state information to change after the object is constructed. The Immutable pattern also avoids the need to synchronize multiple threads of execution that share an object.
Mark Grand">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2007-02-20T00:00:00+00:00">
    <meta property="article:modified_time" content="2007-02-20T00:00:00+00:00">

  <meta itemprop="name" content="Octet Fundamentals - Immutable Molecules">
  <meta itemprop="description" content="The Immutable pattern increases the robustness of objects that share references to the same object and reduces the overhead of concurrent access to an object. It accomplishes this by forbidding any of an object’s state information to change after the object is constructed. The Immutable pattern also avoids the need to synchronize multiple threads of execution that share an object.
Mark Grand">
  <meta itemprop="datePublished" content="2007-02-20T00:00:00+00:00">
  <meta itemprop="dateModified" content="2007-02-20T00:00:00+00:00">
  <meta itemprop="wordCount" content="704">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Octet Fundamentals - Immutable Molecules">
  <meta name="twitter:description" content="The Immutable pattern increases the robustness of objects that share references to the same object and reduces the overhead of concurrent access to an object. It accomplishes this by forbidding any of an object’s state information to change after the object is constructed. The Immutable pattern also avoids the need to synchronize multiple threads of execution that share an object.
Mark Grand">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Depth-First
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Octet Fundamentals - Immutable Molecules</h1>
      
      <p class="tracked">
        By <strong>Richard L. Apodaca</strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2007-02-20T00:00:00Z">February 20, 2007</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><blockquote>
<p>The Immutable pattern increases the robustness of objects that share references to the same object and reduces the overhead of concurrent access to an object. It accomplishes this by forbidding any of an object&rsquo;s state information to change after the object is constructed. The Immutable pattern also avoids the need to synchronize multiple threads of execution that share an object.</p>
<p><!-- raw HTML omitted --><a href="http://www.amazon.com/gp/product/0471258393?ie=UTF8&amp;tag=depthfirst-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0471258393">Mark Grand</a><!-- raw HTML omitted --></p>
</blockquote>
<p>Peruse the <a href="http://depth-first.com/doc/octet/index.html">Octet API Documentation</a> and you may find something surprising about the <a href="http://depth-first.com/doc/octet/net/sf/octet/model/Molecule.html">Molecule</a> interface: it lacks mutator methods. Given that mutators enable the state of an object to change, how can a Molecule ever be created in the first place? Why would anyone even need immutable Molecules?</p>
<h1 id="mutable-molecules-are-unnecessary">Mutable Molecules are Unnecessary</h1>
<p>Most cheminformatics tools permit the unfettered modification of molecules after their creation. Octet takes a completely different approach. The Molecule contract says that the state of every Molecule will remain constant over its lifetime. Octet then backs up this promise by deliberately defining only accessor methods in the Molecule interface.</p>
<p>Perhaps the best reason for an immutable Molecule interface is that there are vanishingly few situations in which a Molecule needs to be changed after it&rsquo;s created. The creative use of Design Patterns obviates 80-90% of the perceived need for Molecule mutability.</p>
<h1 id="the-virtues-of-immutability">The Virtues of Immutability</h1>
<p>When clients <em>know</em> that a Molecule can never be changed, programming becomes a lot easier and less bug-prone. For example, consider that when a Molecule is immutable:</p>
<ul>
<li>defensive copying of Molecules is unnecessary;</li>
<li>a mechanism that reports changes to internal Molecule state (listeners) is unnecessary;</li>
<li>memory leaks resulting from failure to disconnect a Molecule listener are eliminated;</li>
<li>the <!-- raw HTML omitted -->clone<!-- raw HTML omitted --> method, and all of its complexities, are unnecessary;</li>
<li>no special precautions need to be taken to achieve robust, thread-safe code;</li>
<li>Molecules can safely be used as keys in <!-- raw HTML omitted -->Hashtables<!-- raw HTML omitted -->;</li>
<li>the Molecule API is greatly simplified because all mutators have been removed.</li>
</ul>
<p>Octet fully embraces the productivity gains made possible by immutable Molecules. In fact, many of Octet&rsquo;s key interfaces are immutable for precisely the reasons cited above.</p>
<h1 id="how-to-build-immutable-molecules">How to Build Immutable Molecules</h1>
<p>Immutable Molecules may be a good idea, but how can they get created in the first place? After all, there are no methods such as <!-- raw HTML omitted -->addAtom<!-- raw HTML omitted --> though which a Molecule can be built up!</p>
<p>Java inner classes and the <a href="http://c2.com/cgi/wiki?BuilderPattern">Builder Pattern</a> provide one solution to this problem. Consider the following Java snippet, which is adapted from the Octet source code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BasicMoleculeBuilder</span> <span style="color:#66d9ef">implements</span> MoleculeBuilder
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> MoleculeImpl molecule;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">BasicMoleculeBuilder</span>(){
</span></span><span style="display:flex;"><span>    molecule <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MoleculeImpl();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// implement the rest</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addAtom</span>(IsotopicDistribution distribution){
</span></span><span style="display:flex;"><span>    AtomImpl atom <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> AtomImpl(distribution);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// changing the molecule!</span>
</span></span><span style="display:flex;"><span>    molecule.<span style="color:#a6e22e">atoms</span>.<span style="color:#a6e22e">add</span>(atom);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> Molecule <span style="color:#a6e22e">releaseMolecule</span>(){
</span></span><span style="display:flex;"><span>    Molecule result <span style="color:#f92672">=</span> molecule;
</span></span><span style="display:flex;"><span>    molecule <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MoleculeImpl();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> result;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// implement the remaining MoleculeBuilder methods</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MoleculeImpl</span> <span style="color:#66d9ef">implements</span> Molecule  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> List atoms;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">MoleculeImpl</span>(){
</span></span><span style="display:flex;"><span>      atoms <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// implement the remaining Molecule methods</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AtomImpl</span> <span style="color:#66d9ef">implements</span> Atom{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> IsotopicDistribution dist;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">AtomImpl</span>(IsotopicDistribution dist){
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">dist</span> <span style="color:#f92672">=</span> dist;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// implement the remaining Atom methods</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Notice that the <!-- raw HTML omitted -->addAtom<!-- raw HTML omitted --> method changes the state of the Molecule under construction. Strictly speaking, this does violate immutability. In practice, it makes no difference because the changes occur only in the context of <!-- raw HTML omitted -->BasicMoleculeBuilder<!-- raw HTML omitted -->, which keeps these changes from propagating to the outside world. Once a client invokes <!-- raw HTML omitted -->releaseMolecule<!-- raw HTML omitted -->, <!-- raw HTML omitted -->BasicMoleculeBuilder<!-- raw HTML omitted --> loses all contact with the <!-- raw HTML omitted -->Molecule<!-- raw HTML omitted --> it created, and so is incapable of further modification.</p>
<p>Although it may not be immediately apparent, Alan Holub&rsquo;s <a href="http://www.javaworld.com/javaworld/jw-07-1999/jw-07-toolbox.html">brilliant series of articles</a> in <a href="http://javaworld.com">JavaWorld</a> on user interface design are directly applicable here. If you&rsquo;ve never been exposed to rigorous object-oriented design, Holub&rsquo;s claims can seem rather bizarre (&ldquo;get and set functions are evil&rdquo;). But if you stick with it, you&rsquo;ll be rewarded with a valuable new appreciation for object-oriented programming in Java.</p>
<p>Although a discussion of the role of the Builder Pattern in the above code is beyond the scope of this article, look to future installments of the &ldquo;Octet Fundamentals&rdquo; series for more details.</p>
<h1 id="conclusions">Conclusions</h1>
<p>Molecule immutability is a core Octet principle that results in cleaner, simpler, and more robust client code. Situations that might appear to require the ability to edit Molecules can usually be handled through the creative application of Design Patterns.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  Depth-First 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
