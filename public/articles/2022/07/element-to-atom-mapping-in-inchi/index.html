<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Element-to-Atom Mapping in InChI | Depth-First</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Toward lossless encoding and decoding for new applications.">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/articles/2022/07/element-to-atom-mapping-in-inchi/">
    

    <meta property="og:url" content="http://localhost:1313/articles/2022/07/element-to-atom-mapping-in-inchi/">
  <meta property="og:site_name" content="Depth-First">
  <meta property="og:title" content="Element-to-Atom Mapping in InChI">
  <meta property="og:description" content="Toward lossless encoding and decoding for new applications.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="articles">
    <meta property="article:published_time" content="2022-07-27T17:00:00+00:00">
    <meta property="article:modified_time" content="2022-07-27T17:00:00+00:00">

  <meta itemprop="name" content="Element-to-Atom Mapping in InChI">
  <meta itemprop="description" content="Toward lossless encoding and decoding for new applications.">
  <meta itemprop="datePublished" content="2022-07-27T17:00:00+00:00">
  <meta itemprop="dateModified" content="2022-07-27T17:00:00+00:00">
  <meta itemprop="wordCount" content="1255">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Element-to-Atom Mapping in InChI">
  <meta name="twitter:description" content="Toward lossless encoding and decoding for new applications.">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Depth-First
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Articles
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Element-to-Atom Mapping in InChI</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2022-07-27T17:00:00Z">July 27, 2022</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p><a href="https://www.inchi-trust.org">InChI</a> is a molecular identifier developed by IUPAC. A <a href="/articles/2021/03/10/parsing-inchi-its-complicated/">previous article</a> discussed the possibility of using InChI as something else: a molecular serialization format. Rather than treating InChI strings as mere hash keys, what if InChI could be used to encode and decode molecular structures in the same way as the SMILES or CTfile formats? Doing so requires a way to map elements to their respective atoms. This article describes a way to do that.</p>
<h1 id="inchi-as-a-molecular-serialization-format">InChI as a Molecular Serialization Format</h1>
<p>The InChI team has maintained a nuanced stance on the use InChI outside of molecular identification. On the one hand they characterize InChI as just an identifier and not a serialization format. Back in 2014 Steve Heller, co-creator of InChI, <a href="http://www.hellers.com/steve/pub-talks/toronto-7-14.pdf">noted</a>:</p>
<blockquote>
<p>InChI is not a replacement for any existing internal structure representations. (We do not start religious wars. ) InChI is in ADDITION to what one uses internally. Its value to student or scientist is in FINDING and LINKING information.</p>
</blockquote>
<p>This sentiment was re-iterated in a <a href="https://doi.org/10.1186/s13321-015-0068-4">2015 publication</a> which warned &ldquo;InChI is not a file format (the conversion structure - &gt; InChI - &gt; structure can, in a few cases, provide undesirable results).&rdquo;</p>
<p>At the same time, the InChI Technical Manual devotes multiple sections to documenting the internal structure of InChI strings: Section III; Section IV; Appendix 2; and Appendix 3. The latter includes instructions for parsing InChI strings and extracting information from their layers.</p>
<p>Although never documented through a <a href="/articles/2020/12/21/smiles-formal-grammar-revisited/">formal grammar</a>, InChI strings follow a well-defined syntax. Can this syntax be read, and if so what information might be extracted? The answer to that question depends on a method to map elements to atoms.</p>
<h1 id="mapping-elements">Mapping Elements</h1>
<p>Tucked away in a <a href="https://doi.org/10.1186/s13321-015-0068-4">2015 design paper</a> from the InChI team is the following very useful information:</p>
<blockquote>
<p>Note that the canonical atomic numbers, which are used throughout the InChI, are always given in the formula’s element order. For example, “/C10H16N5O13P3” (the beginning of InChI for adenosine triphosphate) implies that atoms numbered 1–10 are carbons, 11–15 are nitrogens, 16–28 are oxygens, and 29–31 are phosporus [sic]. Hydrogen atoms are not explicitly numbered.</p>
</blockquote>
<p>In other words, elements are assigned to atoms by combining Hill Formula order with atomic indexing. The connections (<code>/c</code>) layer defines a graph whose labels are one-based atomic indexes. To map an element with a given atomic index, begin by creating an array of one-indexed element symbols. Populate this array by reading the Hill Formula from left to right, ignoring hydrogens. Add the appropriate multiple of each element to the array. For example, ATP has a formula layer (<code>/</code>) of &ldquo;C10H16N5O13P3.&rdquo; The element array therefore contains the following items:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">C</span>, <span style="color:#a6e22e">C</span>, <span style="color:#a6e22e">C</span>, <span style="color:#a6e22e">C</span>, <span style="color:#a6e22e">C</span>, <span style="color:#a6e22e">C</span>, <span style="color:#a6e22e">C</span>, <span style="color:#a6e22e">C</span>, <span style="color:#a6e22e">C</span>, <span style="color:#a6e22e">C</span>,          <span style="color:#75715e">// 1-10
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">N</span>, <span style="color:#a6e22e">N</span>, <span style="color:#a6e22e">N</span>, <span style="color:#a6e22e">N</span>, <span style="color:#a6e22e">N</span>,                         <span style="color:#75715e">// 11-15
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">O</span>, <span style="color:#a6e22e">O</span>, <span style="color:#a6e22e">O</span>, <span style="color:#a6e22e">O</span>, <span style="color:#a6e22e">O</span>, <span style="color:#a6e22e">O</span>, <span style="color:#a6e22e">O</span>, <span style="color:#a6e22e">O</span>, <span style="color:#a6e22e">O</span>, <span style="color:#a6e22e">O</span>, <span style="color:#a6e22e">O</span>, <span style="color:#a6e22e">O</span>, <span style="color:#a6e22e">O</span>, <span style="color:#75715e">// 16-28
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">P</span>, <span style="color:#a6e22e">P</span>, <span style="color:#a6e22e">P</span>                                <span style="color:#75715e">// 29-31
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>]
</span></span></code></pre></div><p>Given a random one-based atom index such as 20, the associated element is found by fetching the array element at index 20, which is oxygen (&ldquo;O&rdquo;). Figure 2 of the paper illustrates this point for the case of ATP:</p>
<!-- raw HTML omitted -->
<p>The <a href="https://www.inchi-trust.org/download/104/InChI_TechMan.pdf">InChI Technical Manual</a> contains additional chemical structures with InChI atomic indexes, all of which are consistent with this assignment procedure.</p>
<!-- raw HTML omitted -->
<p>This procedure is also consistent with <a href="articles/2006/08/12/inchi-canonicalization-algorithm/">the InChI canonicalization algorithm</a>, which is revised in the design paper.</p>
<h1 id="applications">Applications</h1>
<p>The reliable construction of a representation that produced an InChI string opens up new applications for the identifier. Every other layer defines its properties in terms of the indexes given in the connection layer. Being able to assign element symbols means that every relevant atomic property can be accounted for.</p>
<p>In other words, it should be possible to go from InChI string to InChI data structure and back to InChI string losslessly.</p>
<p>To what end? At various times over the years, InChI has been used for purposes that don&rsquo;t fit squarely within molecular identification. Examples include:</p>
<ul>
<li>Progressive search. The <a href="https://dx.doi.org/10.1186/s13321-014-0043-5">UniChem</a> team disassembled InChI strings to enable progressive compound search that selectively ignored stereochemistry, salt form, or isotopic identity in structure search.</li>
<li>Similarity search. A team used <a href="http://psb.stanford.edu/psb-online/proceedings/psb07/rhodes.pdf">InChI strings to construct feature vectors</a>, which formed the basis of a similarity search engine.</li>
<li>Tautomer enumeration.  A team in Freiburg based a <a href="https://dx.doi.org/10.1021/ci1001179">tautomer enumeration algorithm on InChI</a>.</li>
<li>Stereoisomer identification. The InChI configuration layer (<code>/m</code>) was used to <a href="https://doi.org/10.1107/S0108768109053610">identify racemates present in the CCD</a>.</li>
</ul>
<p>In an application more closely aligned with molecular identification, Noel O&rsquo;Boyle developed a stereochemistry-aware SMILES canonicalization protocol <a href="https://doi.org/10.1186/1758-2946-4-22">based on output from InChI software</a>.</p>
<p>InChIs are often associated with an alternative representation such as SMILES or Molfile — but not always. If an InChI string is the only molecular encoding, then a decoder would be an essential component of a text mining system.</p>
<p>Then there&rsquo;s InChI&rsquo;s rather useful ability express molecular structure without introducing mesomer or tautomer artifacts. Applications as diverse as machine learning and chemical registration could benefit.</p>
<p>All of these applications have a common requirement to transform InChI strings into intermediate data structures for further processing. Simpler tasks such as stereoisomer identification can be accomplished with simple string-based data structures. More complex tasks such as tautomer enumeration require something more flexible and precise. A utility for interconverting InChI strings and their corresponding high-fidelity data structures could lead to additional non-identifier applications for InChI.</p>
<h1 id="an-inchi-parsing-algorithm">An InChI Parsing Algorithm</h1>
<p>Given the assignment of atomic labels through the formula layer, an algorithm for parsing InChI strings could be summarized as follows:</p>
<ol>
<li>Use the connectivity layer (<code>/c</code>) to build a graph labeled with integer indexes.</li>
<li>Assign atom labels to the nodes on the graph based on the formula layer (<code>/</code>).</li>
<li>Assign fixed/mobile hydrogens based on the fixed hydrogens (<code>/h</code>) layer.</li>
<li>Assign stereo and reconnection attributes based on the respective layers.</li>
</ol>
<p>Key to this algorithm would be a data structure capable of lossless and flexible representation. Ideally, such data structures would discourage or prevent the creation of invalid states.</p>
<h1 id="caveats">Caveats</h1>
<p>InChI uses a form of molecular representation unlike others in common use such as SMILES or CTfile. In particular, InChI supports tautomerism as a first-class phenomenon through it&rsquo;s &ldquo;mobile hydrogen&rdquo; concept. This support has wide-ranging consequences for representation. Additionally, InChI has no concept of bond order. And charges are not associated with a particular atom but rather the molecule as a whole.</p>
<p>Provided that the data structures used for molecular representation take these differences into account, InChI strings could be read and written without loss. However, <em>translation</em> of an InChI representation into another molecular representation runs the risk of mismatch. But this problem is hardly unique to InChI. CTfile V3000 supports <a href="/articles/2022/02/09/v3000-molfile-enhanced-stereochemistry-representation/">enhanced stereochemistry</a>, for example, whereas CTfile V2000 does not. Attempting to translate V3000 molfile to V2000 therefore risks data loss in the same way that translation from InChI does.</p>
<p>Some of these representational differences can be handled in a straightforward way. For example, bond orders can be assigned in the same way that &ldquo;aromatic&rdquo; SMILES strings can be kekulized — via <a href="/articles/2021/06/30/writing-aromatic-smiles/">matching</a>. Mobile hydrogens can be handled in a similar way. Like kekulization, this generates a single isomer, which may or may not be the desired effect. An <a href="https://sourceforge.net/p/inchi/mailman/message/1619721/">old email thread</a> offers additional insights into the InChI translation problem.</p>
<h1 id="conclusion">Conclusion</h1>
<p>The InChI format can be read and written just like other molecular serialization formats. A key factor is the semantic relationship between formula and connectivity layers, which makes element-to-atom mapping possible. This relationship would play a key role in a system capable of lossless interconversion of bare InChI strings and complex data structures. New applications for InChI might then become feasible.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  Depth-First 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
