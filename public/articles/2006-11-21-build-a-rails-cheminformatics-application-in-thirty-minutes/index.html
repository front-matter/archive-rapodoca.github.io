<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Build a Rails Cheminformatics Application in Thirty Minutes | Depth-First</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="A recent article highlighted the Web as a new cheminformatics platform. Advocacy is one thing, but a working, open, demo built with modern technologies is far more compelling. In the following tutorial we&rsquo;ll build a first-generation cheminformatics Web application using the Ruby on Rails framework and 100% Open Source components. We&rsquo;ll just cover the essentials here - look for future articles to discuss the underlying technology in more detail.">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    
      <meta name="author" content = "Richard L. Apodaca">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="https://depth-first.com:1313/articles/2006-11-21-build-a-rails-cheminformatics-application-in-thirty-minutes/">
    

    <meta property="og:url" content="https://depth-first.com:1313/articles/2006-11-21-build-a-rails-cheminformatics-application-in-thirty-minutes/">
  <meta property="og:site_name" content="Depth-First">
  <meta property="og:title" content="Build a Rails Cheminformatics Application in Thirty Minutes">
  <meta property="og:description" content="A recent article highlighted the Web as a new cheminformatics platform. Advocacy is one thing, but a working, open, demo built with modern technologies is far more compelling. In the following tutorial we’ll build a first-generation cheminformatics Web application using the Ruby on Rails framework and 100% Open Source components. We’ll just cover the essentials here - look for future articles to discuss the underlying technology in more detail.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="articles">
    <meta property="article:published_time" content="2006-11-21T00:00:00+00:00">
    <meta property="article:modified_time" content="2006-11-21T00:00:00+00:00">

  <meta itemprop="name" content="Build a Rails Cheminformatics Application in Thirty Minutes">
  <meta itemprop="description" content="A recent article highlighted the Web as a new cheminformatics platform. Advocacy is one thing, but a working, open, demo built with modern technologies is far more compelling. In the following tutorial we’ll build a first-generation cheminformatics Web application using the Ruby on Rails framework and 100% Open Source components. We’ll just cover the essentials here - look for future articles to discuss the underlying technology in more detail.">
  <meta itemprop="datePublished" content="2006-11-21T00:00:00+00:00">
  <meta itemprop="dateModified" content="2006-11-21T00:00:00+00:00">
  <meta itemprop="wordCount" content="1604">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Build a Rails Cheminformatics Application in Thirty Minutes">
  <meta name="twitter:description" content="A recent article highlighted the Web as a new cheminformatics platform. Advocacy is one thing, but a working, open, demo built with modern technologies is far more compelling. In the following tutorial we’ll build a first-generation cheminformatics Web application using the Ruby on Rails framework and 100% Open Source components. We’ll just cover the essentials here - look for future articles to discuss the underlying technology in more detail.">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Depth-First
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Articles
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Build a Rails Cheminformatics Application in Thirty Minutes</h1>
      
      <p class="tracked">
        By <strong>Richard L. Apodaca</strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2006-11-21T00:00:00Z">November 21, 2006</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>A <!-- raw HTML omitted -->recent article<!-- raw HTML omitted --> highlighted the Web as a new cheminformatics platform. Advocacy is one thing, but a working, open, demo built with modern technologies is far more compelling. In the following tutorial we&rsquo;ll build a first-generation cheminformatics Web application using the <!-- raw HTML omitted -->Ruby on Rails<!-- raw HTML omitted --> framework and 100% Open Source components. We&rsquo;ll just cover the essentials here - look for future articles to discuss the underlying technology in more detail.</p>
<h1 id="the-problem">The Problem</h1>
<p><!-- raw HTML omitted -->Simplified Molecular Input Line Entry System<!-- raw HTML omitted --> (SMILES) is one of the most compact and easy-to-learn molecular representation systems ever developed. Part of a larger family of molecular languages called <!-- raw HTML omitted -->line notations<!-- raw HTML omitted -->, SMILES strings are always written as a single line of ASCII text. This makes them perfect in situations calling for data entry; witness their use in a wide range of new free <!-- raw HTML omitted -->online chemistry databases<!-- raw HTML omitted -->. This system typically works by a chemist drawing a structure in a graphical editor, copying a SMILES string from the editor, and pasting this string into a search window in the database application.</p>
<p>SMILES is a great language for computers, but not for chemists, who are trained to communicate through 2-D structure diagrams. Although SMILES strings can be decoded manually, this is a tedious and error-prone process, especially for SMILES encoding high degrees of branching and ring content. It&rsquo;s preferable for the computer to do this hard work for us, providing a perfectly laid-out 2-D structure diagram for use in debugging or inclusion in documents.</p>
<p><!-- raw HTML omitted -->Depict<!-- raw HTML omitted --> is a Web application originally developed by <!-- raw HTML omitted -->Daylight<!-- raw HTML omitted --> for the conversion of SMILES strings into 2-D structure diagrams. Type a SMILES string into the form, press enter, and get a raster image of the encoded molecule. Daylight&rsquo;s Depict does a good enough job, but you can&rsquo;t change the interface or output. You also can&rsquo;t take the software apart to see how it works. Wouldn&rsquo;t it be great if you could?</p>
<h1 id="about-this-tutorial-series">About This Tutorial Series</h1>
<p>This tutorial is the first in a series describing how to build a Depict server using 100% <!-- raw HTML omitted -->Open Source<!-- raw HTML omitted --> components. The application will accept a SMILES string in a Webpage text field, and then produce a 2-D structure diagram. It won&rsquo;t be designed for ease of use, appearance, or configurability - these improvements will be described in subsequent articles. When this application is finished, I&rsquo;ll deploy it on a Web server. At every step in this process, I&rsquo;ll provide enough detail for anyone to do the same.</p>
<p>It won&rsquo;t be necessary to finish every step yourself before you can work with the finished product. Near the beginning of each installment will be be a &ldquo;Download and Prerequisites&rdquo; section containing a link to the complete source code. Simply download this code and run it to see what it does.</p>
<h1 id="download-and-prerequisites">Download and Prerequisites</h1>
<p>For this tutorial, you&rsquo;ll need <!-- raw HTML omitted -->Ruby CDK<!-- raw HTML omitted --> (RCDK). A recent article described the small amount of system configuration required for <!-- raw HTML omitted -->RCDK on Linux<!-- raw HTML omitted -->. Another article showed how to install <!-- raw HTML omitted -->RCDK on Windows<!-- raw HTML omitted -->.</p>
<p>In addition, you&rsquo;ll need to install <!-- raw HTML omitted -->Ruby on Rails<!-- raw HTML omitted --> - something that can be done through <!-- raw HTML omitted -->RubyGems<!-- raw HTML omitted -->.</p>
<p>The complete Depict application can be <a href="/images/posts/20061121/depict.tar.gz">downloaded from this link</a>.</p>
<h1 id="a-note-on-ruby-java-bridge-and-amd64-linux-platforms">A Note on Ruby Java Bridge and AMD64 Linux Platforms</h1>
<p>Our Depict application will use <!-- raw HTML omitted -->Ruby Java Bridge<!-- raw HTML omitted --> (RJB) as a Ruby interface to Java bytecode. Recently, <!-- raw HTML omitted -->a problem with RJB on AMD64-Linux<!-- raw HTML omitted --> was uncovered. This problem prevents third-party jarfiles from being loaded after Rails has been loaded.</p>
<p>In practice, this means that the command to start the Rails server (Step 2) needs to be prefixed with an assignment of <!-- raw HTML omitted -->LD_PRELOAD<!-- raw HTML omitted -->. You also need to make <!-- raw HTML omitted -->LD_LIBRARY_PATH<!-- raw HTML omitted --> point to your native Java libraries. On my platform, which is AMD64-Linux running Sun&rsquo;s JVM, the commands are:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>export LD_LIBRARY_PATH<span style="color:#f92672">=</span>/usr/java/jdk1.5.0_09/jre/lib/amd64:/usr/java/jdk1.5.0_09/jre/lib/amd64/server
</span></span><span style="display:flex;"><span>LD_PRELOAD<span style="color:#f92672">=</span>/usr/java/jdk1.5.0_09/jre/lib/amd64/libzip.so ruby script/server
</span></span></code></pre></div><p>If you get an &ldquo;Internal Error&rdquo; due to an &ldquo;unknown exception&rdquo; while running Depict, chances are good that you&rsquo;ve hit the same problem. Starting the Rails server as above should resolve it.</p>
<h1 id="step-1-create-the-application">Step 1: Create the Application</h1>
<p>Getting started with Rails is as simple as issuing the <!-- raw HTML omitted -->rails<!-- raw HTML omitted --> command with the name of your application as an argument:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>rails depict
</span></span></code></pre></div><p>Executing this command creates a complete Rails application template under the <!-- raw HTML omitted -->depict<!-- raw HTML omitted --> subdirectory in your working directory. You build your application by editing the files and directories that were generated.</p>
<h1 id="step-2-start-the-server">Step 2: Start the Server</h1>
<p>You can start the Depict application by running the included server script:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ cd depict
</span></span><span style="display:flex;"><span>$ ruby script/server
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; Booting WEBrick...
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; Rails application started on http://0.0.0.0:3000
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; Ctrl-C to shutdown server; call with --help <span style="color:#66d9ef">for</span> options
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2006-11-18 10:17:08<span style="color:#f92672">]</span> INFO  WEBrick 1.3.1
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2006-11-18 10:17:08<span style="color:#f92672">]</span> INFO  ruby 1.8.5 <span style="color:#f92672">(</span>2006-08-25<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>x86_64-linux-gnu<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2006-11-18 10:17:08<span style="color:#f92672">]</span> INFO  WEBrick::HTTPServer#start: pid<span style="color:#f92672">=</span><span style="color:#ae81ff">4036</span> port<span style="color:#f92672">=</span><span style="color:#ae81ff">3000</span>
</span></span></code></pre></div><p>Let&rsquo;s see what Depict looks like so far. Point your browser to <!-- raw HTML omitted -->http://localhost:3000<!-- raw HTML omitted -->. You should see the following page:</p>
<p><img src="/images/posts/20061122/step_2.png" alt="Step 2" title="Step 2"></p>
<p>Congratulations! You&rsquo;re now running Ruby on Rails.</p>
<h1 id="step-3-create-the-smilescontroller">Step 3: Create the SmilesController</h1>
<p>Rails adapts the Model-View-Controller application paradigm to the Web. It also automates many of the steps in building models, views, and controllers. Let&rsquo;s create a controller to handle the manipulation of SMILES strings:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ruby script/generate controller Smiles
</span></span><span style="display:flex;"><span>    exists  app/controllers/
</span></span><span style="display:flex;"><span>    exists  app/helpers/
</span></span><span style="display:flex;"><span>    create  app/views/smiles
</span></span><span style="display:flex;"><span>    exists  test/functional/
</span></span><span style="display:flex;"><span>    create  app/controllers/smiles_controller.rb
</span></span><span style="display:flex;"><span>    create  test/functional/smiles_controller_test.rb
</span></span><span style="display:flex;"><span>    create  app/helpers/smiles_helper.rb
</span></span></code></pre></div><p>Currently, <!-- raw HTML omitted -->SmilesController<!-- raw HTML omitted --> is just a skeleton:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SmilesController</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">ApplicationController</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>Let&rsquo;s give <!-- raw HTML omitted -->SmilesController<!-- raw HTML omitted --> the ability to accept a SMILES string as input by adding an <!-- raw HTML omitted -->input<!-- raw HTML omitted --> method.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SmilesController</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">ApplicationController</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">input</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><h1 id="step-4-create-a-form">Step 4: Create a Form</h1>
<p>At this stage, pointing your browser to <!-- raw HTML omitted -->http://localhost:3000/smiles/input<!-- raw HTML omitted --> gives a screen containing an error message:</p>
<p><img src="/images/posts/20061122/step_4_1.png" alt="Step 4.1" title="Step 4.1"></p>
<p>Rails is looking for view that doesn&rsquo;t exist, so let&rsquo;s create one. To your <!-- raw HTML omitted -->depict/app/views/smiles<!-- raw HTML omitted --> directory, add the following file, called <!-- raw HTML omitted -->input.rhtml<!-- raw HTML omitted -->:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Enter a SMILES String&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">&lt;</span>%= form_tag :action=&gt;&#39;depict&#39; %&gt;
</span></span><span style="display:flex;"><span>      Enter a SMILES String: &lt;<span style="color:#f92672">br</span> /&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">&lt;</span>%= text_field(&#39;smiles&#39;, &#39;value&#39;) %&gt;&lt;<span style="color:#f92672">br</span> /&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">&lt;</span>%= end_form_tag %&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>This HTML view is an example of Ruby&rsquo;s templating mechanism, eRuby, which was discussed earlier in the context of <!-- raw HTML omitted -->converting SD files to HTML<!-- raw HTML omitted -->. In the template above, we&rsquo;ve configured our form to invoke an action called <!-- raw HTML omitted -->depict<!-- raw HTML omitted --> when submitted. This action does not yet exist, but will be created in Step 5 below.</p>
<p>Now, pointing your browser to <!-- raw HTML omitted -->http://localhost:3000/smiles/input<!-- raw HTML omitted --> should give an input field:</p>
<p><img src="/images/posts/20061122/step_4_2.png" alt="Step 4.2" title="Step 42."></p>
<p>Let&rsquo;s try it. Submitting the SMILES string for benzene gives the following error screen:</p>
<p><img src="/images/posts/20061122/step_4_3.png" alt="Step 4.3" title="Step 4.3"></p>
<p>We haven&rsquo;t defined the <!-- raw HTML omitted -->depict<!-- raw HTML omitted --> action yet, a fact that Rails is communicating with this error message.</p>
<p>Have you noticed how we haven&rsquo;t had to restart the Rails Web server as we&rsquo;ve made changes? This is but one of the many conveniences that makes Rails such a productive platform.</p>
<h1 id="step-5-add-a-depict-action">Step 5: Add a Depict Action</h1>
<p>We need a way to pass a SMILES string from the Web page text field in which it&rsquo;s entered to our application and back to another view. To do this we&rsquo;ll add a <!-- raw HTML omitted -->depict<!-- raw HTML omitted --> method to <!-- raw HTML omitted -->depict/app/controllers/smiles_controller.rb<!-- raw HTML omitted -->:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">depict</span>
</span></span><span style="display:flex;"><span>  @smiles <span style="color:#f92672">=</span> @params<span style="color:#f92672">[</span><span style="color:#e6db74">:smiles</span><span style="color:#f92672">][</span><span style="color:#e6db74">:value</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>Of course, our application still won&rsquo;t run properly because we haven&rsquo;t created a view for the new <!-- raw HTML omitted -->depict<!-- raw HTML omitted --> method to use. Let&rsquo;s do this by adding the following file, named <!-- raw HTML omitted -->depict.rb<!-- raw HTML omitted --> to the <!-- raw HTML omitted -->depict/app/views/smiles<!-- raw HTML omitted --> directory:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Depict SMILES: <span style="color:#960050;background-color:#1e0010">&lt;</span>%= @smiles %&gt;&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h1</span>&gt;SMILES: <span style="color:#960050;background-color:#1e0010">&lt;</span>%= @smiles %&gt;&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>Notice how the instance variable <!-- raw HTML omitted -->@smiles<!-- raw HTML omitted --> is available for use within the template.</p>
<p>Let&rsquo;s have a look at Depict so far. Pointing your browser to <!-- raw HTML omitted -->http://localhost:3000/smiles/input<!-- raw HTML omitted -->, entering the SMILES string for benzene, and pressing return produces the page show below:</p>
<p><img src="/images/posts/20061122/step_5_1.png" alt="Step 5.1" title="Step 5.1"></p>
<p>So far, so good. We&rsquo;ve been able to read user input from an HTML form and reprocess it into some simple HTML output. Now, lets render a 2-D molecular image to go with it.</p>
<h1 id="step-6-generate-the-2-d-image">Step 6: Generate the 2-D Image</h1>
<p>We&rsquo;ll use a method called <!-- raw HTML omitted -->image_for<!-- raw HTML omitted -->, which we&rsquo;ll define shortly. The file <!-- raw HTML omitted -->depict/app/views/smiles/depict<!-- raw HTML omitted --> should look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Depict SMILES: <span style="color:#960050;background-color:#1e0010">&lt;</span>%= @smiles %&gt;&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h1</span>&gt;SMILES:<span style="color:#960050;background-color:#1e0010">&lt;</span>%= @smiles %&gt;&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">img</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&lt;%= url_for :action =&gt; &#34;</span><span style="color:#a6e22e">image_for</span><span style="color:#960050;background-color:#1e0010">&#34;,</span> <span style="color:#a6e22e">:smiles </span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">&gt; </span><span style="color:#e6db74">@smiles</span> <span style="color:#960050;background-color:#1e0010">%</span>&gt;&#34;&gt;&lt;/<span style="color:#f92672">img</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>The added <!-- raw HTML omitted -->img<!-- raw HTML omitted --> tag is a placeholder for now. It loads an image dynamically generated from the <!-- raw HTML omitted -->image_for<!-- raw HTML omitted --> method, which we&rsquo;ll shortly add to <!-- raw HTML omitted -->SmilesController<!-- raw HTML omitted -->. We pass the SMILES string as a parameter.</p>
<p>The <!-- raw HTML omitted -->image_for<!-- raw HTML omitted --> method does all of the real work in the Depict application. It accepts a SMILES string as a parameter, and produces a laid-out 2-D color molecular image as output. The method uses a variety of functionality contained in the Java API itself, and in Ruby CDK.</p>
<p>In addition to an <!-- raw HTML omitted -->image_for<!-- raw HTML omitted --> method, we&rsquo;ll need to add some accessory code to make it work. Edit <!-- raw HTML omitted -->depict/app/controllers/smiles_controller.rb<!-- raw HTML omitted --> so that it looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#75715e"># Load the RCDK library</span>
</span></span><span style="display:flex;"><span>require_gem <span style="color:#e6db74">&#39;rcdk&#39;</span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;rcdk/util&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># New jrequire calls.</span>
</span></span><span style="display:flex;"><span>jrequire <span style="color:#e6db74">&#39;java.io.ByteArrayOutputStream&#39;</span>
</span></span><span style="display:flex;"><span>jrequire <span style="color:#e6db74">&#39;net.sf.structure.cdk.util.ImageKit&#39;</span>
</span></span><span style="display:flex;"><span>jrequire <span style="color:#e6db74">&#39;javax.imageio.ImageIO&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SmilesController</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">ApplicationController</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Already defined.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">input</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Already defined.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">depict</span>
</span></span><span style="display:flex;"><span>    @smiles <span style="color:#f92672">=</span> @params<span style="color:#f92672">[</span><span style="color:#e6db74">:smiles</span><span style="color:#f92672">][</span><span style="color:#e6db74">:value</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># New method.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">image_for</span>
</span></span><span style="display:flex;"><span>    smiles <span style="color:#f92672">=</span> @params<span style="color:#f92672">[</span><span style="color:#e6db74">:smiles</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    mol <span style="color:#f92672">=</span> <span style="color:#66d9ef">RCDK</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Util</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Lang</span><span style="color:#f92672">.</span>read_smiles smiles
</span></span><span style="display:flex;"><span>    mol <span style="color:#f92672">=</span> <span style="color:#66d9ef">RCDK</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Util</span><span style="color:#f92672">::</span><span style="color:#66d9ef">XY</span><span style="color:#f92672">::</span>coordinate_molecule mol
</span></span><span style="display:flex;"><span>    out<span style="color:#f92672">=</span><span style="color:#66d9ef">Java</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Io</span><span style="color:#f92672">::</span><span style="color:#66d9ef">ByteArrayOutputStream</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>    image<span style="color:#f92672">=</span><span style="color:#66d9ef">Net</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Sf</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Structure</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Cdk</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Util</span><span style="color:#f92672">::</span><span style="color:#66d9ef">ImageKit</span><span style="color:#f92672">.</span>createRenderedImage(mol, <span style="color:#ae81ff">300</span>, <span style="color:#ae81ff">300</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Javax</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Imageio</span><span style="color:#f92672">::</span><span style="color:#66d9ef">ImageIO</span><span style="color:#f92672">.</span>write(image, <span style="color:#e6db74">&#34;png&#34;</span>, out)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    send_data(out<span style="color:#f92672">.</span>toByteArray, <span style="color:#e6db74">:type</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;image/png&#34;</span>, <span style="color:#e6db74">:disposition</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;inline&#34;</span>, <span style="color:#e6db74">:filename</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;molecule.png&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>Let&rsquo;s test the application with a real-world example. The achiral SMILES string for <!-- raw HTML omitted -->Carmine<!-- raw HTML omitted --> is:</p>
<p><code>CC1=C2C(=CC(=C1C(=O)O)O)C(=O)C3=C(C2=O)C(=C(C(=C3O)O)C4C(C(C(C(O4)CO)O)O)O)O</code></p>
<p>Pointing your browser to <!-- raw HTML omitted -->http://localhost:3000/smiles/input<!-- raw HTML omitted --> and entering the above SMILES string produces a color 2-D image of the structure of the red food coloring:</p>
<p><img src="/images/posts/20061122/step_6_1.png" alt="Step 6.1" title="Step 6.1"></p>
<h1 id="conclusions">Conclusions</h1>
<p>Ruby on Rails is a fun and agile framework for rapid Web development. Although Depict isn&rsquo;t much to look at yet, it demonstrates many key Rails concepts. Several techniques could be used improve the application&rsquo;s look and usability. For example, we could use <!-- raw HTML omitted -->AJAX<!-- raw HTML omitted --> to depict SMILES strings as they are being typed - without the need to hit return. We could also provide options for changing image format, size, and color scheme. Future articles will describe these and other improvements.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://depth-first.com:1313/" >
    &copy;  Depth-First 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
