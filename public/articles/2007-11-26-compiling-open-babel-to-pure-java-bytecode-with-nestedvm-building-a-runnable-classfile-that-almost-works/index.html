<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Compiling Open Babel to Pure Java Bytecode with NestedVM - Building A Runnable Classfile that Almost Works | Depth-First</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Previously, I described an unsuccessful first attempt to compile the popular cheminformatics C/C&#43;&#43; library Open Babel to pure Java bytecode using NestedVM. This article follows that topic one step further, and shows how to obtain a runnable Java classfile. Although major functionality is missing, the principle of compiling arbitrary C/C&#43;&#43; code to both Java source code and Java bytecode is illustrated.
Getting Started
This articles assumes that you&rsquo;ve installed NestedVM and downloaded Open Babel on your system. You&rsquo;ll then need to set up your environment (from the nestedvm installation directory):">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/articles/2007-11-26-compiling-open-babel-to-pure-java-bytecode-with-nestedvm-building-a-runnable-classfile-that-almost-works/">
    

    <meta property="og:url" content="http://localhost:1313/articles/2007-11-26-compiling-open-babel-to-pure-java-bytecode-with-nestedvm-building-a-runnable-classfile-that-almost-works/">
  <meta property="og:site_name" content="Depth-First">
  <meta property="og:title" content="Compiling Open Babel to Pure Java Bytecode with NestedVM - Building A Runnable Classfile that Almost Works">
  <meta property="og:description" content="Previously, I described an unsuccessful first attempt to compile the popular cheminformatics C/C&#43;&#43; library Open Babel to pure Java bytecode using NestedVM. This article follows that topic one step further, and shows how to obtain a runnable Java classfile. Although major functionality is missing, the principle of compiling arbitrary C/C&#43;&#43; code to both Java source code and Java bytecode is illustrated.
Getting Started This articles assumes that you’ve installed NestedVM and downloaded Open Babel on your system. You’ll then need to set up your environment (from the nestedvm installation directory):">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="articles">
    <meta property="article:published_time" content="2007-11-26T00:00:00+00:00">
    <meta property="article:modified_time" content="2007-11-26T00:00:00+00:00">

  <meta itemprop="name" content="Compiling Open Babel to Pure Java Bytecode with NestedVM - Building A Runnable Classfile that Almost Works">
  <meta itemprop="description" content="Previously, I described an unsuccessful first attempt to compile the popular cheminformatics C/C&#43;&#43; library Open Babel to pure Java bytecode using NestedVM. This article follows that topic one step further, and shows how to obtain a runnable Java classfile. Although major functionality is missing, the principle of compiling arbitrary C/C&#43;&#43; code to both Java source code and Java bytecode is illustrated.
Getting Started This articles assumes that you’ve installed NestedVM and downloaded Open Babel on your system. You’ll then need to set up your environment (from the nestedvm installation directory):">
  <meta itemprop="datePublished" content="2007-11-26T00:00:00+00:00">
  <meta itemprop="dateModified" content="2007-11-26T00:00:00+00:00">
  <meta itemprop="wordCount" content="532">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Compiling Open Babel to Pure Java Bytecode with NestedVM - Building A Runnable Classfile that Almost Works">
  <meta name="twitter:description" content="Previously, I described an unsuccessful first attempt to compile the popular cheminformatics C/C&#43;&#43; library Open Babel to pure Java bytecode using NestedVM. This article follows that topic one step further, and shows how to obtain a runnable Java classfile. Although major functionality is missing, the principle of compiling arbitrary C/C&#43;&#43; code to both Java source code and Java bytecode is illustrated.
Getting Started This articles assumes that you’ve installed NestedVM and downloaded Open Babel on your system. You’ll then need to set up your environment (from the nestedvm installation directory):">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Depth-First
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Articles
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Compiling Open Babel to Pure Java Bytecode with NestedVM - Building A Runnable Classfile that Almost Works</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2007-11-26T00:00:00Z">November 26, 2007</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>Previously, I described an <a href="/articles/2007/11/19/compiling-open-babel-to-pure-java-bytecode-with-nestedvm-an-unsuccessful-first-attempt#comment-268">unsuccessful first attempt</a> to compile the popular cheminformatics C/C++ library <a href="http://openbabel.sf.net">Open Babel</a> to pure Java bytecode using <a href="http://nestedvm.ibex.org/">NestedVM</a>. This article follows that topic one step further, and shows how to obtain a runnable Java classfile. Although major functionality is missing, the principle of compiling arbitrary C/C++ code to both Java source code and Java bytecode is illustrated.</p>
<h1 id="getting-started">Getting Started</h1>
<p>This articles assumes that you&rsquo;ve <a href="/articles/2007/11/19/compiling-open-babel-to-pure-java-bytecode-with-nestedvm-an-unsuccessful-first-attempt#comment-268">installed NestedVM and downloaded Open Babel</a> on your system. You&rsquo;ll then need to set up your environment (from the nestedvm installation directory):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>source env.sh
</span></span></code></pre></div><h1 id="run-the-configure-script">Run the Configure Script</h1>
<p>The configure script we used last time didn&rsquo;t attempt to statically compile the binary utilities in the <strong>tools</strong> directory. This time, we&rsquo;ll add flags to allow this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./configure --disable-dynamic-modules --enable-static<span style="color:#f92672">=</span>yes --enable-shared<span style="color:#f92672">=</span>no --enable-inchi --host<span style="color:#f92672">=</span>mips-unknown-elf
</span></span><span style="display:flex;"><span>make
</span></span></code></pre></div><p><em>Note: leaving out the static compile directives does not produce a fully-functioning classfile either.</em></p>
<p>Next, we&rsquo;ll attempt to directly create the <!-- raw HTML omitted -->babel<!-- raw HTML omitted --> binary in Java classfile format, as we did last time:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd tools
</span></span><span style="display:flex;"><span>java org.ibex.nestedvm.Compiler -outfile Babel.class Babel babel
</span></span><span style="display:flex;"><span>Exception in thread <span style="color:#e6db74">&#34;main&#34;</span> java.lang.IllegalStateException: unresolved phantom target
</span></span><span style="display:flex;"><span>        at org.ibex.classgen.MethodGen.resolveTarget<span style="color:#f92672">(</span>MethodGen.java:555<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at org.ibex.classgen.MethodGen._generateCode<span style="color:#f92672">(</span>MethodGen.java:664<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at org.ibex.classgen.MethodGen.generateCode<span style="color:#f92672">(</span>MethodGen.java:618<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at org.ibex.classgen.MethodGen.dump<span style="color:#f92672">(</span>MethodGen.java:888<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at org.ibex.classgen.ClassFile._dump<span style="color:#f92672">(</span>ClassFile.java:193<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at org.ibex.classgen.ClassFile.dump<span style="color:#f92672">(</span>ClassFile.java:160<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at org.ibex.nestedvm.ClassFileCompiler.__go<span style="color:#f92672">(</span>ClassFileCompiler.java:380<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at org.ibex.nestedvm.ClassFileCompiler._go<span style="color:#f92672">(</span>ClassFileCompiler.java:72<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at org.ibex.nestedvm.Compiler.go<span style="color:#f92672">(</span>Compiler.java:259<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at org.ibex.nestedvm.Compiler.main<span style="color:#f92672">(</span>Compiler.java:183<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>We&rsquo;re getting the same error as before. Although, an <a href="http://groups.google.com/group/nestedvm/browse_thread/thread/b5d114a20a6b672b">announcement of a bugfix</a> was posted to the NestedVM list, in my hands the new version of NestedVM caused the same error.</p>
<p>As a workaround, we can compile to Java sourcecode first:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>java org.ibex.nestedvm.Compiler -outformat java -outfile Babel.java Babel babel
</span></span></code></pre></div><p>We now have a Java source file encoding the <strong>babel</strong> program. Does it compile?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>javac Babel.java
</span></span><span style="display:flex;"><span>The system is out of resources.
</span></span><span style="display:flex;"><span>Consult the following stack trace <span style="color:#66d9ef">for</span> details.
</span></span><span style="display:flex;"><span>java.lang.OutOfMemoryError: Java heap space
</span></span><span style="display:flex;"><span>        at com.sun.tools.javac.util.Position$LineMapImpl.build<span style="color:#f92672">(</span>Position.java:139<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at com.sun.tools.javac.util.Position.makeLineMap<span style="color:#f92672">(</span>Position.java:63<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at com.sun.tools.javac.parser.Scanner.getLineMap<span style="color:#f92672">(</span>Scanner.java:1105<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at com.sun.tools.javac.main.JavaCompiler.parse<span style="color:#f92672">(</span>JavaCompiler.java:512<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at com.sun.tools.javac.main.JavaCompiler.parse<span style="color:#f92672">(</span>JavaCompiler.java:550<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at com.sun.tools.javac.main.JavaCompiler.parseFiles<span style="color:#f92672">(</span>JavaCompiler.java:801<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at com.sun.tools.javac.main.JavaCompiler.compile<span style="color:#f92672">(</span>JavaCompiler.java:727<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at com.sun.tools.javac.main.Main.compile<span style="color:#f92672">(</span>Main.java:353<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at com.sun.tools.javac.main.Main.compile<span style="color:#f92672">(</span>Main.java:279<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at com.sun.tools.javac.main.Main.compile<span style="color:#f92672">(</span>Main.java:270<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at com.sun.tools.javac.Main.compile<span style="color:#f92672">(</span>Main.java:69<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at com.sun.tools.javac.Main.main<span style="color:#f92672">(</span>Main.java:54<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Not exactly. But this is a massive source file, so we&rsquo;ll need to increase the Java compiler&rsquo;s memory allowance:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>javac Babel.java -J-Xms256m -J-Xmx256m
</span></span><span style="display:flex;"><span>Note: Babel.java uses unchecked or unsafe operations.
</span></span><span style="display:flex;"><span>Note: Recompile with -Xlint:unchecked <span style="color:#66d9ef">for</span> details.
</span></span></code></pre></div><p>This seems to have worked. Can we run the classfile?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>java Babel -H
</span></span><span style="display:flex;"><span>Open Babel converts chemical structures from one file format to another
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Usage: Babel &amp;lt;input spe&amp;gt; &amp;lt;output spec&amp;gt; <span style="color:#f92672">[</span>Options<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Each spec can be a file whose extension decides the format.
</span></span><span style="display:flex;"><span>Optionally the format can be specified by preceding the file by
</span></span><span style="display:flex;"><span>-i&amp;lt;format-type&amp;gt; e.g. -icml, <span style="color:#66d9ef">for</span> input and -o&lt;format-type&gt; <span style="color:#66d9ef">for</span> output
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>--truncated--
</span></span></code></pre></div><p>Success! But before we get too excited, let&rsquo;s make sure Open Babel&rsquo;s file formats are recognized by testing for &ldquo;SMILES&rdquo;:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>java Babel -Hsmi
</span></span><span style="display:flex;"><span>Format type: smi was not recognized
</span></span></code></pre></div><p>As you can see, we have successfully converted the <!-- raw HTML omitted -->babel<!-- raw HTML omitted --> program to an executable classfile, but this classfile is missing most of the features of the native binary.</p>
<p>This may seem hopeless, but consider that natively compiling Open Babel using the above <!-- raw HTML omitted -->configure<!-- raw HTML omitted --> flags also produces a binary that doesn&rsquo;t know about SMILES or any other format.</p>
<p>So, it&rsquo;s very likely that if we can produce a native, statically compiled, self contained <!-- raw HTML omitted -->babel<!-- raw HTML omitted --> executable, then we will have solved the problem of running Open Babel entirely on a JVM.</p>
<p>This doesn&rsquo;t seem like a difficult problem, <a href="http://sourceforge.net/mailarchive/forum.php?thread_name=819391.60947.qm%40web34201.mail.mud.yahoo.com&amp;forum_name=openbabel-discuss">but apparently it is</a>.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  Depth-First 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
