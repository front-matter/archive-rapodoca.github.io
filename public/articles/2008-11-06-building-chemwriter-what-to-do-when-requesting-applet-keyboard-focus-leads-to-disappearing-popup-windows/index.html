<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Building ChemWriter - What to Do When Requesting Applet Keyboard Focus Leads to Disappearing Popup Windows | Depth-First</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Recently a customer reported a problem in which mousing over an instance of the ChemWriter editor applet caused browser popup windows to disappear behind the parent window. Although many view browser popup windows as bad UI design, there are situations in which no alternative exists. This article describes the window focus problem in detail and outlines one solution.
Background
One of the ways ChemWriter makes chemists more efficient at drawing chemical structures is through the use of keyboard shortcuts. Rather than having to mouse back and forth between a tool palette and drawing canvas to put in atom labels, simply hover the mouse over the atom to label, and press a key on the keyboard. In addition to atom labels, there are keyboard shortcuts for chains (keys 1-9 while hovered over atom), for benzene rings (&ldquo;a&rdquo; key), and to edit bond order (1-3 while hovered over bond). A short movie explains the feature in more detail.">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    
      <meta name="author" content = "Richard L. Apodaca">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="https://depth-first.com:1313/articles/2008-11-06-building-chemwriter-what-to-do-when-requesting-applet-keyboard-focus-leads-to-disappearing-popup-windows/">
    

    <meta property="og:url" content="https://depth-first.com:1313/articles/2008-11-06-building-chemwriter-what-to-do-when-requesting-applet-keyboard-focus-leads-to-disappearing-popup-windows/">
  <meta property="og:site_name" content="Depth-First">
  <meta property="og:title" content="Building ChemWriter - What to Do When Requesting Applet Keyboard Focus Leads to Disappearing Popup Windows">
  <meta property="og:description" content="Recently a customer reported a problem in which mousing over an instance of the ChemWriter editor applet caused browser popup windows to disappear behind the parent window. Although many view browser popup windows as bad UI design, there are situations in which no alternative exists. This article describes the window focus problem in detail and outlines one solution.
Background One of the ways ChemWriter makes chemists more efficient at drawing chemical structures is through the use of keyboard shortcuts. Rather than having to mouse back and forth between a tool palette and drawing canvas to put in atom labels, simply hover the mouse over the atom to label, and press a key on the keyboard. In addition to atom labels, there are keyboard shortcuts for chains (keys 1-9 while hovered over atom), for benzene rings (“a” key), and to edit bond order (1-3 while hovered over bond). A short movie explains the feature in more detail.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="articles">
    <meta property="article:published_time" content="2008-11-06T00:00:00+00:00">
    <meta property="article:modified_time" content="2008-11-06T00:00:00+00:00">

  <meta itemprop="name" content="Building ChemWriter - What to Do When Requesting Applet Keyboard Focus Leads to Disappearing Popup Windows">
  <meta itemprop="description" content="Recently a customer reported a problem in which mousing over an instance of the ChemWriter editor applet caused browser popup windows to disappear behind the parent window. Although many view browser popup windows as bad UI design, there are situations in which no alternative exists. This article describes the window focus problem in detail and outlines one solution.
Background One of the ways ChemWriter makes chemists more efficient at drawing chemical structures is through the use of keyboard shortcuts. Rather than having to mouse back and forth between a tool palette and drawing canvas to put in atom labels, simply hover the mouse over the atom to label, and press a key on the keyboard. In addition to atom labels, there are keyboard shortcuts for chains (keys 1-9 while hovered over atom), for benzene rings (“a” key), and to edit bond order (1-3 while hovered over bond). A short movie explains the feature in more detail.">
  <meta itemprop="datePublished" content="2008-11-06T00:00:00+00:00">
  <meta itemprop="dateModified" content="2008-11-06T00:00:00+00:00">
  <meta itemprop="wordCount" content="616">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Building ChemWriter - What to Do When Requesting Applet Keyboard Focus Leads to Disappearing Popup Windows">
  <meta name="twitter:description" content="Recently a customer reported a problem in which mousing over an instance of the ChemWriter editor applet caused browser popup windows to disappear behind the parent window. Although many view browser popup windows as bad UI design, there are situations in which no alternative exists. This article describes the window focus problem in detail and outlines one solution.
Background One of the ways ChemWriter makes chemists more efficient at drawing chemical structures is through the use of keyboard shortcuts. Rather than having to mouse back and forth between a tool palette and drawing canvas to put in atom labels, simply hover the mouse over the atom to label, and press a key on the keyboard. In addition to atom labels, there are keyboard shortcuts for chains (keys 1-9 while hovered over atom), for benzene rings (“a” key), and to edit bond order (1-3 while hovered over bond). A short movie explains the feature in more detail.">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Depth-First
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Articles
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Building ChemWriter - What to Do When Requesting Applet Keyboard Focus Leads to Disappearing Popup Windows</h1>
      
      <p class="tracked">
        By <strong>Richard L. Apodaca</strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2008-11-06T00:00:00Z">November 6, 2008</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>Recently a customer reported a problem in which mousing over an instance of the <a href="http://metamolecular.com/chemwriter">ChemWriter</a> editor applet caused browser popup windows to disappear behind the parent window. Although many view browser popup windows as bad UI design, there are situations in which no alternative exists. This article describes the window focus problem in detail and outlines one solution.</p>
<h1 id="background">Background</h1>
<p>One of the ways ChemWriter makes chemists more efficient at drawing chemical structures is through the use of <a href="http://metamolecular.com/articles/chemwriter-keyboard">keyboard shortcuts</a>. Rather than having to mouse back and forth between a tool palette and drawing canvas to put in atom labels, simply hover the mouse over the atom to label, and press a key on the keyboard. In addition to atom labels, there are keyboard shortcuts for chains (keys 1-9 while hovered over atom), for benzene rings (&ldquo;a&rdquo; key), and to edit bond order (1-3 while hovered over bond). <a href="http://depth-first.com/articles/2008/06/18/screencast-drawing-structures-quickly-with-chemwriter">A short movie</a> explains the feature in more detail.</p>
<p>Although quite helpful to users, this feature requires some behind-the-scenes magic. Keyboard focus is one of those topics at the boundary between applet and browser for which very little documentation exists and, not surprisingly, one sees the most variation in platform and browser behavior.</p>
<p>The approach ChemWriter takes is to wait for a signal that the mouse cursor has entered the canvas area. When this happens, keyboard focus is requested through <code>Component.requestFocus()</code>.</p>
<h1 id="scope-of-the-problem">Scope of the Problem</h1>
<p>It turns out that on Windows, <code>Component.requestFocus()</code> also causes the hosting window to be pulled to the top of the windows stack, explaining the behavior described above. On Linux and OS X, this doesn&rsquo;t happen, which is the behavior you&rsquo;d expect.</p>
<p>All Windows browsers, except the much maligned Internet Explorer 6, show this behavior. This includes Internet Explorer 7, Firefox 3, and Google Chrome. Internet Explorer 8 beta 2 also shows the behavior, but only once per popup window.</p>
<p>Minimizing, then maximizing the popup window eliminated the problem some of the time. But a new popup window would still show the behavior.</p>
<h1 id="the-solution">The Solution</h1>
<p>The root of the problem is that on Windows, keyboard focus is granted to an object regardless of whether the object&rsquo;s hosting browser window is focused. What&rsquo;s needed, therefore, is a way for the applet to implement a window focus check.</p>
<p>Apparently, nothing in the Applet API itself can solve this problem. The <code>Applet</code>, <code>JApplet</code>, and <code>AppletContext</code> classes only deal with much higher-level considerations.</p>
<p>However, it&rsquo;s possible to take advantage of support for <a href="https://developer.mozilla.org/En/Core_JavaScript_1.5_Guide:LiveConnect_Overview">LiveConnect</a> technology on Windows, which is actually quite good. Using LiveConnect in combination with JavaScript&rsquo;s <code>Document.hasFocus()</code> method offers the makings of a solution. For example, the following code can be used as a starting point within a Java applet to determine if the containing browser window is focused:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>netscape.<span style="color:#a6e22e">javascript</span>.<span style="color:#a6e22e">JSObject</span> <span style="color:#a6e22e">js</span> <span style="color:#f92672">=</span> netscape.<span style="color:#a6e22e">javascript</span>.<span style="color:#a6e22e">JSObject</span>.<span style="color:#a6e22e">getWindow</span>(<span style="color:#66d9ef">this</span>);
</span></span><span style="display:flex;"><span>Object <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">js</span>.eval(<span style="color:#e6db74">&#34;document.hasFocus();&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#e6db74">&#34;true&#34;</span>.<span style="color:#a6e22e">equals</span>(<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">toString</span>()))
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">requestFocusMethod</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Of course, <code>requestFocusMethod()</code> needs to be defined, we need to check for <code>null</code>, and we need to handle exceptions that could arise from a missing <code>netscape.javascript</code> package. You&rsquo;ll also need to ensure that non-windows browsers such as Safari/OS X never even try to execute the LiveConnect code due to a very buggy implementation.</p>
<h1 id="issues">Issues</h1>
<p>I&rsquo;ve seen mixed signals about the status of LiveConnect in the next major release of the Java plugin. Regardless of the specific way it&rsquo;s implemented, it seems safe to say that Java-Javascript communication is far too valuable to abandon. The only question is what form support for this feature will take going forward.</p>
<h1 id="conclusions">Conclusions</h1>
<p>ChemWriter&rsquo;s ability to accept keyboard input is a helpful user interface feature, but one that resulted in window focus issues on Windows. Using LiveConnect in combination with some simple JavaScript in the focus-management code offered an effective solution.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://depth-first.com:1313/" >
    &copy;  Depth-First 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
