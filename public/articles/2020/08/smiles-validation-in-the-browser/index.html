<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>SMILES Validation in the Browser | Depth-First</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="A Project using Rust and WebAssembly.">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/articles/2020/08/smiles-validation-in-the-browser/">
    

    <meta property="og:url" content="http://localhost:1313/articles/2020/08/smiles-validation-in-the-browser/">
  <meta property="og:site_name" content="Depth-First">
  <meta property="og:title" content="SMILES Validation in the Browser">
  <meta property="og:description" content="A Project using Rust and WebAssembly.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="articles">
    <meta property="article:published_time" content="2020-08-24T17:00:00+00:00">
    <meta property="article:modified_time" content="2020-08-24T17:00:00+00:00">

  <meta itemprop="name" content="SMILES Validation in the Browser">
  <meta itemprop="description" content="A Project using Rust and WebAssembly.">
  <meta itemprop="datePublished" content="2020-08-24T17:00:00+00:00">
  <meta itemprop="dateModified" content="2020-08-24T17:00:00+00:00">
  <meta itemprop="wordCount" content="1157">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="SMILES Validation in the Browser">
  <meta name="twitter:description" content="A Project using Rust and WebAssembly.">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Depth-First
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Articles
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">SMILES Validation in the Browser</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2020-08-24T17:00:00Z">August 24, 2020</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>Sometimes Web applications accept molecular input in the form of SMILES strings. For example, a form may allow a list of newline-delimited SMILES to be submitted for processing. Increasingly, users expect realtime validation during these interactions. One option would be an asynchronous HTTP call in which a server validates SMILES strings. But this requires an API to be both available and properly secured. A simpler and more scalable approach would be to validate SMILES in the browser directly. This article describes an open source solution to this problem that takes advantage of a new cheminformatics toolkit and WebAssembly. A <a href="https://github.com/rapodaca/smival">repository</a> containing the source code is available.</p>
<h1 id="alternatives">Alternatives</h1>
<p>My company&rsquo;s chemical structure editor and renderer (<a href="https://chemwriter.com/smiles/">ChemWriter</a>) accepts a SMILES string with the <code>readSMILES</code> function, throwing an error if it is invalid. Within certain limitations, this feature can be used for validation as well. Still, some will prefer an open source option.</p>
<p>It might appear that something like <a href="https://metamolecular.com/smidge/">SMIDGE</a> could work. The main problem is that this and similar tools only validate the <a href="/articles/2020/04/20/smiles-formal-grammar/">grammar</a> of input strings, not the semantics. Features such as <a href="/articles/2020/02/10/a-comprehensive-treatment-of-aromaticity-in-the-smiles-language/">non-kekulizable aromatics</a>, hypervalence, and invalid isotopes are ignored.</p>
<h1 id="smival-project">Smival Project</h1>
<p>What could be helpful is a tool that returns a yes or no answer to the question: &ldquo;is this a valid SMILES, accounting for both syntax and semantics?&rdquo; This functionality is available from the <a href="https://github.com/rapodaca/smival">Smival project</a>.</p>
<h1 id="live-demo">Live Demo</h1>
<p>A <a href="/images/posts/20200824/demo/">live demo</a> is available. Start typing a SMILES into the text input field. As you do, the background alternates between green and red to indicate validity or invalidity, respectively.</p>
<!-- raw HTML omitted -->
<h1 id="high-level-overview">High-Level Overview</h1>
<p>Smival is comprised of three components working together:</p>
<ol>
<li>A WebAssembly (Wasm) file, compiled from Rust source code.</li>
<li>An HTML file containing styles (CSS) and code (JavaScript).</li>
<li>A two-way communication channel using strings (JavaScript to Wasm) and integers (Wasm to JavaScript).</li>
</ol>
<p>On detecting a change to the input field, the JavaScript side allocates memory within the Wasm instance for a string representing the input. After copying the SMILES into the allocated memory, the address is passed to the <code>read</code> function function exposed by the Wasm instance. Using the address, the Wasm instance dereferences the string, reads it as a SMILES using the Rust library <a href="https://github.com/rapodaca/chemcore">ChemCore</a>, then returns one of three integer results: 0 (valid); -1 (invalid); or -2 (internal error). This return value is then used to set the background color of the input field.</p>
<p>For background on the overall approach, these articles may be helpful:</p>
<ul>
<li><a href="/articles/2020/07/07/rust-and-webassembly-from-scratch-hello-world-with-strings/">Rust and WebAssembly from Scratch: Hello World with Strings</a></li>
<li><a href="/articles/2020/06/29/compiling-rust-to-webassembly-a-simple-example/">Compiling Rust to WebAssembly: A Simple Example</a></li>
<li><a href="/articles/2020/01/13/first-steps-in-webassembly-hello-world/">First Steps in WebAssembly: Hello World</a></li>
</ul>
<h1 id="javascripthtmlcss">JavaScript/HTML/CSS</h1>
<p>Two files set up the browser environment: an HTML file and a JavaScript file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span> <span style="color:#a6e22e">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;utf-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Cereus Editor&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">body</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">2</span><span style="color:#66d9ef">em</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">input</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">200</span><span style="color:#66d9ef">%</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">0.1</span><span style="color:#66d9ef">em</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">background-color</span>: <span style="color:#ae81ff">#55ff00</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">invalid</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">background-color</span>: <span style="color:#ae81ff">#ff8888</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h1</span>&gt;Smival&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Enter a SMILES...&#34;</span>&gt;&lt;/<span style="color:#f92672">input</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module&#34;</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./validate.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>The HTML file (listed above) sets up the UI and invokes the <code>validate.js</code> script as an ES6 module. Aside from these two tasks, it&rsquo;s just HTML5 boilerplate.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">path</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/target/wasm32-unknown-unknown/release/smival.wasm&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">read_smiles</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">instance</span> =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">smiles</span> =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">encoder</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TextEncoder</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">encoded</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">encoder</span>.<span style="color:#a6e22e">encode</span>(<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">smiles</span><span style="color:#e6db74">}</span><span style="color:#e6db74">\0`</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">length</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">encoded</span>.<span style="color:#a6e22e">length</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pString</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">instance</span>.<span style="color:#a6e22e">exports</span>.<span style="color:#a6e22e">alloc</span>(<span style="color:#a6e22e">length</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">view</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Uint8Array</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">instance</span>.<span style="color:#a6e22e">exports</span>.<span style="color:#a6e22e">memory</span>.<span style="color:#a6e22e">buffer</span>, <span style="color:#a6e22e">pString</span>, <span style="color:#a6e22e">length</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">view</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">encoded</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">instance</span>.<span style="color:#a6e22e">exports</span>.<span style="color:#a6e22e">read_smiles</span>(<span style="color:#a6e22e">pString</span>);
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">watch</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">instance</span> =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">read</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">read_smiles</span>(<span style="color:#a6e22e">instance</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;input&#39;</span>).<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;input&#39;</span>, <span style="color:#a6e22e">e</span> =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">target</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">read</span>(<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">value</span>) <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#e6db74">&#39;invalid&#39;</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;invalid&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">path</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">bytes</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">arrayBuffer</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wasm</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">WebAssembly</span>.<span style="color:#a6e22e">instantiate</span>(<span style="color:#a6e22e">bytes</span>, { });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">watch</span>(<span style="color:#a6e22e">wasm</span>.<span style="color:#a6e22e">instance</span>);
</span></span><span style="display:flex;"><span>})();
</span></span></code></pre></div><p>The JavaScript file&rsquo;s responsibilities are more involved (<code>validate.js</code>, above). The <a href="https://en.wikipedia.org/wiki/Immediately_invoked_function_expression">IIFE</a> at the bottom kicks the process off by building a Wasm instance from the raw binary. It then watches for changes by invoking the <code>watch</code> function.</p>
<p>When <code>watch</code> detects a change to the text field input, it invokes <code>read_smiles</code>, adding or removing the <code>invalid</code> style to the text input as appropriate.</p>
<p>The <code>read_smiles</code> function serves as the communication channel into Rust/Wasm. The SMILES obtained from the input field is appended with a null byte, then encoded and written to a pre-allocated section of Wasm linear memory.</p>
<h1 id="rust">Rust</h1>
<p>The Rust project is implemented with Cargo, Rust&rsquo;s default package manager and build system. Like most small projects, the Rust source is contained within a single file (<code>lib.rs</code>). Two functions are exposed to the Wasm instance: <code>alloc</code> and <code>read_smiles</code>. <code>alloc</code> allocates memory of the specified length. <code>read_smiles</code> accepts a raw pointer that is de-referenced and passed to ChemCore&rsquo;s <code>daylight::read</code> function. At the same time, the de-referenced SMILES string is automatically dropped using <a href="/articles/2020/01/27/rust-ownership-by-example/">Rust&rsquo;s ownership mechanics</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::os::raw::{ c_void, c_char };
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::ffi::CString;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::mem;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> chemcore::daylight;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#[no_mangle]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">extern</span> <span style="color:#e6db74">&#34;C&#34;</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">alloc</span>(length: <span style="color:#66d9ef">usize</span>) -&gt; <span style="color:#f92672">*</span><span style="color:#66d9ef">mut</span> c_void {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> buf <span style="color:#f92672">=</span> Vec::with_capacity(length);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ptr <span style="color:#f92672">=</span> buf.as_mut_ptr();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    mem::forget(buf);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ptr
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#[no_mangle]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">extern</span> <span style="color:#e6db74">&#34;C&#34;</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">read_smiles</span>(
</span></span><span style="display:flex;"><span>    p_smiles: <span style="color:#f92672">*</span><span style="color:#66d9ef">mut</span> c_char
</span></span><span style="display:flex;"><span>) -&gt; <span style="color:#66d9ef">i8</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> smiles <span style="color:#f92672">=</span> <span style="color:#66d9ef">unsafe</span> {
</span></span><span style="display:flex;"><span>        CString::from_raw(p_smiles)
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">match</span> smiles.into_string() {
</span></span><span style="display:flex;"><span>        Ok(smiles) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">match</span> daylight::read(<span style="color:#f92672">&amp;</span>smiles) {
</span></span><span style="display:flex;"><span>                Ok(_) <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                Err(_) <span style="color:#f92672">=&gt;</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        Err(_) <span style="color:#f92672">=&gt;</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Compilation of <code>lib.rs</code> requires only one other change to the default project. Add a <code>[lib]</code> section to <code>Cargo.toml</code> to indicate that the project will be built as a dynamic library.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span><span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#a6e22e">lib</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">crate-type</span> = [<span style="color:#e6db74">&#34;cdylib&#34;</span>]
</span></span></code></pre></div><p>After this change, the project can be built with the following call to <code>cargo</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>cargo build --target wasm32-unknown-unknown --release
</span></span></code></pre></div><p>It may come as a surprise to find a 1.6 MB Wasm file in the <code>target</code> directory.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>ls -l target/wasm32-unknown-unknown/release/smival.wasm
</span></span><span style="display:flex;"><span>-rwxr-xr-x   2 rich  staff  1687048 Aug 21 16:47 smival.wasm
</span></span></code></pre></div><p>Fortunately, the compile target can be pared down more than tenfold with <a href="https://github.com/alexcrichton/wasm-gc"><code>wasm-gc</code></a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>wasm-gc target/wasm32-unknown-unknown/release/smival.wasm
</span></span><span style="display:flex;"><span>ls -l target/wasm32-unknown-unknown/release/smival.wasm 
</span></span><span style="display:flex;"><span>-rwxr-xr-x  2 rich  staff  110837 Aug 22 09:20 target/wasm32-unknown-unknown/release/smival.wasm
</span></span></code></pre></div><p>The two versions (pre-<code>wasm-gc</code> and post-<code>wasm-gc</code>) can be used interchangeably.</p>
<h1 id="limitations">Limitations</h1>
<p>The biggest limitation of <code>smival</code> is its simple yes/no output. In some applications, it makes sense to inform users of the specific problem to enable correction. Fortunately, this is possible, but at the cost of a more complex <code>lib.rs</code> file. <a href="https://s3.amazonaws.com/temp.michaelfbryan.com/errors/index.html">The (unofficial) Rust FFI Guide</a> offers some good jumping-off points.</p>
<p>A secondary limitation comes from ChemCore. Specifically, the SMILES kekulization algorithm applies a simple greedy procedure, not the full-blown <a href="/articles/2019/04/02/the-maximum-matching-problem/">maximum matching</a> solution called for in the general case. This means that certain multicyclic odd aromatic systems will be perceived as unkekulizable. Fortunately, such structures are rare in organic chemistry. Future updates to ChemCore based on a matching algorithm already used in <a href="https://chemwriter.com/smiles/">ChemWriter</a> will eliminate this limitation.</p>
<h1 id="conclusion">Conclusion</h1>
<p>Realtime client-side SMILES validation can be accomplished with the new software package Smival. Smival is written in Rust using the ChemCore toolkit and compiled to WebAssembly using a standard toolchain. At this stage, Smival only reports whether a SMILES could be read without errors. More sophisticated forms of error reporting are possible with some modification.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  Depth-First 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
