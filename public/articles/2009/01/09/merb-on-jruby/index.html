<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Merb on JRuby | Depth-First</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="My company is developing a commercial cheminformatics Web application with Ruby on Rails. Due to the nature of the problem domain, this application will require interaction with MX, an essential cheminformatics library written in Java.
This article will first explain how and why Merb entered the picture and then explain how to get Merb installed on a clean JRuby-1.1.6 installation.
JRuby on Rails: Express-Service Deployment, but a Trainwreck for Development
The initial approach, JRuby on Rails works amazingly well for deployment (especially using Glassfish and Warbler), but is nothing but heartache for development and testing. My biggest complaints include:">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    
      <meta name="author" content = "Richard L. Apodaca">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/articles/2009/01/09/merb-on-jruby/">
    

    <meta property="og:url" content="http://localhost:1313/articles/2009/01/09/merb-on-jruby/">
  <meta property="og:site_name" content="Depth-First">
  <meta property="og:title" content="Merb on JRuby">
  <meta property="og:description" content="My company is developing a commercial cheminformatics Web application with Ruby on Rails. Due to the nature of the problem domain, this application will require interaction with MX, an essential cheminformatics library written in Java.
This article will first explain how and why Merb entered the picture and then explain how to get Merb installed on a clean JRuby-1.1.6 installation.
JRuby on Rails: Express-Service Deployment, but a Trainwreck for Development The initial approach, JRuby on Rails works amazingly well for deployment (especially using Glassfish and Warbler), but is nothing but heartache for development and testing. My biggest complaints include:">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2009-01-09T00:00:00+00:00">
    <meta property="article:modified_time" content="2009-01-09T00:00:00+00:00">

  <meta itemprop="name" content="Merb on JRuby">
  <meta itemprop="description" content="My company is developing a commercial cheminformatics Web application with Ruby on Rails. Due to the nature of the problem domain, this application will require interaction with MX, an essential cheminformatics library written in Java.
This article will first explain how and why Merb entered the picture and then explain how to get Merb installed on a clean JRuby-1.1.6 installation.
JRuby on Rails: Express-Service Deployment, but a Trainwreck for Development The initial approach, JRuby on Rails works amazingly well for deployment (especially using Glassfish and Warbler), but is nothing but heartache for development and testing. My biggest complaints include:">
  <meta itemprop="datePublished" content="2009-01-09T00:00:00+00:00">
  <meta itemprop="dateModified" content="2009-01-09T00:00:00+00:00">
  <meta itemprop="wordCount" content="757">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Merb on JRuby">
  <meta name="twitter:description" content="My company is developing a commercial cheminformatics Web application with Ruby on Rails. Due to the nature of the problem domain, this application will require interaction with MX, an essential cheminformatics library written in Java.
This article will first explain how and why Merb entered the picture and then explain how to get Merb installed on a clean JRuby-1.1.6 installation.
JRuby on Rails: Express-Service Deployment, but a Trainwreck for Development The initial approach, JRuby on Rails works amazingly well for deployment (especially using Glassfish and Warbler), but is nothing but heartache for development and testing. My biggest complaints include:">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Depth-First
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Merb on JRuby</h1>
      
      <p class="tracked">
        By <strong>Richard L. Apodaca</strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2009-01-09T00:00:00Z">January 9, 2009</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p><a href="http://metamolecular.com/">My company</a> is developing a commercial cheminformatics Web application with Ruby on Rails. Due to the nature of the problem domain, this application will require interaction with <a href="http://code.google.com/p/mx-java">MX</a>, an essential cheminformatics library written in Java.</p>
<p>This article will first explain how and why Merb entered the picture and then explain how to get Merb installed on a clean JRuby-1.1.6 installation.</p>
<h1 id="jruby-on-rails-express-service-deployment-but-a-trainwreck-for-development">JRuby on Rails: Express-Service Deployment, but a Trainwreck for Development</h1>
<p>The initial approach, <a href="http://wiki.jruby.org/wiki/JRuby_on_Rails">JRuby on Rails</a> works amazingly well for deployment (especially using <a href="http://blog.headius.com/2008/08/zero-to-production-in-15-minutes.html">Glassfish and Warbler</a>), but is nothing but heartache for development and testing. My biggest complaints include:</p>
<ul>
<li><strong>Startup time is prohibitively slow.</strong> It typically takes anywhere from 10 to 15 seconds for JRuby and the Rails environment to completely load on my system. This leads to the next point&hellip;</li>
<li><strong>RSpec on JRuby: FAIL</strong> 10-15 seconds startup time may not sound like a big deal, but consider that in <a href="http://dannorth.net/introducing-bdd">Behavior Driven Development</a> with <a href="http://rspec.info/">RSpec</a> you don&rsquo;t even begin writing application code until you first write a failing test, then watch it fail, then write a small bit of code to make the test pass, then write another test, and so on. At every point in this process, you need to wait 10-15 seconds (compared to 1-2 seconds on MRI) for JRuby and Rails to startup up. All of which leads to a lot of waiting around and all of which is anything but Agile.</li>
<li><strong>Autospec on JRuby: FAIL</strong> <a href="http://www.nateclark.com/articles/2008/09/17/_autotest_-is-now-_autospec_-how-to-set-up-autospec-for-rspec-and-rails-with-zentest">Autospec</a> runs in the background, constantly monitoring modifications to your project and automatically running tests. It&rsquo;s a wonderful idea that, that once you&rsquo;ve tried it, will make it very difficult to go back to manually running tests. The problem is that Autospec is broken on JRuby: (1) <a href="http://jira.codehaus.org/browse/JRUBY-3284">rspec only runs by monkeypatching the startup scripts</a> and then dies when the first failing test is run; (2) <a href="http://jira.codehaus.org/browse/JRUBY-3283">spec_server doesn&rsquo;t work</a>.</li>
</ul>
<h1 id="one-solution-encapsulate-java-dependency-in-web-service-with-merb-on-jruby">One Solution: Encapsulate Java Dependency in Web Service with Merb on JRuby</h1>
<p>Given that the interaction with the MX library actually affects very little of the Rails application, one possibility would be to factor out this functionality into a private Web serivice. One way to do that would be with <a href="http://merbivore.com/">Merb</a> on JRuby. At that point, the Rails application could be run under <a href="http://en.wikipedia.org/wiki/Ruby_MRI">MRI</a> for development and testing, and under JRuby for deployment.</p>
<p>For the unfamiliar, Merb is a lightweight, fast, MVC framework for Ruby ideal for building simple, restful Web services.</p>
<h1 id="installing-merb-on-jruby">Installing Merb on JRuby</h1>
<p>Despite reaching the version 1.0 milestone, getting specific information on installing Merb under non-standard platforms like JRuby is not easy. My solution was based on information provided by <a href="http://blogs.sun.com/arungupta/">Arun Gupta</a> in <a href="http://blogs.sun.com/arungupta/entry/totd_53_scaffold_in_merb">a recent article</a>.</p>
<p>Starting with a clean installation of JRuby-1.6, here&rsquo;s what worked for me:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>jruby -S gem install merb-core --no-ri --no-rdoc
</span></span><span style="display:flex;"><span>jruby -S gem install merb-more --no-ri --no-rdoc
</span></span><span style="display:flex;"><span>jruby -S gem install activerecord --no-ri --no-rdoc
</span></span><span style="display:flex;"><span>jruby -S gem install merb_activerecord --no-ri --no-rdoc
</span></span><span style="display:flex;"><span>jruby -S gem install mongrel --no-ri --no-rdoc
</span></span></code></pre></div><p>The problem we need to solve is that trying to install the full Merb metagem itself will complain due to a dependency on DataMapper, which uses native extensions and is not yet available for JRuby, so you&rsquo;ll get something like this if you try:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>jruby -S gem install merb --no-ri --no-rdoc
</span></span><span style="display:flex;"><span>Building native extensions.  This could take a <span style="color:#66d9ef">while</span>...
</span></span><span style="display:flex;"><span>/home/rich/local/jruby-1.1.5/lib/ruby/1.8/mkmf.rb:7: JRuby does not support native extensions. Check wiki.jruby.org <span style="color:#66d9ef">for</span> alternatives. <span style="color:#f92672">(</span>NotImplementedError<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>	from /home/rich/local/jruby-1.1.5/lib/ruby/1.8/mkmf.rb:21:in <span style="color:#e6db74">`</span>require<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>	from extconf.rb:21
</span></span><span style="display:flex;"><span>ERROR:  Error installing merb:
</span></span><span style="display:flex;"><span>	ERROR: Failed to build gem native extension.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/home/rich/local/jruby-1.1.5/bin/jruby extconf.rb install merb --no-ri --no-rdoc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Gem files will remain installed in /home/rich/local/jruby-1.1.5/lib/ruby/gems/1.8/gems/do_sqlite3-0.9.10.1 <span style="color:#66d9ef">for</span> inspection.
</span></span><span style="display:flex;"><span>Results logged to /home/rich/local/jruby-1.1.5/lib/ruby/gems/1.8/gems/do_sqlite3-0.9.10.1/ext/do_sqlite3_ext/gem_make.out
</span></span></code></pre></div><p>Installing only merb-core and merb-more along with ActiveRecord and Mongrel gives us everything we need to create a simple Merb on JRuby application.</p>
<h1 id="a-simple-merb-on-jruby-application">A Simple Merb on JRuby Application</h1>
<p>We need to tell Merb to use ActiveRecord as the ORM rather than DataMapper when the project is created. Let&rsquo;s call our project &lsquo;ws&rsquo;:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>jruby -S merb-gen core --orm activerecord ws
</span></span><span style="display:flex;"><span>cd ws
</span></span><span style="display:flex;"><span>jruby -S rake db:create
</span></span><span style="display:flex;"><span>nano config/database.yml.sample ...
</span></span><span style="display:flex;"><span>mv config/database.yml.sample config/database.yml
</span></span><span style="display:flex;"><span>jruby -S merb
</span></span></code></pre></div><p>Pointing your browser at <a href="http://localhost:4000/">http://localhost:4000/</a> should render a page. It will complain about &ldquo;No routes match the request: /&rdquo;, but that&rsquo;s to be expected since we haven&rsquo;t created any.</p>
<h1 id="conclusions">Conclusions</h1>
<p>Merb isn&rsquo;t the only way to create a fast, private, restful web service for accessing Java libraries. One alternative would be to use a pure-Java solution such as <a href="http://www.restlet.org/">Restlet</a>. Still, with Merb on JRuby installed and running, it&rsquo;s possible to explore the tradeoffs. And the coming <a href="http://weblog.rubyonrails.org/2008/12/23/merb-gets-merged-into-rails-3">merge</a> of Merb and Rails for Rails 3.0 makes doing so all the more compelling.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  Depth-First 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
