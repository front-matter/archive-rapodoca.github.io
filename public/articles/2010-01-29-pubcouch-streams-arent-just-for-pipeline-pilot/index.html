<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>PubCouch - Streams Aren&#39;t Just for Pipeline Pilot | Depth-First</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="If you&rsquo;ve been following along with the development of PubCouch, the CouchDB interface for PubChem, you&rsquo;ve probably noticed that only a fraction of the code relates to CouchDB itself. What&rsquo;s the rest of it doing?
This article, the the third in a series on using CouchDB for PubChem data describes how PubCouch transforms PubChem&rsquo;s collection of gzipped archive files into a stream of structure-data records that can be processed as if it were one big SD File.">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/articles/2010-01-29-pubcouch-streams-arent-just-for-pipeline-pilot/">
    

    <meta property="og:url" content="http://localhost:1313/articles/2010-01-29-pubcouch-streams-arent-just-for-pipeline-pilot/">
  <meta property="og:site_name" content="Depth-First">
  <meta property="og:title" content="PubCouch - Streams Aren&#39;t Just for Pipeline Pilot">
  <meta property="og:description" content="If you’ve been following along with the development of PubCouch, the CouchDB interface for PubChem, you’ve probably noticed that only a fraction of the code relates to CouchDB itself. What’s the rest of it doing?
This article, the the third in a series on using CouchDB for PubChem data describes how PubCouch transforms PubChem’s collection of gzipped archive files into a stream of structure-data records that can be processed as if it were one big SD File.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="articles">
    <meta property="article:published_time" content="2010-01-29T00:00:00+00:00">
    <meta property="article:modified_time" content="2010-01-29T00:00:00+00:00">

  <meta itemprop="name" content="PubCouch - Streams Aren&#39;t Just for Pipeline Pilot">
  <meta itemprop="description" content="If you’ve been following along with the development of PubCouch, the CouchDB interface for PubChem, you’ve probably noticed that only a fraction of the code relates to CouchDB itself. What’s the rest of it doing?
This article, the the third in a series on using CouchDB for PubChem data describes how PubCouch transforms PubChem’s collection of gzipped archive files into a stream of structure-data records that can be processed as if it were one big SD File.">
  <meta itemprop="datePublished" content="2010-01-29T00:00:00+00:00">
  <meta itemprop="dateModified" content="2010-01-29T00:00:00+00:00">
  <meta itemprop="wordCount" content="506">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="PubCouch - Streams Aren&#39;t Just for Pipeline Pilot">
  <meta name="twitter:description" content="If you’ve been following along with the development of PubCouch, the CouchDB interface for PubChem, you’ve probably noticed that only a fraction of the code relates to CouchDB itself. What’s the rest of it doing?
This article, the the third in a series on using CouchDB for PubChem data describes how PubCouch transforms PubChem’s collection of gzipped archive files into a stream of structure-data records that can be processed as if it were one big SD File.">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Depth-First
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Articles
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">PubCouch - Streams Aren&#39;t Just for Pipeline Pilot</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2010-01-29T00:00:00Z">January 29, 2010</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>If you&rsquo;ve been following along with the development of <a href="http://github.com/metamolecular/pubcouch">PubCouch</a>, the CouchDB interface for PubChem, you&rsquo;ve probably noticed that only a fraction of the code relates to CouchDB itself. What&rsquo;s the rest of it doing?</p>
<p>This article, the the third in a series on <a href="/articles/2010/01/20/pubcouch-a-couchdb-interface-to-pubchem">using CouchDB for PubChem data</a> describes how PubCouch transforms PubChem&rsquo;s collection of gzipped archive files into a stream of structure-data records that can be processed as if it were one big SD File.</p>
<h1 id="the-problem">The Problem</h1>
<p>If you want to work with the PubChem dataset, one of the first problems you&rsquo;ll face is how to import the data into your database management system (dbms). The PubChem FTP server contains a rather large collection of archive &ldquo;bundles&rdquo;, which are simply <a href="/articles/2006/09/29/hacking-pubchem-direct-access-with-ftp">gzipped SD Files of records within a certain ID range</a>.</p>
<p>In most cases, importing the PubChem database will consist of sequentially reading every Compound and Substance record, applying the appropriate intermediate processing, and storing the result.</p>
<p>So, we have a mismatch in the way PubChem stores its data (multiple gzipped archives) and the way we want to process it (as one big SD File). And by the way, how about not storing a bunch of temporary files, but rather transfer data directly from the archive to our database?</p>
<h1 id="a-solution">A Solution</h1>
<p>One of the reasons Java was chosen as PubCouch&rsquo;s development language is its built-in support for high-performance IO operations. <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/io/InputStream.html">InputStream</a>, the foundation of this support, turns out to be a very versatile class enabling a variety of filtering and reprocessing operations on raw data streams.</p>
<p>Our <a href="http://commons.apache.org/net/">FTP Client</a> can return at most one raw byte stream from each archive file. By applying a set of filters on this stream, we can get pretty close to where we need to be:</p>
<ul>
<li>wrap each InputStream in a <a href="http://commons.apache.org/net/">GZIPInputStream</a></li>
<li>wrap the result in an <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/io/InputStreamReader.html">StreamReaderReader</a></li>
<li>wrap the result in a <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/io/BufferedReader.html">BufferedReader</a> to read line-by-line</li>
</ul>
<p>These filters alone won&rsquo;t do the job - remember, we want to treat the entire FTP archive as one big SD File.</p>
<p><a href="http://java.sun.com/j2se/1.4.2/docs/api/java/io/SequenceInputStream.html">SequenceInputStream</a> is just what we need. This nifty little class can make a series of InputStreams (i.e., the individual PubChem files) appear as one big InputStream.</p>
<p>Putting this all together, we end up with a chained series of inputs:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>InputStream -&amp;gt; GZIPInputStream<span style="color:#f92672">]</span> -&amp;gt;
</span></span><span style="display:flex;"><span>SequenceInputStream -&amp;gt;
</span></span><span style="display:flex;"><span>StreamReader -&amp;gt;
</span></span><span style="display:flex;"><span>BufferedReader
</span></span></code></pre></div><p>We now have a BufferedReader that will for all intents and purposes look like we&rsquo;ve just opened a massive SD File. Handing this Reader to an SD File processor will let us capture all Substance or Compound records using a simple conceptual model.</p>
<h1 id="conclusions">Conclusions</h1>
<p>By using Java&rsquo;s support for stream chaining and transformation, PubCouch makes it possible to work with the PubChem FTP archive as if it were one big SD File. This turns out to be useful regardless of how you decide to ultimately represent and store the resulting records. There are still some rough edges in the implementation and possibilities for extending the concept (i.e., random-access), but the idea can be used on many other datasources, and in many other contexts.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  Depth-First 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
