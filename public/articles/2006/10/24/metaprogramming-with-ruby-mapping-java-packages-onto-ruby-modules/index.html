<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Metaprogramming with Ruby: Mapping Java Packages Onto Ruby Modules | Depth-First</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Metaprogramming lets you define new constructs in your programming language. In safety languages like Java, metaprogramming is not a standard feature, although it can be done. Not surprisingly, the reaction most Java developers have to metaprogramming typically ranges from &ldquo;useless&rdquo; to &ldquo;catastrophic&rdquo;. I was once in that category. But in the words of Paul Graham, sometimes doing the right thing involves &ldquo;changing the language to suit the problem&rdquo;. This is a powerful concept that, when used with care, can greatly reduce development time. The Ruby language is especially well-equipped for metaprogramming. This article will show a simple metaprogramming technique that extends Ruby so that Java packages are mapped onto to Ruby modules.">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/articles/2006/10/24/metaprogramming-with-ruby-mapping-java-packages-onto-ruby-modules/">
    

    <meta property="og:url" content="http://localhost:1313/articles/2006/10/24/metaprogramming-with-ruby-mapping-java-packages-onto-ruby-modules/">
  <meta property="og:site_name" content="Depth-First">
  <meta property="og:title" content="Metaprogramming with Ruby: Mapping Java Packages Onto Ruby Modules">
  <meta property="og:description" content="Metaprogramming lets you define new constructs in your programming language. In safety languages like Java, metaprogramming is not a standard feature, although it can be done. Not surprisingly, the reaction most Java developers have to metaprogramming typically ranges from “useless” to “catastrophic”. I was once in that category. But in the words of Paul Graham, sometimes doing the right thing involves “changing the language to suit the problem”. This is a powerful concept that, when used with care, can greatly reduce development time. The Ruby language is especially well-equipped for metaprogramming. This article will show a simple metaprogramming technique that extends Ruby so that Java packages are mapped onto to Ruby modules.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2006-10-24T00:00:00+00:00">
    <meta property="article:modified_time" content="2006-10-24T00:00:00+00:00">

  <meta itemprop="name" content="Metaprogramming with Ruby: Mapping Java Packages Onto Ruby Modules">
  <meta itemprop="description" content="Metaprogramming lets you define new constructs in your programming language. In safety languages like Java, metaprogramming is not a standard feature, although it can be done. Not surprisingly, the reaction most Java developers have to metaprogramming typically ranges from “useless” to “catastrophic”. I was once in that category. But in the words of Paul Graham, sometimes doing the right thing involves “changing the language to suit the problem”. This is a powerful concept that, when used with care, can greatly reduce development time. The Ruby language is especially well-equipped for metaprogramming. This article will show a simple metaprogramming technique that extends Ruby so that Java packages are mapped onto to Ruby modules.">
  <meta itemprop="datePublished" content="2006-10-24T00:00:00+00:00">
  <meta itemprop="dateModified" content="2006-10-24T00:00:00+00:00">
  <meta itemprop="wordCount" content="726">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Metaprogramming with Ruby: Mapping Java Packages Onto Ruby Modules">
  <meta name="twitter:description" content="Metaprogramming lets you define new constructs in your programming language. In safety languages like Java, metaprogramming is not a standard feature, although it can be done. Not surprisingly, the reaction most Java developers have to metaprogramming typically ranges from “useless” to “catastrophic”. I was once in that category. But in the words of Paul Graham, sometimes doing the right thing involves “changing the language to suit the problem”. This is a powerful concept that, when used with care, can greatly reduce development time. The Ruby language is especially well-equipped for metaprogramming. This article will show a simple metaprogramming technique that extends Ruby so that Java packages are mapped onto to Ruby modules.">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Depth-First
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Metaprogramming with Ruby: Mapping Java Packages Onto Ruby Modules</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2006-10-24T00:00:00Z">October 24, 2006</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p><!-- raw HTML omitted --><!-- raw HTML omitted -->Metaprogramming<!-- raw HTML omitted --> lets you define new constructs in your programming language. In <!-- raw HTML omitted -->safety languages<!-- raw HTML omitted --> like Java, metaprogramming is not a standard feature, although <!-- raw HTML omitted -->it can be done<!-- raw HTML omitted -->. Not surprisingly, the reaction most Java developers have to metaprogramming typically ranges from &ldquo;useless&rdquo; to &ldquo;catastrophic&rdquo;. I was once in that category. But in the words of Paul Graham, sometimes doing the right thing involves <!-- raw HTML omitted -->&ldquo;changing the language to suit the problem&rdquo;<!-- raw HTML omitted -->. This is a powerful concept that, when used with care, can greatly reduce development time. The Ruby language is <!-- raw HTML omitted -->especially well-equipped<!-- raw HTML omitted --> for metaprogramming. This article will show a simple metaprogramming technique that extends Ruby so that Java packages are mapped onto to Ruby modules.</p>
<h1 id="prerequisites">Prerequisites</h1>
<p>This tutorial uses <!-- raw HTML omitted -->Ruby Java Bridge<!-- raw HTML omitted --> (RJB). RJB can be <!-- raw HTML omitted -->installed<!-- raw HTML omitted --> either on Windows or Linux using the <!-- raw HTML omitted -->RubyGems<!-- raw HTML omitted --> packaging mechanism.</p>
<h1 id="defining-the-problem">Defining the Problem</h1>
<p>The large amount of existing Java code makes RJB one of Ruby&rsquo;s most useful integration tools. RJB provides a lightweight mechanism for working with Java classes from Ruby, while simultaneously allowing for the use of C-extensions and everything else the C implementation of Ruby offers.</p>
<p>Let&rsquo;s say you&rsquo;d like to do image processing with Java&rsquo;s <!-- raw HTML omitted -->ImageIO<!-- raw HTML omitted --> class. This could be accomplished with RJB via:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;rubygems&#39;</span>
</span></span><span style="display:flex;"><span>require_gem <span style="color:#e6db74">&#39;rjb&#39;</span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;rjb&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@ImageIO <span style="color:#f92672">=</span> <span style="color:#66d9ef">Rjb</span><span style="color:#f92672">::</span>import <span style="color:#e6db74">&#39;javax.imageio.ImageIO&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@ImageIO<span style="color:#f92672">.</span>getReaderFormatNames <span style="color:#75715e"># =&gt; an array of format names</span>
</span></span></code></pre></div><p>Here, the instance variable <!-- raw HTML omitted -->ImageIO<!-- raw HTML omitted --> holds a reference to the Java class of the same name. This isn&rsquo;t too bad, but can we do better?</p>
<p>Imagine a situation in which many Java classes need to be imported. This would lead to many variable assignments like the one above. The resulting duplications of Java class names and variable names <!-- raw HTML omitted -->doesn&rsquo;t smell especially good<!-- raw HTML omitted -->, nor does it scale well. In addition, the large number of these variable assignments would add a lot of mental overhead when reading and writing the code.</p>
<p>What we&rsquo;d really like is if Ruby had a way for us to map a Java package/class hierarchy onto Ruby module/class hierarchy. We could then forget about the differences between Ruby and Java, and just get to work. For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#75715e">#...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>jrequire <span style="color:#e6db74">&#39;javax.imageio.ImageIO&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Javax</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Imageio</span><span style="color:#f92672">::</span><span style="color:#66d9ef">ImageIO</span><span style="color:#f92672">.</span>getReaderFormatNames
</span></span></code></pre></div><h1 id="a-solution">A Solution</h1>
<p>Our solution will involve translating nested Java package/class constructs into nested Ruby module/class constructs at runtime. We&rsquo;ll need the ability to create new module hierarchies in running code, one of the problems metaprogramming solves. We&rsquo;ll also have to deal with capitalization: Java package names are all lowercase, but Ruby module names start with a capital letter. So <!-- raw HTML omitted -->java.lang.System<!-- raw HTML omitted --> will become <!-- raw HTML omitted -->Java::Lang::System<!-- raw HTML omitted -->. By mapping the Java package namespace onto the Ruby module namespace, we&rsquo;ll reduce the odds of creating a Ruby/Java class name collision, such as with <!-- raw HTML omitted -->java.lang.String<!-- raw HTML omitted -->.</p>
<p>Let&rsquo;s create a small library to illustrate these points. The code will take advantage of Ruby&rsquo;s <!-- raw HTML omitted -->const_set<!-- raw HTML omitted --> method, which allows new constants (and therefore new modules and classes) to be defined at runtime. Save the following code into a file called <!-- raw HTML omitted -->java.rb<!-- raw HTML omitted -->:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;rubygems&#39;</span>
</span></span><span style="display:flex;"><span>require_gem <span style="color:#e6db74">&#39;rjb&#39;</span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;rjb&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">module</span> Kernel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">jrequire</span>(qualified_class_name)
</span></span><span style="display:flex;"><span>    java_class <span style="color:#f92672">=</span> <span style="color:#66d9ef">Rjb</span><span style="color:#f92672">::</span>import(qualified_class_name)
</span></span><span style="display:flex;"><span>    package_names <span style="color:#f92672">=</span> qualified_class_name<span style="color:#f92672">.</span>to_s<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;.&#39;</span>)
</span></span><span style="display:flex;"><span>    java_class_name <span style="color:#f92672">=</span> package_names<span style="color:#f92672">.</span>delete(package_names<span style="color:#f92672">.</span>last)
</span></span><span style="display:flex;"><span>    new_module <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>class
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    package_names<span style="color:#f92672">.</span>each <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>package_name<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>      module_name <span style="color:#f92672">=</span> package_name<span style="color:#f92672">.</span>capitalize
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> <span style="color:#f92672">!</span>new_module<span style="color:#f92672">.</span>const_defined?(module_name)
</span></span><span style="display:flex;"><span>        new_module <span style="color:#f92672">=</span> new_module<span style="color:#f92672">.</span>const_set(module_name, <span style="color:#66d9ef">Module</span><span style="color:#f92672">.</span>new)
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        new_module <span style="color:#f92672">=</span> new_module<span style="color:#f92672">.</span>const_get(module_name)
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span> <span style="color:#66d9ef">if</span> new_module<span style="color:#f92672">.</span>const_defined?(java_class_name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    new_module<span style="color:#f92672">.</span>const_set(java_class_name, java_class)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>  
</span></span></code></pre></div><h1 id="usage">Usage</h1>
<p>Using this library consists of <!-- raw HTML omitted -->requiring<!-- raw HTML omitted --> it, applying the new <!-- raw HTML omitted -->jrequire<!-- raw HTML omitted --> command, and manipulating the resulting class:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;java&#39;</span>
</span></span><span style="display:flex;"><span>jrequire <span style="color:#e6db74">&#39;javax.imageio.ImageIO&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Javax</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Imageio</span><span style="color:#f92672">::</span><span style="color:#66d9ef">ImageIO</span><span style="color:#f92672">.</span>getReaderFormatNames <span style="color:#75715e"># =&gt; [&#34;BMP&#34;, &#34;jpeg&#34;, &#34;bmp&#34;, &#34;wbmp&#34;, &#34;gif&#34;, &#34;JPG&#34;, &#34;png&#34;, &#34;jpg&#34;, &#34;WBMP&#34;, &#34;JPEG&#34;]</span>
</span></span></code></pre></div><p>You can eliminate the need to use the fully-qualified module name by adding an <!-- raw HTML omitted -->include<!-- raw HTML omitted --> statement, just as you would with any other Ruby module:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;java&#39;</span>
</span></span><span style="display:flex;"><span>jrequire <span style="color:#e6db74">&#39;javax.imageio.ImageIO&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">include</span> <span style="color:#66d9ef">Javax</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Imageio</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ImageIO</span><span style="color:#f92672">.</span>getReaderFormatNames <span style="color:#75715e"># =&gt; [&#34;BMP&#34;, &#34;jpeg&#34;, &#34;bmp&#34;, &#34;wbmp&#34;, &#34;gif&#34;, &#34;JPG&#34;, &#34;png&#34;, &#34;jpg&#34;, &#34;WBMP&#34;, &#34;JPEG&#34;]</span>
</span></span></code></pre></div><h1 id="one-possible-variation">One Possible Variation</h1>
<p>An interesting variation on the approach given here would be to override Ruby&rsquo;s <!-- raw HTML omitted -->require<!-- raw HTML omitted --> method itself to accept fully-qualified Java class names. Then something even more Rubyesque could be used:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;java&#39;</span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;javax/imageio/ImageIO&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Javax</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Imageio</span><span style="color:#f92672">::</span><span style="color:#66d9ef">ImageIO</span><span style="color:#f92672">.</span>getReaderFormatNames
</span></span></code></pre></div><h1 id="other-examples-of-ruby-java-metaprogramming">Other Examples of Ruby-Java Metaprogramming</h1>
<p><!-- raw HTML omitted -->Ola Bini<!-- raw HTML omitted --> has written an article on JRuby metaprogramming that takes <!-- raw HTML omitted -->a slightly different approach<!-- raw HTML omitted --> than the one detailed here.</p>
<h1 id="conclusions">Conclusions</h1>
<p>This tutorial has shown a simple and practical application of Ruby&rsquo;s built-in metaprogramming capabilities. The careful use of metaprogamming is a powerful way to reduce code complexity and build a more consistent programming environment. Look for more metaprogramming techniques to appear in future releases of the <!-- raw HTML omitted -->Ruby CDK<!-- raw HTML omitted --> library.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  Depth-First 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
