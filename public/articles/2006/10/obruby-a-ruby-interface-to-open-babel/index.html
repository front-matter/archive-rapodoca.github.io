<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>OBRuby: A Ruby Interface to Open Babel | Depth-First</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="
And the LORD said, Behold, the people is one, and they have all one language; and this they begin to do: and now nothing will be restrained from them, which they have imagined to do.
Genesis 11:6

Open Babel is a widely-used Open Source chemical informatics toolkit written in C&#43;&#43;. Although originally designed as a molecular language translator, Open Babel also supports SMARTS pattern recognition, molecular fingerprints, molecular superposition, and other features as well.">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/articles/2006/10/obruby-a-ruby-interface-to-open-babel/">
    

    <meta property="og:url" content="http://localhost:1313/articles/2006/10/obruby-a-ruby-interface-to-open-babel/">
  <meta property="og:site_name" content="Depth-First">
  <meta property="og:title" content="OBRuby: A Ruby Interface to Open Babel">
  <meta property="og:description" content="And the LORD said, Behold, the people is one, and they have all one language; and this they begin to do: and now nothing will be restrained from them, which they have imagined to do.
Genesis 11:6
Open Babel is a widely-used Open Source chemical informatics toolkit written in C&#43;&#43;. Although originally designed as a molecular language translator, Open Babel also supports SMARTS pattern recognition, molecular fingerprints, molecular superposition, and other features as well.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="articles">
    <meta property="article:published_time" content="2006-10-31T00:00:00+00:00">
    <meta property="article:modified_time" content="2006-10-31T00:00:00+00:00">

  <meta itemprop="name" content="OBRuby: A Ruby Interface to Open Babel">
  <meta itemprop="description" content="And the LORD said, Behold, the people is one, and they have all one language; and this they begin to do: and now nothing will be restrained from them, which they have imagined to do.
Genesis 11:6
Open Babel is a widely-used Open Source chemical informatics toolkit written in C&#43;&#43;. Although originally designed as a molecular language translator, Open Babel also supports SMARTS pattern recognition, molecular fingerprints, molecular superposition, and other features as well.">
  <meta itemprop="datePublished" content="2006-10-31T00:00:00+00:00">
  <meta itemprop="dateModified" content="2006-10-31T00:00:00+00:00">
  <meta itemprop="wordCount" content="886">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="OBRuby: A Ruby Interface to Open Babel">
  <meta name="twitter:description" content="And the LORD said, Behold, the people is one, and they have all one language; and this they begin to do: and now nothing will be restrained from them, which they have imagined to do.
Genesis 11:6
Open Babel is a widely-used Open Source chemical informatics toolkit written in C&#43;&#43;. Although originally designed as a molecular language translator, Open Babel also supports SMARTS pattern recognition, molecular fingerprints, molecular superposition, and other features as well.">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Depth-First
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Articles
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">OBRuby: A Ruby Interface to Open Babel</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2006-10-31T00:00:00Z">October 31, 2006</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><blockquote>
<p>And the LORD said, Behold, the people is one, and they have all one language; and this they begin to do: and now nothing will be restrained from them, which they have imagined to do.</p>
<p><!-- raw HTML omitted -->Genesis 11:6<!-- raw HTML omitted --></p>
</blockquote>
<p><!-- raw HTML omitted -->Open Babel<!-- raw HTML omitted --> is a <!-- raw HTML omitted -->widely-used<!-- raw HTML omitted --> Open Source chemical informatics toolkit written in C++. Although originally designed as a <!-- raw HTML omitted -->molecular language translator<!-- raw HTML omitted -->, Open Babel also supports <!-- raw HTML omitted -->SMARTS pattern recognition<!-- raw HTML omitted -->, <!-- raw HTML omitted -->molecular fingerprints<!-- raw HTML omitted -->, <!-- raw HTML omitted -->molecular superposition<!-- raw HTML omitted -->, and other features as well.</p>
<p>Open Babel currently offers interfaces for two scripting languages: <!-- raw HTML omitted -->Python<!-- raw HTML omitted --> and <!-- raw HTML omitted -->Perl<!-- raw HTML omitted -->. Recently, <!-- raw HTML omitted -->Geoff Hutchison<!-- raw HTML omitted --> and I have been working to add Ruby to that list. This article reports our success in doing so and provides a glimpse of what might now be possible.</p>
<h1 id="obruby">OBRuby</h1>
<p>The upcoming release of Open Babel (version 2.1.0) will come complete with a Ruby interface. For those interested in trying it out sooner, a package called <a href="/images/posts/20061031/obruby.tar.gz">OBRuby</a> can be downloaded now. OBRuby compiles against revision 1577 of the Open Babel SVN trunk. It has been tested with Linux and Mac OS X, and will probably work on Windows with minor modifications. <!-- raw HTML omitted -->The approach outlined here is known to fail with Open Babel 2.0.2.<!-- raw HTML omitted --></p>
<p>OBRuby is a technology demonstration. The Ruby scripting support included with Open Babel 2.1.0 may differ in some details from OBRuby. My purpose in this article is simply to demonstrate what is now possible. Please read through the install scripts (they&rsquo;re short) to be sure you&rsquo;re comfortable with what they do.</p>
<p>Here was my OBRuby installation process:</p>
<ol>
<li>Download the Open Babel SVN trunk revision 1577 or later.</li>
<li>cd trunk</li>
<li>configure, make, (as root) make install</li>
<li>(as root) ldconfig (necessary on my system - perhaps not on yours)</li>
<li>cd OBRUBY_DIR</li>
<li>ruby build.rb</li>
<li>(as root) make install</li>
</ol>
<p>One last wrinkle: the <!-- raw HTML omitted -->build.rb<!-- raw HTML omitted --> script included with OBRuby is something of a hack. It hardcodes the location of the Open Babel library on line 6:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>@@ob_dir<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/usr/local&#39;</span>
</span></span></code></pre></div><p>Change this line to match your Open Babel installation and you should be ready to go. <!-- raw HTML omitted -->make install<!-- raw HTML omitted --> places a single file, openbabel.so into your Ruby site_ruby directory.</p>
<p>To verify that the installation worked with IRB:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>irb
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:001:0&gt; require <span style="color:#e6db74">&#39;openbabel&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; true
</span></span></code></pre></div><p>A return value of <!-- raw HTML omitted -->true<!-- raw HTML omitted --> shows that the installation was successful. An error message about <!-- raw HTML omitted -->libopenbabel.so<!-- raw HTML omitted --> not being found indicates that your system can&rsquo;t find your Open Babel libraries. Be sure you&rsquo;ve installed Open Babel and either run <!-- raw HTML omitted -->ldconfig<!-- raw HTML omitted --> or set <!-- raw HTML omitted -->LD_LIBRARY_PATH<!-- raw HTML omitted -->.</p>
<p>The majority of OBRuby was autogenerated by <!-- raw HTML omitted -->SWIG<!-- raw HTML omitted -->. A future article will detail how this was done - with an eye toward developing a Java interface to Open Babel.</p>
<h1 id="building-an-obmol-from-smiles">Building an OBMol From SMILES</h1>
<p>With installation out of the way, let&rsquo;s fire up OBRuby and take her for a test drive. The following code can either be entered with IRB or saved to a file and executed with the ruby interpreter:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;openbabel&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">include</span> <span style="color:#66d9ef">OpenBabel</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>smi2mol <span style="color:#f92672">=</span> <span style="color:#66d9ef">OBConversion</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>smi2mol<span style="color:#f92672">.</span>set_in_format(<span style="color:#e6db74">&#34;smi&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mol <span style="color:#f92672">=</span> <span style="color:#66d9ef">OBMol</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>smi2mol<span style="color:#f92672">.</span>read_string(mol, <span style="color:#e6db74">&#39;CC(C)CCCC(C)C1CCC2C1(CCC3C2CC=C4C3(CCC(C4)O)C)C&#39;</span>) <span style="color:#75715e"># cholesterol, no chirality</span>
</span></span><span style="display:flex;"><span>mol<span style="color:#f92672">.</span>add_hydrogens
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;Cholesterol has </span><span style="color:#e6db74">#{</span>mol<span style="color:#f92672">.</span>num_atoms<span style="color:#e6db74">}</span><span style="color:#e6db74"> atoms, including hydrogens.&#34;</span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;Its molecular weight is </span><span style="color:#e6db74">#{</span>mol<span style="color:#f92672">.</span>get_mol_wt<span style="color:#e6db74">}</span><span style="color:#e6db74"> and its molecular formula is </span><span style="color:#e6db74">#{</span>mol<span style="color:#f92672">.</span>get_formula<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
</span></span></code></pre></div><p>This simple code illustrates some important points. All OBRuby classes reside in the <!-- raw HTML omitted -->OpenBabel<!-- raw HTML omitted --> module. These classes can be directly referenced by <!-- raw HTML omitted -->including<!-- raw HTML omitted --> the <!-- raw HTML omitted -->OpenBabel<!-- raw HTML omitted --> module. Also notice how Ruby <!-- raw HTML omitted -->underscore_delimited<!-- raw HTML omitted --> method names are used, rather than C++ <!-- raw HTML omitted -->UpperCamelCase<!-- raw HTML omitted --> names.</p>
<h1 id="smarts-matching">SMARTS Matching</h1>
<p>One of the most useful features of Open Babel is its SMARTS pattern matching capability. This can conveniently be accessed from OBRuby by first instantiating an <!-- raw HTML omitted -->OBSmartsPattern<!-- raw HTML omitted -->, passing the SMARTS pattern of interest to the instance&rsquo;s <!-- raw HTML omitted -->init<!-- raw HTML omitted --> method, and retrieving the hit set:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;openbabel&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">include</span> <span style="color:#66d9ef">OpenBabel</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>smi2mol <span style="color:#f92672">=</span> <span style="color:#66d9ef">OBConversion</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>smi2mol<span style="color:#f92672">.</span>set_in_format(<span style="color:#e6db74">&#34;smi&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mol <span style="color:#f92672">=</span> <span style="color:#66d9ef">OBMol</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>smiles <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;CC(C)CCCC(C)C1CCC2C1(CCC3C2CC=C4C3(CCC(C4)O)C)C&#39;</span> <span style="color:#75715e"># cholesterol, no chirality</span>
</span></span><span style="display:flex;"><span>smi2mol<span style="color:#f92672">.</span>read_string(mol, smiles) 
</span></span><span style="display:flex;"><span>mol<span style="color:#f92672">.</span>add_hydrogens
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pattern<span style="color:#f92672">=</span><span style="color:#66d9ef">OBSmartsPattern</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>smarts <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;C1CCCCC1&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pattern<span style="color:#f92672">.</span>init(smarts)
</span></span><span style="display:flex;"><span>pattern<span style="color:#f92672">.</span>match(mol)
</span></span><span style="display:flex;"><span>hits <span style="color:#f92672">=</span> pattern<span style="color:#f92672">.</span>get_umap_list <span style="color:#75715e"># =&gt; indicies of two cyclohexane rings</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>puts <span style="color:#e6db74">&#34;Found </span><span style="color:#e6db74">#{</span>hits<span style="color:#f92672">.</span>size<span style="color:#e6db74">}</span><span style="color:#e6db74"> instances of the SMARTS pattern &#39;</span><span style="color:#e6db74">#{</span>smarts<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; in the SMILES string </span><span style="color:#e6db74">#{</span>smiles<span style="color:#e6db74">}</span><span style="color:#e6db74">. Here are the atom indices:&#34;</span>
</span></span><span style="display:flex;"><span>hits<span style="color:#f92672">.</span>each_with_index <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>hit, index<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>  print <span style="color:#e6db74">&#34;Hit </span><span style="color:#e6db74">#{</span>index<span style="color:#e6db74">}</span><span style="color:#e6db74">: [ &#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  hit<span style="color:#f92672">.</span>each <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>atom_index<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>    print <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">#{</span>atom_index<span style="color:#e6db74">}</span><span style="color:#e6db74"> &#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  puts <span style="color:#e6db74">&#34;]&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>Notice the Rubyesque <!-- raw HTML omitted -->each_with_index<!-- raw HTML omitted --> block that iterates over the elements in the hit set.</p>
<p>Running the above code produces the following output:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Found <span style="color:#ae81ff">2</span> instances of the SMARTS pattern <span style="color:#e6db74">&#39;C1CCCCC1&#39;</span> in the SMILES string CC<span style="color:#f92672">(</span>C<span style="color:#f92672">)</span>CCCC<span style="color:#f92672">(</span>C<span style="color:#f92672">)</span>C1CCC2C1<span style="color:#f92672">(</span>CCC3C2CC<span style="color:#f92672">=</span>C4C3<span style="color:#f92672">(</span>CCC<span style="color:#f92672">(</span>C4<span style="color:#f92672">)</span>O<span style="color:#f92672">)</span>C<span style="color:#f92672">)</span>C. Here are the atom indices:
</span></span><span style="display:flex;"><span>Hit 0: <span style="color:#f92672">[</span> <span style="color:#ae81ff">12</span> <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">16</span> <span style="color:#ae81ff">15</span> <span style="color:#ae81ff">14</span> <span style="color:#ae81ff">13</span> <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Hit 1: <span style="color:#f92672">[</span> <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">25</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">23</span> <span style="color:#ae81ff">22</span> <span style="color:#ae81ff">21</span> <span style="color:#f92672">]</span>
</span></span></code></pre></div><h1 id="finding-your-way">Finding Your Way</h1>
<p>Using a new library like OBRuby can take some getting used to. An excellent source of information is OpenBabel&rsquo;s <!-- raw HTML omitted -->online API documentation<!-- raw HTML omitted -->. Another source is Ruby itself.</p>
<p>For example, let&rsquo;s say you&rsquo;ve instantiated an <!-- raw HTML omitted -->OBMol<!-- raw HTML omitted -->, but can&rsquo;t remember the exact name of the method that counts the number of atoms. Just use <!-- raw HTML omitted -->Object.methods.sort<!-- raw HTML omitted -->:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;openbabel&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mol <span style="color:#f92672">=</span> <span style="color:#66d9ef">OpenBabel</span><span style="color:#f92672">::</span><span style="color:#66d9ef">OBMol</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mol<span style="color:#f92672">.</span>methods<span style="color:#f92672">.</span>sort <span style="color:#75715e"># =&gt; see output below</span>
</span></span></code></pre></div><p>When run from Interactive Ruby (irb), this code produces the following alphabetized list of methods, which I&rsquo;ve truncated:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>... <span style="color:#e6db74">&#34;is_corrected_for_ph&#34;</span>, <span style="color:#e6db74">&#34;kekulize&#34;</span>, <span style="color:#e6db74">&#34;kind_of?&#34;</span>, <span style="color:#e6db74">&#34;method&#34;</span>, <span style="color:#e6db74">&#34;methods&#34;</span>, <span style="color:#e6db74">&#34;new_atom&#34;</span>, <span style="color:#e6db74">&#34;new_perceive_kekule_bonds&#34;</span>, <span style="color:#e6db74">&#34;new_residue&#34;</span>, <span style="color:#e6db74">&#34;next_atom&#34;</span>, <span style="color:#e6db74">&#34;next_bond&#34;</span>, <span style="color:#e6db74">&#34;next_conformer&#34;</span>, <span style="color:#e6db74">&#34;next_internal_coord&#34;</span>, <span style="color:#e6db74">&#34;next_residue&#34;</span>, <span style="color:#e6db74">&#34;nil?&#34;</span>, &lt;strong&gt;<span style="color:#e6db74">&#34;num_atoms&#34;</span>&lt;/strong&gt;, <span style="color:#e6db74">&#34;num_bonds&#34;</span>, <span style="color:#e6db74">&#34;num_conformers&#34;</span>, <span style="color:#e6db74">&#34;num_edges&#34;</span>, <span style="color:#e6db74">&#34;num_hvy_atoms&#34;</span>, <span style="color:#e6db74">&#34;num_nodes&#34;</span>, <span style="color:#e6db74">&#34;num_residues&#34;</span>, <span style="color:#e6db74">&#34;num_rotors&#34;</span>, <span style="color:#e6db74">&#34;object_id&#34;</span>, <span style="color:#e6db74">&#34;perceive_bond_orders&#34;</span>, <span style="color:#e6db74">&#34;perceive_kekule_bonds&#34;</span>, <span style="color:#e6db74">&#34;private_methods&#34;</span>, <span style="color:#e6db74">&#34;protected_methods&#34;</span>, <span style="color:#e6db74">&#34;public_methods&#34;</span>, <span style="color:#e6db74">&#34;renumber_atoms&#34;</span>, <span style="color:#e6db74">&#34;reserve_atoms&#34;</span>, <span style="color:#e6db74">&#34;reset_visit_flags&#34;</span> ...
</span></span></code></pre></div><h1 id="conclusions">Conclusions</h1>
<p>OBRuby combines the dynamic programming language Ruby with the highly-functional toolkit Open Babel. Further augmenting OBRuby&rsquo;s capabilities with the web application framework <!-- raw HTML omitted -->Rails<!-- raw HTML omitted --> and/or <!-- raw HTML omitted -->Ruby Chemistry Development Kit<!-- raw HTML omitted --> offers even more possibilities. Future articles will bring some of them to life.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  Depth-First 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
