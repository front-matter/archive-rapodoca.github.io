<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Anatomy of a Cheminformatics Web Application: Structure Cleanup in Java Molecular Editor | Depth-First</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="A very useful feature of many 2-D structure editors is a &ldquo;clean&rdquo; function that tidies up bond lengths and angles. Java Molecular Editor (JME) is a lightweight 2-D editor that lacks this functionality. In this article, I&rsquo;ll describe a small Web application called &ldquo;Cleanup&rdquo; that adds a &ldquo;clean&rdquo; function to JME through Ajax and server-side programming, rather than directly extending JME itself. The technique described here differs somewhat from that described in a previous article on adding InChI support to JME with Ajax.">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/articles/2006/12/18/anatomy-of-a-cheminformatics-web-application-structure-cleanup-in-java-molecular-editor/">
    

    <meta property="og:url" content="http://localhost:1313/articles/2006/12/18/anatomy-of-a-cheminformatics-web-application-structure-cleanup-in-java-molecular-editor/">
  <meta property="og:site_name" content="Depth-First">
  <meta property="og:title" content="Anatomy of a Cheminformatics Web Application: Structure Cleanup in Java Molecular Editor">
  <meta property="og:description" content="A very useful feature of many 2-D structure editors is a “clean” function that tidies up bond lengths and angles. Java Molecular Editor (JME) is a lightweight 2-D editor that lacks this functionality. In this article, I’ll describe a small Web application called “Cleanup” that adds a “clean” function to JME through Ajax and server-side programming, rather than directly extending JME itself. The technique described here differs somewhat from that described in a previous article on adding InChI support to JME with Ajax.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2006-12-18T00:00:00+00:00">
    <meta property="article:modified_time" content="2006-12-18T00:00:00+00:00">

  <meta itemprop="name" content="Anatomy of a Cheminformatics Web Application: Structure Cleanup in Java Molecular Editor">
  <meta itemprop="description" content="A very useful feature of many 2-D structure editors is a “clean” function that tidies up bond lengths and angles. Java Molecular Editor (JME) is a lightweight 2-D editor that lacks this functionality. In this article, I’ll describe a small Web application called “Cleanup” that adds a “clean” function to JME through Ajax and server-side programming, rather than directly extending JME itself. The technique described here differs somewhat from that described in a previous article on adding InChI support to JME with Ajax.">
  <meta itemprop="datePublished" content="2006-12-18T00:00:00+00:00">
  <meta itemprop="dateModified" content="2006-12-18T00:00:00+00:00">
  <meta itemprop="wordCount" content="976">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Anatomy of a Cheminformatics Web Application: Structure Cleanup in Java Molecular Editor">
  <meta name="twitter:description" content="A very useful feature of many 2-D structure editors is a “clean” function that tidies up bond lengths and angles. Java Molecular Editor (JME) is a lightweight 2-D editor that lacks this functionality. In this article, I’ll describe a small Web application called “Cleanup” that adds a “clean” function to JME through Ajax and server-side programming, rather than directly extending JME itself. The technique described here differs somewhat from that described in a previous article on adding InChI support to JME with Ajax.">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Depth-First
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Anatomy of a Cheminformatics Web Application: Structure Cleanup in Java Molecular Editor</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2006-12-18T00:00:00Z">December 18, 2006</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>A very useful feature of many 2-D structure editors is a &ldquo;clean&rdquo; function that tidies up bond lengths and angles. <!-- raw HTML omitted -->Java Molecular Editor<!-- raw HTML omitted --> (JME) is a lightweight 2-D editor that lacks this functionality. In this article, I&rsquo;ll describe a small Web application called &ldquo;Cleanup&rdquo; that adds a &ldquo;clean&rdquo; function to JME through Ajax and server-side programming, rather than directly extending JME itself. The technique described here differs somewhat from that described in a previous article on <!-- raw HTML omitted -->adding InChI support to JME with Ajax<!-- raw HTML omitted -->.</p>
<h1 id="cleanup-in-action">Cleanup in Action</h1>
<p>Let&rsquo;s say Bob needs to draw the structure of the H<!-- raw HTML omitted -->1<!-- raw HTML omitted --> antagonist <!-- raw HTML omitted -->chlorpheniramine<!-- raw HTML omitted --> with JME. He mistakenly creates irregular bond angles at several points, but continues drawing anyway. His finished molecule looks like that shown below:</p>
<p><img src="/images/posts/20061218/screenshot_1.png" alt="&ldquo;Molecule to Clean Up&rdquo;" title="Molecule to Clean Up"></p>
<p>Rather than starting over to beautify his molecule, Bob, simply presses the <!-- raw HTML omitted -->Clean Molecule<!-- raw HTML omitted --> button. This produces a structure with much more aesthetically-pleasing atom coordinates:</p>
<p><img src="/images/posts/20061218/screenshot_2.png" alt="&ldquo;Cleaned up Molecule&rdquo;" title="Cleaned up Molecule"></p>
<p>If Bob needs to continue drawing at this point he can. In fact, he can press <!-- raw HTML omitted -->Clean Molecule<!-- raw HTML omitted --> as many times as he wants to clean his structure at any time. Each time he presses the button, his structure is retained within the JME window.</p>
<h1 id="download-and-prerequisites">Download and Prerequisites</h1>
<p>Cleanup requires <!-- raw HTML omitted -->Ruby on Rails<!-- raw HTML omitted --> and <!-- raw HTML omitted -->Ruby CDK<!-- raw HTML omitted -->. Both of these libraries can be installed using the <!-- raw HTML omitted -->RubyGems<!-- raw HTML omitted --> packaging system.</p>
<p>A recent article described the small amount of system configuration required for <!-- raw HTML omitted -->Ruby CDK on Linux<!-- raw HTML omitted -->. Another article showed how to install <!-- raw HTML omitted -->Ruby CDK on Windows<!-- raw HTML omitted -->.</p>
<p>The <!-- raw HTML omitted -->complete Cleanup source package<!-- raw HTML omitted --> can be downloaded from RubyForge. For convenience, a copy of JME is included with the distribution. The author, Peter Ertl, has kindly given permission for the bundled JME applet to be used with Cleanup. For other uses, consult the <!-- raw HTML omitted -->JME homepage<!-- raw HTML omitted -->.</p>
<h1 id="running-cleanup">Running Cleanup</h1>
<p>After inflating the Cleanup archive, the following commands will start the server:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd jme-cleanup-0.0.1
</span></span><span style="display:flex;"><span>ruby script/server
</span></span></code></pre></div><p>AMD64 Linux users will need to prepend a <!-- raw HTML omitted -->LD_PRELOAD<!-- raw HTML omitted --> assignment to the <!-- raw HTML omitted -->script/server<!-- raw HTML omitted --> invocation. On my system, which uses Sun&rsquo;s JDK, this looks like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd jme-cleanup-0.0.1
</span></span><span style="display:flex;"><span>LD_PRELOAD<span style="color:#f92672">=</span>/usr/java/jdk1.5.0_09/jre/lib/amd64/libzip.so ruby script/server
</span></span></code></pre></div><p>After starting the Cleanup server, pointing your browser to <!-- raw HTML omitted -->http://localhost:3000/editor/cleanup<!-- raw HTML omitted --> will run the application.</p>
<h1 id="how-it-works-a-web-application-in-two-parts">How It Works: A Web Application in Two Parts</h1>
<p>Cleanup is a Web application consisting of two main parts - one written for a Web server, and one written for a Browser client. These two components work together to achieve an effect that, to a user, is indistinguishable from extending the JME applet with Java.</p>
<p>The first component consists of small Rails application that accepts a Molfile as input and produces a Molfile with re-assigned coordinates as output. A Rails Action, <!-- raw HTML omitted -->clean_structure<!-- raw HTML omitted --> accepts a Molfile encoded as form data and produces a response Molfile with re-assigned coordinates.</p>
<p>The second component of the Cleanup application is written in JavaScript and executed from within the Browser. Let&rsquo;s take a look:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">* Returns the client-specific version of XMLHttpRequest
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createXHR</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">xhr</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">xhr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ActiveXObject</span>(<span style="color:#e6db74">&#34;Msxml2.XMLHTTP&#34;</span>); <span style="color:#75715e">// IE 5.0+
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">xhr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ActiveXObject</span>(<span style="color:#e6db74">&#34;Microsoft.XMLHTTP&#34;</span>); <span style="color:#75715e">// IE 5.0-
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">E</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">xhr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">xhr</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">XMLHttpRequest</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;undefined&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">xhr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>(); <span style="color:#75715e">// every other browser
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">xhr</span>;  
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">cleanStructure</span>() {       
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">molfile</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">jme</span>.<span style="color:#a6e22e">molFile</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">xhr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createXHR</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#34;GET&#34;</span>, <span style="color:#e6db74">&#34;clean_structure?molfile=&#34;</span> <span style="color:#f92672">+</span> encodeURIComponent(<span style="color:#a6e22e">molfile</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">onreadystatechange</span><span style="color:#f92672">=</span><span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">readyState</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">4</span>) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">cleanMolfile</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">responseText</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    document.<span style="color:#a6e22e">jme</span>.<span style="color:#a6e22e">readMolFile</span>(<span style="color:#a6e22e">cleanMolfile</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">send</span>(<span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>As you can see, the client side of Cleanup consists of two JavaScript functions, <!-- raw HTML omitted -->createXHR<!-- raw HTML omitted --> and <!-- raw HTML omitted -->cleanStructure<!-- raw HTML omitted -->.</p>
<p>The purpose of <!-- raw HTML omitted -->createXHR<!-- raw HTML omitted --> is to return a valid instance of the central Ajax JavaScript object, <!-- raw HTML omitted -->XMLHttpRequest<!-- raw HTML omitted -->. This function is a standard idiom in Ajax programming, and many JavaScript toolkits eliminate the need to write it explicitly. The function is included here mainly for the purpose of illustration. Microsoft browsers define two different flavors of <!-- raw HTML omitted -->XMLHttpRequest<!-- raw HTML omitted -->, and both differ from the flavor supported by every other browser. To take this browser-specific behavior into account, a series of try/catch blocks are used.</p>
<p>The second function, <!-- raw HTML omitted -->cleanStructure<!-- raw HTML omitted --> does all of the JME-specific work. After obtaining an instance of <!-- raw HTML omitted -->XMLHttpRequest<!-- raw HTML omitted -->, a HTTP GET request is built from JME&rsquo;s molfile. Of course, the magic of this request is that it is <!-- raw HTML omitted -->asynchronous<!-- raw HTML omitted -->; it will not block the browser while it is being processed. When the request is complete, the cleaned Molfile is read by JME.</p>
<p>Through the coordinated action of both of Cleanup&rsquo;s components, the application gives the appearance that JME has cleaned its own structure.</p>
<h1 id="so-what">So What?</h1>
<p>Well-designed, rich functionality makes software interesting and useful. At the same time, users demand software that loads and responds quickly. Using the technique presented here, it&rsquo;s possible to satisfy both of these contradictory requirements. Delegating key tasks to a server obviates the need to transmit large Java libraries to clients. Instead, small Java libraries can be transmitted, and several small asynchronous requests will be processed along the way.</p>
<p>Viewed from this perspective, the capabilities of a good Java applet take on a very different character from what many have become accustomed to. In particular, extensibility and a robust, text-based communication protocol become much more important than built-in features.</p>
<p>For example, we could provide a much more consistent user experience if the <!-- raw HTML omitted -->Clean Molfile<!-- raw HTML omitted --> button were contained inside the JME editor itself, instead of on the Web page. In a more general sense, we&rsquo;d like JME to offer the option of defining custom buttons that can be assigned arbitrary actions. Because Java/JavaScript integration is very well-supported, these custom actions could actually be written in JavaScript.</p>
<h1 id="conclusions">Conclusions</h1>
<p>Java applets have been much maligned of late, partly due to the realization that in many situations they can be replaced with Ajax. However, well-designed, small, and extensible Java applets can play a key role in certain kinds of Ajax applications such as the one described here. Future articles in this series will explore some more of the many possibilities.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  Depth-First 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
