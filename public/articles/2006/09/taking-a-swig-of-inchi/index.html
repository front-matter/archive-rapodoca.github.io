<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Taking a SWIG of InChI | Depth-First</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="The IUPAC InChI developer toolkit is written in C. It is currently the only Open Source software capable of generating InChI identifiers. Software that needs to write InChIs must use the C toolkit in one form or another. This poses a problem for the large amount of chemical informatics software being written in other languages. In this article, I&rsquo;ll explain how the Open Source tool SWIG can solve this problem in a semi-automated way. The same concepts can, in principle, be used to link any library written in C/C&#43;&#43; with another language.">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/articles/2006/09/taking-a-swig-of-inchi/">
    

    <meta property="og:url" content="http://localhost:1313/articles/2006/09/taking-a-swig-of-inchi/">
  <meta property="og:site_name" content="Depth-First">
  <meta property="og:title" content="Taking a SWIG of InChI">
  <meta property="og:description" content="The IUPAC InChI developer toolkit is written in C. It is currently the only Open Source software capable of generating InChI identifiers. Software that needs to write InChIs must use the C toolkit in one form or another. This poses a problem for the large amount of chemical informatics software being written in other languages. In this article, I’ll explain how the Open Source tool SWIG can solve this problem in a semi-automated way. The same concepts can, in principle, be used to link any library written in C/C&#43;&#43; with another language.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="articles">
    <meta property="article:published_time" content="2006-09-16T00:00:00+00:00">
    <meta property="article:modified_time" content="2006-09-16T00:00:00+00:00">

  <meta itemprop="name" content="Taking a SWIG of InChI">
  <meta itemprop="description" content="The IUPAC InChI developer toolkit is written in C. It is currently the only Open Source software capable of generating InChI identifiers. Software that needs to write InChIs must use the C toolkit in one form or another. This poses a problem for the large amount of chemical informatics software being written in other languages. In this article, I’ll explain how the Open Source tool SWIG can solve this problem in a semi-automated way. The same concepts can, in principle, be used to link any library written in C/C&#43;&#43; with another language.">
  <meta itemprop="datePublished" content="2006-09-16T00:00:00+00:00">
  <meta itemprop="dateModified" content="2006-09-16T00:00:00+00:00">
  <meta itemprop="wordCount" content="1082">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Taking a SWIG of InChI">
  <meta name="twitter:description" content="The IUPAC InChI developer toolkit is written in C. It is currently the only Open Source software capable of generating InChI identifiers. Software that needs to write InChIs must use the C toolkit in one form or another. This poses a problem for the large amount of chemical informatics software being written in other languages. In this article, I’ll explain how the Open Source tool SWIG can solve this problem in a semi-automated way. The same concepts can, in principle, be used to link any library written in C/C&#43;&#43; with another language.">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Depth-First
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Articles
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Taking a SWIG of InChI</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2006-09-16T00:00:00Z">September 16, 2006</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>The IUPAC InChI <!-- raw HTML omitted -->developer toolkit<!-- raw HTML omitted --> is written in C. It is currently the only Open Source software capable of generating <!-- raw HTML omitted -->InChI identifiers<!-- raw HTML omitted -->. Software that needs to write InChIs must use the C toolkit in one form or another. This poses a problem for the large amount of chemical informatics software being written in other languages. In this article, I&rsquo;ll explain how the Open Source tool <!-- raw HTML omitted -->SWIG<!-- raw HTML omitted --> can solve this problem in a semi-automated way. The same concepts can, in principle, be used to link any library written in C/C++ with another language.</p>
<h1 id="prerequisites">Prerequisites</h1>
<p>This tutorial uses Ruby as the language that InChI will be linked with. You&rsquo;ll therefore need both Ruby and the Ruby development libraries installed. You&rsquo;ll also need SWIG and possibly the SWIG development libraries.</p>
<h1 id="use-the-source-luke">Use the Source, Luke</h1>
<p>After downloading and unpacking <!-- raw HTML omitted -->InChI-1-API  v1.0.1<!-- raw HTML omitted -->, collect all header (<em>.h) and source (</em>.c) files into a directory called <code>inchi</code>. These files can be found in the following two directories:</p>
<ul>
<li><code>InChI-1-API/cInChI/common</code></li>
<li><code>InChI-1-API/cInChI/main</code></li>
</ul>
<h1 id="find-the-main-method">Find the Main Method</h1>
<p>This tutorial will create an interface into the InChI <code>main()</code> function. This function is found on line
149 of the file <code>ichimain.c</code>. For reasons I won&rsquo;t get into here, rename this method <code>run</code> and change the second argument type to char **. Also, add a prototype for the <code>run</code> function directly above line 149:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">run</span>( <span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv ); <span style="color:#75715e">// new line added
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">run</span>( <span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv ) <span style="color:#75715e">// formerly line 149
</span></span></span></code></pre></div><h1 id="create-the-interface-file">Create the Interface File</h1>
<p>The focal point of SWIG is the interface file. This file specifies the C functions you want to link into and some items to help in doing so. Create a file called <code>libinchi.i</code> containing the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">/* The name of this module. */</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span>module libinchi
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Tells SWIG to treat char ** as a special case.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#a6e22e">typemap</span>(in) (<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">/* Get the length of the array */</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">int</span> size <span style="color:#f92672">=</span> <span style="color:#a6e22e">RARRAY</span>(<span style="color:#960050;background-color:#1e0010">$</span>input)<span style="color:#f92672">-&gt;</span>len; 
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">int</span> i;
</span></span><span style="display:flex;"><span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">=</span> (<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#ae81ff">1</span>_ltype) size;
</span></span><span style="display:flex;"><span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>) <span style="color:#a6e22e">malloc</span>((size<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span><span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">/* Get the first element in memory */</span>
</span></span><span style="display:flex;"><span> VALUE <span style="color:#f92672">*</span>ptr <span style="color:#f92672">=</span> <span style="color:#a6e22e">RARRAY</span>(<span style="color:#960050;background-color:#1e0010">$</span>input)<span style="color:#f92672">-&gt;</span>ptr; 
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">for</span> (i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> size; i<span style="color:#f92672">++</span>, ptr<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">/* Convert Ruby Object String to char* */</span>
</span></span><span style="display:flex;"><span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#ae81ff">2</span>[i]<span style="color:#f92672">=</span> <span style="color:#a6e22e">STR2CSTR</span>(<span style="color:#f92672">*</span>ptr); 
</span></span><span style="display:flex;"><span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#ae81ff">2</span>[i]<span style="color:#f92672">=</span>NULL; <span style="color:#75715e">/* End of list */</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Cleans up the char ** array created before 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * the function call.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#a6e22e">typemap</span>(freearg) <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">free</span>((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>) <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Function definition from ichimain.c.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">extern</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">run</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv);
</span></span></code></pre></div><p>The interface file has three main parts. The first part (line 2) names the module. The second part (lines 7-30) makes the necessary Ruby/C datatype conversions. The last part (line 35) tells SWIG the InChI functions we want to be able to access from Ruby.</p>
<h1 id="take-a-swig">Take a SWIG</h1>
<p>At this point, SWIG has everything it needs to autogenerate our glue code. This can be done by:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>swig -ruby libinchi.i
</span></span></code></pre></div><p>This command should have created a new source file, <code>libinchi_wrap.c</code>, that contains all of the C glue code for our library. We&rsquo;ll have a look at the most important part of this file shortly.</p>
<h1 id="create-a-makefile">Create a Makefile</h1>
<p>We&rsquo;ll need a makefile with which to compile our library. Fortunately, Ruby makes this very easy. Create a file called <code>extconf.rb</code> containing the following Ruby code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;mkmf&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>create_makefile(<span style="color:#e6db74">&#39;libinchi&#39;</span>)
</span></span></code></pre></div><p>A makefile can now be generated by:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ruby extconf.rb
</span></span></code></pre></div><h1 id="build-the-library">Build the Library</h1>
<p>Our library can now be built with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make
</span></span></code></pre></div><h1 id="use-inchi-from-ruby">Use InChI from Ruby</h1>
<p>We are now done with the basics. You can verify that the process worked through Interactive Ruby (irb):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>irb
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:001:0&gt; require <span style="color:#e6db74">&#39;libinchi&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; true
</span></span></code></pre></div><p>The return value of <code>true</code> shows that Ruby loaded and recognized the binary library we just built (<code>libinchi.so</code>). We are now able to use this library as if it were written in Ruby.</p>
<h1 id="use-the-library">Use the Library</h1>
<p>To test the library, copy a molfile called <code>test.mol</code> into your <code>inchi</code> directory. Now run this code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;libinchi&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Libinchi</span><span style="color:#f92672">.</span>run(<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;test.mol&#39;</span><span style="color:#f92672">]</span>)
</span></span></code></pre></div><p>You should get a lot of output from the InChI libary. If you take a look at the <code>inchi</code> directory contents, a new file, <code>test.mol.txt</code>, has been created. It contains the InChI identifier of the molecule contained in your molfile. This software also created a log file (<code>test.mol.log</code>) and a problem file (<code>test.mol.prb</code>).</p>
<p>You may be wondering why the first element in the <code>Array</code> passed to <code>Libinchi.run</code> is empty. The reason is that by convention a C <code>main</code> method expects its first argument to be the name of the program itself. The InChI <code>main</code> method takes this into account, and so the Array simply leaves its first element blank.</p>
<h1 id="customize-the-library">Customize the Library</h1>
<p>Have a look at the <code>libinchi_wrap.c</code> file that SWIG created. At the bottom of this file should be a function called <code>Init_libinchi</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">SWIGEXPORT</span>(<span style="color:#66d9ef">void</span>) <span style="color:#a6e22e">Init_libinchi</span>(<span style="color:#66d9ef">void</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> i;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">SWIG_InitRuntime</span>();
</span></span><span style="display:flex;"><span>  mLibinchi <span style="color:#f92672">=</span> <span style="color:#a6e22e">rb_define_module</span>(<span style="color:#e6db74">&#34;Libinchi&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; swig_types_initial[i]; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    swig_types[i] <span style="color:#f92672">=</span> <span style="color:#a6e22e">SWIG_TypeRegister</span>(swig_types_initial[i]);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">SWIG_define_class</span>(swig_types[i]);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rb_define_module_function</span>(mLibinchi, <span style="color:#e6db74">&#34;run&#34;</span>, _wrap_run, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>}  
</span></span></code></pre></div><p>This is what Ruby uses to map C functions to Ruby modules, classes, and methods. In this case, the C <code>run</code> method is being mapped to a module called <code>Libinchi</code> which has a <code>run</code> method.</p>
<p>Let&rsquo;s say that you&rsquo;d prefer a module name of <code>InChI</code> with a method called <code>write_inchi</code>. The following changes to <code>Init_libinchi</code> will accomplish this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">SWIGEXPORT</span>(<span style="color:#66d9ef">void</span>) <span style="color:#a6e22e">Init_libinchi</span>(<span style="color:#66d9ef">void</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> i;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">SWIG_InitRuntime</span>();
</span></span><span style="display:flex;"><span>  mLibinchi <span style="color:#f92672">=</span> <span style="color:#a6e22e">rb_define_module</span>(<span style="color:#e6db74">&#34;InChI&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; swig_types_initial[i]; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    swig_types[i] <span style="color:#f92672">=</span> <span style="color:#a6e22e">SWIG_TypeRegister</span>(swig_types_initial[i]);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">SWIG_define_class</span>(swig_types[i]);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rb_define_module_function</span>(mLibinchi, <span style="color:#e6db74">&#34;write_inchi&#34;</span>, _wrap_run, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Run <code>make</code> again. Now the following can be used to write the InChI information for <code>test.mol</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;libinchi&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">InChI</span><span style="color:#f92672">.</span>write_inchi(<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;test.mol&#39;</span><span style="color:#f92672">]</span>)
</span></span></code></pre></div><h1 id="summing-up">Summing Up</h1>
<p>SWIG simplifies the job of connecting high-level languages like Ruby to C/C++ libraries. Although not illustrated in the simple example above, SWIG offers several advanced tools for creating rich library interfaces. Given the large amount of chemical informatics software written in C/C++, and the increasing interest by developers in scripting languages such as Ruby, the SWIG approach is likely to be broadly useful in several areas of chemical informatics integration.</p>
<p>The C InChI toolkit appears in a few other Open Source projects including <!-- raw HTML omitted -->Open Babel<!-- raw HTML omitted -->, the <!-- raw HTML omitted -->Chemistry Development Kit<!-- raw HTML omitted --> via the <!-- raw HTML omitted -->JNI InChI Wrapper<!-- raw HTML omitted -->, and <!-- raw HTML omitted -->Rino<!-- raw HTML omitted -->. To my knowledge, none use SWIG. This will soon change as the approach described here becomes incorporated into Rino.</p>
<p>On a more general note, the availability of the InChI source code under an <!-- raw HTML omitted -->Open Source license<!-- raw HTML omitted --> is essential to developing and distributing the kind of integration library discussed here. We can only hope that others working in chemical informatics see the wisdom in  a system that creates healthy <!-- raw HTML omitted -->software ecosystems<!-- raw HTML omitted --> wherever it takes hold.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  Depth-First 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
