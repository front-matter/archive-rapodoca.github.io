<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Big Data in Chemistry: Mirroring PubChem the Easy Way | Depth-First</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="PubChem&rsquo;s massive size presents special challenges when working with this chemical dataset. Synchronization in particular requires special care. Although it&rsquo;s very easy to use a tool such as wget to perform a complete, one-time download PubChem&rsquo;s archive files, this approach scales poorly if our goal is to maintain a copy that&rsquo;s always up-to-date. The PubChem dataset&rsquo;s substantial size makes it impractical to download frequently, and especially problematic when an up-to-date local copy is needed quickly.">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/articles/2010/02/08/big-data-in-chemistry-mirroring-pubchem-the-easy-way/">
    

    <meta property="og:url" content="http://localhost:1313/articles/2010/02/08/big-data-in-chemistry-mirroring-pubchem-the-easy-way/">
  <meta property="og:site_name" content="Depth-First">
  <meta property="og:title" content="Big Data in Chemistry: Mirroring PubChem the Easy Way">
  <meta property="og:description" content="PubChem’s massive size presents special challenges when working with this chemical dataset. Synchronization in particular requires special care. Although it’s very easy to use a tool such as wget to perform a complete, one-time download PubChem’s archive files, this approach scales poorly if our goal is to maintain a copy that’s always up-to-date. The PubChem dataset’s substantial size makes it impractical to download frequently, and especially problematic when an up-to-date local copy is needed quickly.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="articles">
    <meta property="article:published_time" content="2010-02-08T00:00:00+00:00">
    <meta property="article:modified_time" content="2010-02-08T00:00:00+00:00">

  <meta itemprop="name" content="Big Data in Chemistry: Mirroring PubChem the Easy Way">
  <meta itemprop="description" content="PubChem’s massive size presents special challenges when working with this chemical dataset. Synchronization in particular requires special care. Although it’s very easy to use a tool such as wget to perform a complete, one-time download PubChem’s archive files, this approach scales poorly if our goal is to maintain a copy that’s always up-to-date. The PubChem dataset’s substantial size makes it impractical to download frequently, and especially problematic when an up-to-date local copy is needed quickly.">
  <meta itemprop="datePublished" content="2010-02-08T00:00:00+00:00">
  <meta itemprop="dateModified" content="2010-02-08T00:00:00+00:00">
  <meta itemprop="wordCount" content="673">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Big Data in Chemistry: Mirroring PubChem the Easy Way">
  <meta name="twitter:description" content="PubChem’s massive size presents special challenges when working with this chemical dataset. Synchronization in particular requires special care. Although it’s very easy to use a tool such as wget to perform a complete, one-time download PubChem’s archive files, this approach scales poorly if our goal is to maintain a copy that’s always up-to-date. The PubChem dataset’s substantial size makes it impractical to download frequently, and especially problematic when an up-to-date local copy is needed quickly.">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Depth-First
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Articles
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Big Data in Chemistry: Mirroring PubChem the Easy Way</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2010-02-08T00:00:00Z">February 8, 2010</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>PubChem&rsquo;s massive size presents special challenges when working with this chemical dataset. Synchronization in particular requires special care. Although it&rsquo;s very easy to use a tool such as <a href="http://www.gnu.org/software/wget/">wget</a> to perform a complete, one-time download PubChem&rsquo;s archive files, this approach scales poorly if our goal is to maintain a copy that&rsquo;s always up-to-date. The PubChem dataset&rsquo;s substantial size makes it impractical to download frequently, and especially problematic when an up-to-date local copy is needed quickly.</p>
<p>This article describes a simple way to create a low-maintenance, low-bandwidth, up-to-date local mirror of PubChem using two Unix tools.</p>
<h1 id="what-it-does">What It Does</h1>
<p>The method described here will create two directories on your filesystem that will exactly mirror the contents of the PubChem Compound and Substance archives, respectively. A simple command, which can either be run as a nightly cron job or on demand, will efficiently bring these local files up-to-date with PubChem whenever it&rsquo;s run.</p>
<p>#Step 1. Create A Workspace and Mount PubChem FTP Site</p>
<p>We&rsquo;re going to need a workspace. In this workspace, we&rsquo;ll first create a mountpoint for the PubChem FTP site archives, then we&rsquo;ll mount the archives:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir workspace
</span></span><span style="display:flex;"><span>cd workspace
</span></span><span style="display:flex;"><span>mkdir -p ftp.ncbi.nlm.nih.gov/pubchem
</span></span><span style="display:flex;"><span>curlftpfs ftp.ncbi.nlm.nih.gov/pubchem/ ftp.ncbi.nlm.nih.gov/pubchem/
</span></span></code></pre></div><p>My Linux distribution (Ubuntu Karmic) gives me the error message:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>fusermount: failed to open /etc/fuse.conf: Permission denied
</span></span></code></pre></div><p>which doesn&rsquo;t seem to matter. The FTP site is mounted, as I can see by listing the top-level entries:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ls ftp.ncbi.nlm.nih.gov/pubchem
</span></span><span style="display:flex;"><span>Bioassay  Compound     data_spec     README	     Substance
</span></span><span style="display:flex;"><span>CACTVS	  Compound_3D  publications  specifications
</span></span></code></pre></div><p>We can unmount the PubChemFTP site with fusermount:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>fusermount -u ftp.ncbi.nlm.nih.gov/pubchem/
</span></span></code></pre></div><h1 id="step-2-create-synchronization-directories-and-transfer-files">Step 2. Create Synchronization Directories and Transfer Files</h1>
<p>Next, let&rsquo;s create two directories to hold the PubChem files - one for Compounds and one for Substances:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir substances
</span></span><span style="display:flex;"><span>mkdir compounds
</span></span></code></pre></div><p>Now comes the magic. We&rsquo;ll use <a href="http://samba.anu.edu.au/rsync/">rsync</a> to copy the contents of the mounted FTP archive into each of our local directories. First, we synchronize the Compounds:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>rsync -r -t -v --progress --bwlimit<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>  --include<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*/&#39;</span> --include<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*.sdf.gz&#39;</span> --exclude<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*&#39;</span> ftp.ncbi.nlm.nih.gov/pubchem/Compound/CURRENT-Full/SDF/ compounds
</span></span></code></pre></div><p>This is going to take nearly 24 hours.</p>
<p>The option <em>&ndash;bwlimit</em> sets the maximum bandwidth (in Mb/S). The <em>&ndash;include</em> and <em>&ndash;exclude</em> options say that we&rsquo;re only interested in gzipped sd files.</p>
<p>We synchronize Substance records analogously:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>rsync -r -t -v --progress --bwlimit<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>  --include<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*/&#39;</span> --include<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*.sdf.gz&#39;</span> --exclude<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*&#39;</span> ftp.ncbi.nlm.nih.gov/pubchem/Substance/CURRENT-Full/SDF/ substances
</span></span></code></pre></div><p>This command will take even longer to run.</p>
<h1 id="step-3-there-is-no-step-3">Step 3. There Is No Step 3</h1>
<p>That&rsquo;s really all there is to it. Every time we run the rsync command, we&rsquo;ll synchronize our local copy of the PubChem archive with the one on the PubChem FTP server. PubChem ensures that these archives are always current, so every time we synchronize, we&rsquo;ll have up-to-date files.</p>
<h1 id="why-rsync">Why RSync?</h1>
<p>RSync ensures that our synchronizations will be as efficient as possible by only downloading the archive files that change. From time to time, old records are updated in PubChem, and these changes appear as a new archive file that replaces an old archive file. The new file gets an updated timestamp. If you check out the <a href="ftp://ftp.ncbi.nlm.nih.gov/pubchem/Compound/CURRENT-Full/SDF/">Compounds FTP directory</a> you&rsquo;ll notice several different timestamps reflecting the various updates of existing records. New records appear as new archive files.</p>
<p>The genius of RSync is that it performs an incremental backup; files that haven&rsquo;t changed since our last update are never downloaded.</p>
<p>We can even take this incremental backup idea one step further. Although I don&rsquo;t yet know if PubChem supports it, it&rsquo;s possible to <a href="http://beeznest.wordpress.com/2005/02/03/rsyncable-gzip/">create GZip archives optimized for rsync</a>. This uses a variant of the GZip compression algorithm that makes it possible to transmit only the section of a gzip file that&rsquo;s actually changed, keeping network traffic to an absolute minimum.</p>
<p>This rsyncable archive capability is built into most gzip binary distributions.</p>
<h1 id="conclusions">Conclusions</h1>
<p>Creating and maintaining your own up-to-date, verbatim copy of PubChem is both simple and inexpensive. The trick is to first mount the FTP archive using curlftpfs and then use rsync to perform an incremental backup of the mounted archive. The method described here works equally well as a cron job or an ad hoc command.</p>
<p><em>Credits: <a href="http://www.wikihow.com/Mirror-an-FTP-Directory-With-Rsync-and-Curlftpfs">Mirror an FTP Directory with RSync and Curlftps</a>; <a href="http://beeznest.wordpress.com/2005/02/03/rsyncable-gzip/">Rsyncable gzip</a></em></p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  Depth-First 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
