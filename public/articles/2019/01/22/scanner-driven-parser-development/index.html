<!DOCTYPE html>
<html lang="en-us" dir="ltr" class="scroll-smooth" data-default-appearance="light"
  data-auto-appearance="true"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en-us" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Scanner-Driven Parser Development &middot; Depth-First</title>
  <meta name="title" content="Scanner-Driven Parser Development &middot; Depth-First" />
  
  <meta name="description" content="Writing a parser shouldn&#39;t require unnecessary detours into linguistic theory or unproductive coding dead-ends. Find out how to start and finish a parser quickly with this in-depth guide." />
  
  
  
  <link rel="canonical" href="http://localhost:1313/articles/2019/01/22/scanner-driven-parser-development/" />
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.e27868ab1485f7ed7b06b122b4980bd38b19526eb8f7de885181204d28f04a0c47e9c334eff19a06c0278eb2ff8415b983a5d0fb80fd6b5680c926457cc61c57.css"
    integrity="sha512-4nhoqxSF9&#43;17BrEitJgL04sZUm64996IUYEgTSjwSgxH6cM07/GaBsAnjrL/hBW5g6XQ&#43;4D9a1aAySZFfMYcVw==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.c178288131a2f1ad46910438db47ac5f7e1c48cf949e49f6dc3310c8ec9660e23fe505805eba4e2e73711335808500360d773a2b64322feb35df52856edca286.js"
    integrity="sha512-wXgogTGi8a1GkQQ420esX34cSM&#43;Unkn23DMQyOyWYOI/5QWAXrpOLnNxEzWAhQA2DXc6K2QyL&#43;s131KFbtyihg==" data-copy="" data-copied=""></script>
  
  
  
  <script src="/lib/zoom/zoom.min.37d2094687372da3f7343a221a470f6b8806f7891aa46a5a03966af7f0ebd38b9fe536cb154e6ad28f006d184b294525a7c4054b6bbb4be62d8b453b42db99bd.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S&#43;Yti0U7QtuZvQ=="></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="http://localhost:1313/articles/2019/01/22/scanner-driven-parser-development/">
  <meta property="og:site_name" content="Depth-First">
  <meta property="og:title" content="Scanner-Driven Parser Development">
  <meta property="og:description" content="Writing a parser shouldn’t require unnecessary detours into linguistic theory or unproductive coding dead-ends. Find out how to start and finish a parser quickly with this in-depth guide.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-01-22T15:30:00+00:00">
    <meta property="article:modified_time" content="2019-01-22T15:30:00+00:00">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Scanner-Driven Parser Development">
  <meta name="twitter:description" content="Writing a parser shouldn’t require unnecessary detours into linguistic theory or unproductive coding dead-ends. Find out how to start and finish a parser quickly with this in-depth guide.">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Scanner-Driven Parser Development",
    "headline": "Scanner-Driven Parser Development",
    
    "abstract": "Writing a parser shouldn\u0026rsquo;t require unnecessary detours into linguistic theory or unproductive coding dead-ends. Find out how to start and finish a parser quickly with this in-depth guide.",
    "inLanguage": "en-us",
    "url" : "http:\/\/localhost:1313\/articles\/2019\/01\/22\/scanner-driven-parser-development\/",
    "author" : {
      "@type": "Person",
      "name": ""
    },
    "copyrightYear": "2019",
    "dateCreated": "2019-01-22T15:30:00\u002b00:00",
    "datePublished": "2019-01-22T15:30:00\u002b00:00",
    
    "dateModified": "2019-01-22T15:30:00\u002b00:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "2122"
  }]
  </script>


  
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>






















  
  



  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a>
  </div>
  
  
  <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3">
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">Depth-First</a>
            

        </nav>
        <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class="ltr:mr-14 rtl:ml-14 flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center space-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400" style="margin-right:5px">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 -mr-2 md:hidden">

        <label id="menu-button" class="block">
            

            </div>
        </label>
    </div>
</div>





  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      Scanner-Driven Parser Development
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2019-01-22T15:30:00&#43;00:00">January 22, 2019</time><span class="px-2 text-primary-500">&middot;</span><span>2122 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">10 mins</span>
  

  
  
</div>








    </div>

    
    
    
    
    

    

    
      
      
        
        
<div class="flex author">
  
  <div class="place-self-center">
    
    
    <div class="text-2xl sm:text-lg">
</div>
  </div>
</div>

      

      

      
      <div class="mb-5"></div>
      

    

  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
    

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          <p>Writing a parser from scratch can be a daunting task. For a beginner, the topic may seem barricaded behind a thick wall of theory and vocabulary. Getting to the heart of the matter, running code, can take a lot of time and effort. This article describes a shift in thinking that can significantly reduce the time needed to get started and finish. The examples are written in JavaScript, but the underlying principles can can be adapted to any programming language.</p>


<h1 class="relative group">Parsing in a Nutshell 
    <div id="parsing-in-a-nutshell" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#parsing-in-a-nutshell" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>For the purposes of this article, a parser is a function that accepts a string conforming to some set of rules as input and returns an object representing the string&rsquo;s syntax as output. Input strings are evaluated one character at a time from left-to-right until either all characters are consumed or an invalid character is found.</p>
<p>The following function template captures the essence of a parser:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {string} string input to be parsed
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @returns {*} representation of string&#39;s syntax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @throws {Error} given invalid string
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">parse</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">string</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// parse string, return representation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};
</span></span></code></pre></div><p>Writing a parser boils down to completing the body of a <code>parse</code> function consistent with a set of predefined rules.</p>


<h1 class="relative group">Embrace Constraints 
    <div id="embrace-constraints" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#embrace-constraints" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>Like most problems, writing a parser becomes much easier by embracing some well-chosen constraints. Scanner-Driven Development requires two:</p>
<ol>
<li>Characters are read left-to-right, one at a time.</li>
<li>Only one character of lookahead is allowed.</li>
</ol>
<p>The second point deserves some explanation. <em>Lookahead</em> refers to how many characters beyond the current reading position your parser will be allowed to &ldquo;peek,&rdquo; or read without consuming characters. Restricting lookahead to one character simplifies the <code>parse</code> function by reducing the need to <em>backtrack</em>. Backtracking is a procedure that restores a parser to some previous state after following a dead end. One character lookahead allows the program&rsquo;s stack frame to be used for backtracking without maintaining additional state.</p>


<h1 class="relative group">A Minimal Scanner 
    <div id="a-minimal-scanner" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#a-minimal-scanner" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>The centerpiece of Scanner-Driven Parser Development is a <em>Scanner</em>. A Scanner wraps a string, dividing it into two regions with a cursor. Before the cursor, characters are completely inaccessible. After the cursor, characters can be read either with or without advancing the cursor.</p>
<p>Some languages (such as <a href="http://ruby-doc.org/stdlib-2.5.3/libdoc/strscan/rdoc/StringScanner.html" target="_blank">Ruby</a>) include a <code>Scanner</code> class. Although JavaScript has none, a minimal <code>Scanner</code> is easy to implement:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">Scanner</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">class</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">constructor</span> (<span style="color:#a6e22e">string</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_string</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">string</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_cursor</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @return {number}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">get</span> <span style="color:#a6e22e">cursor</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_cursor</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Returns the next character, or &#39;&#39; if done without advancing the cursor.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @return {string} a single character or &#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">peek</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_string</span>[<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_cursor</span>];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Returns the next character, or &#39;&#39; if done. Advances the cursor.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @return {string} a single character or &#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">pop</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_string</span>[<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_cursor</span><span style="color:#f92672">++</span>];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div>

<h1 class="relative group">Using a Scanner 
    <div id="using-a-scanner" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#using-a-scanner" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>Rather than using a string directly to implement the <code>parse</code> function, commit yourself to only interacting with a string through a <code>Scanner</code> instance. Here are some example uses:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">scanner</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Scanner</span>(<span style="color:#e6db74">&#39;abc&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">cursor</span>;  <span style="color:#75715e">// =&gt; 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">peek</span>();  <span style="color:#75715e">// =&gt; &#39;a&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">pop</span>();   <span style="color:#75715e">// =&gt; &#39;a&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">peek</span>();  <span style="color:#75715e">// =&gt; &#39;b&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">pop</span>();   <span style="color:#75715e">// =&gt; &#39;b&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">peek</span>();  <span style="color:#75715e">// =&gt; &#39;c&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">cursor</span>;  <span style="color:#75715e">// =&gt; 2
</span></span></span></code></pre></div><p>Here&rsquo;s a more complex example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">scanner</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Scanner</span>(<span style="color:#e6db74">&#39;abc&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">peek</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">char</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">pop</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">peek</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Notice that <code>Scanner</code> can only return the character immediately following the cursor. <code>Scanner</code> moves forward over the characters of a string, never backward.</p>
<p>Given a <code>Scanner</code>, the original goal for the <code>parse</code> function can be recast as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">parse</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">string</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">scanner</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Scanner</span>(<span style="color:#a6e22e">string</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// parse string using only scanner, then return result
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};
</span></span></code></pre></div>

<h1 class="relative group">Grammar and Syntax Diagrams 
    <div id="grammar-and-syntax-diagrams" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#grammar-and-syntax-diagrams" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>Before writing the <code>parse</code> function, a <em>formal grammar</em> (aka &ldquo;grammar&rdquo;) will be needed. Think of a grammar as a blueprint for the functions to be written. Grammars can be represented in many ways, one of the most popular of which is <a href="https://en.wikipedia.org/wiki/Backus%e2%80%93Naur_form" target="_blank">Backus-Naur Form</a> (BNF).</p>
<p>I find the equivalent <a href="https://en.wikipedia.org/wiki/Syntax_diagram" target="_blank">Syntax Diagram</a> to be more readable. One of the best-known examples defines <a href="https://www.json.org" target="_blank">JSON</a>. Here&rsquo;s a fragment that explains how to produce a JSON &ldquo;number:&rdquo;</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/images/posts/20190122/number.gif" alt="JSON Number" />
      <figcaption>JSON Number</figcaption>
    </figure>
</p>
<p>This image depicts a &ldquo;production rule.&rdquo; A grammar is simply a collection of production rules that may refer to each other or even themselves. Each production rule describes how to produce one element of a grammar or alternatively how to <em>parse</em> a single element.</p>
<p>To interpret a syntax diagram, begin at the leftmost single/double vertical line and proceed to the rightmost single/double vertical line. Any item lying on a horizontal line is mandatory. Branches may be followed in their direction of curvature.</p>
<p>For example, starting at the leftmost side of the &ldquo;number&rdquo; production rule, we encounter a branch. Following it adds a negative sign to the number. Next comes another branch. Following it adds a non-zero digit (1&hellip;9) followed by an optional digit (0&hellip;9). But rather than doing that, we can instead append a zero digit. Next, we can add an optional decimal point followed by at least one digit. Finally, we can optionally add an exponent using either a lower- or upper-case letter &ldquo;E.&rdquo;</p>
<p>A few tools can generate syntax diagrams, including:</p>
<ul>
<li><a href="http://www.bottlecaps.de/rr/ui" target="_blank">Railroad Diagram Generator</a></li>
<li><a href="https://github.com/tabatkins/railroad-diagrams" target="_blank">Railroad Diagrams</a></li>
<li><a href="https://lukaslueg.github.io/macro_railroad_wasm_demo/" target="_blank">Macro Railroad</a></li>
<li><a href="https://karmin.ch/ebnf/index#download_and_install" target="_blank">EBNFParser &amp; Syntax Diagram Reader</a></li>
</ul>


<h1 class="relative group">Implementing <code>parse</code> 
    <div id="implementing-parse" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#implementing-parse" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>Using a grammar and <code>Scanner</code>, the <code>parse</code> function can be implemented with the following procedure:</p>
<ol>
<li>Find the topmost production rule <code>R</code>.</li>
<li>Create a function named for <code>R</code> that uses a <code>Scanner</code> to parse the remainder of the string according to <code>R</code>.</li>
<li>Use loops, quantifiers, and conditional branches as required by <code>R</code>.</li>
<li>If you encounter a production rule without an implementation, create a function body for it and invoke it.</li>
<li>Continue until all production rules have been implemented.</li>
</ol>


<h1 class="relative group">Example: JSON 
    <div id="example-json" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#example-json" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>Consider writing a simple JSON parser. If the input string is valid, it returns an array containing the input characters. Otherwise an error is thrown. Whitespace is not allowed.</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="/images/posts/20190122/object.gif" alt="JSON Object" />
      <figcaption>JSON Object</figcaption>
    </figure>
</p>
<p>The topmost production rule given for JSON is &ldquo;object.&rdquo; Following Step (1), we begin by creating an empty function body called <code>parseObject</code> and invoke it from <code>parse</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">parse</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">string</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">scanner</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Scanner</span>(<span style="color:#a6e22e">string</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> [ ];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">parseObject</span>(<span style="color:#a6e22e">scanner</span>, <span style="color:#a6e22e">result</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> Error(<span style="color:#e6db74">`invalid character at </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">cursor</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">parseObject</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">scanner</span>) =&gt; { }; <span style="color:#75715e">// TODO
</span></span></span></code></pre></div><p>Following Step (3), we implement <code>parseObject</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">parseObject</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">scanner</span>, <span style="color:#a6e22e">characters</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">peek</span>() <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;{&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">characters</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">pop</span>());
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">parseKeyValue</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">parseString</span>(<span style="color:#a6e22e">scanner</span>, <span style="color:#a6e22e">characters</span>)) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">peek</span>() <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;:&#39;</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">characters</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">pop</span>());
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">throw</span> Error(<span style="color:#e6db74">`expected : at </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">cursor</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">parseValue</span>(<span style="color:#a6e22e">scanner</span>, <span style="color:#a6e22e">characters</span>)) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">throw</span> Error(<span style="color:#e6db74">`expected value at </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">cursor</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">parseKeyValue</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">peek</span>() <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;,&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">characters</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">pop</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">parseKeyValue</span>();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">peek</span>() <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;}&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">characters</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">pop</span>());
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> Error(<span style="color:#e6db74">`expected } at </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">cursor</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">parseString</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">scanner</span>, <span style="color:#a6e22e">characters</span>) =&gt; { }; <span style="color:#75715e">// TODO
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">parseValue</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">scanner</span>, <span style="color:#a6e22e">characters</span>) =&gt; { }; <span style="color:#75715e">// TODO
</span></span></span></code></pre></div><p>Several points are worth noting:</p>
<ul>
<li>The function <code>parseObject</code> mirrors the grammar it recognizes.</li>
<li>Each call to <code>peek</code> that returns an expected character is followed by a call to <code>pop</code> that consumes it.</li>
<li>If the first element of a production rule is detected, but any subsequent mandatory element is not, an error is thrown.</li>
<li>If the first element of a production rule is not found, <code>false</code> is returned.</li>
<li>The result object may be updated in the process of parsing a production rule.</li>
<li>We always know the current cursor position, so it&rsquo;s easy to include it in error messages.</li>
</ul>
<p>These same principles apply to the implementation of <code>parseString</code>, <code>parseValue</code>, and the remaining production rules.</p>
<p>In practice, an array of characters will be insufficient to represent the syntax of an input string. Use a representation that best fits the problem at hand.</p>
<p>Not all grammars will be compatible with the simple method outlined here. The trick is to configure the grammar to be compatible with the method. The name &ldquo;Scanner-Driven Parser Development&rdquo; reflects the fact that this method forces the grammar to be moulded around the parser, not the other way around.</p>


<h1 class="relative group">Supporting Regular Expressions 
    <div id="supporting-regular-expressions" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#supporting-regular-expressions" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>It will often be more convenient to consume characters, not one at a time, but as a group. <code>Scanner</code> can support this functionality by adding a new method, <code>scan</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">Scanner</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">class</span> {
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Returns the string match for `regex` starting
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * from the current cursor. Advances cursor if a
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * match is found. Returns `undefined` otherwise.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {RegExp} regex
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @return {string|undefined}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @throws {Error} given regex global flag not set
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">scan</span> (<span style="color:#a6e22e">regex</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">regex</span>.<span style="color:#a6e22e">global</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">throw</span> Error(<span style="color:#e6db74">&#39;regex global flag must be set&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">regex</span>.<span style="color:#a6e22e">lastIndex</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_cursor</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">match</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">regex</span>.<span style="color:#a6e22e">exec</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_string</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">match</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">match</span>.<span style="color:#a6e22e">index</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_cursor</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">undefined</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_cursor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">regex</span>.<span style="color:#a6e22e">lastIndex</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">match</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};
</span></span></code></pre></div><p>The <code>global</code> flag must be set for regular expressions passed to <code>scan</code>. The reason has to do with <a href="http://2ality.com/2013/08/regexp-g.html" target="_blank">how JavaScript treats the <code>lastIndex</code> property</a>.</p>
<p>This new version allows text to be matched by pattern:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">scanner</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Scanner</span>(<span style="color:#e6db74">&#39;hello, world&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/h[aeiou]/g</span>); <span style="color:#75715e">// =&gt; &#39;he&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/llo/g</span>);      <span style="color:#75715e">// =&gt; &#39;llo&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">match</span><span style="color:#f92672">/</span>[<span style="color:#a6e22e">a</span><span style="color:#f92672">-</span><span style="color:#a6e22e">z</span>]<span style="color:#f92672">/</span><span style="color:#a6e22e">g</span>);     <span style="color:#75715e">// =&gt; undefined
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">match</span><span style="color:#f92672">/</span>[<span style="color:#f92672">^</span><span style="color:#a6e22e">a</span><span style="color:#f92672">-</span><span style="color:#a6e22e">z</span>]<span style="color:#f92672">/</span><span style="color:#a6e22e">g</span>);    <span style="color:#75715e">// =&gt; &#39;,&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/\s+/g</span>);      <span style="color:#75715e">// =&gt; &#39; &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/world/g</span>);    <span style="color:#75715e">// =&gt; &#39;world&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">peek</span>();             <span style="color:#75715e">// =&gt; &#39;&#39;
</span></span></span></code></pre></div><p>The same functionality is available through <code>peek</code> and <code>pop</code>, but <code>scan</code> collapses what would otherwise require multiple operations into one.</p>


<h1 class="relative group">Theory 
    <div id="theory" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#theory" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>Grammars can be classified in a number of ways. The major axis separates context-free grammars (CFGs) from everything else. A CFG consists of a set of production rules with <a href="https://softwareengineering.stackexchange.com/q/253454" target="_blank">single nonterminals on their left-hand sides</a>. A <em>terminal</em> is a character from the grammar&rsquo;s alphabet, and as such contains no productions. A <em>nonterminal</em> is a pattern composed of <em>terminals</em> and <em>non-terminals</em>.</p>
<p>CFGs are in turn classified along three axes:</p>
<ol>
<li>whether they are read left-to-right or right-to-left;</li>
<li>whether they are left-associative or right-associative; and</li>
<li>the maximum number of lookahead characters that are required.</li>
</ol>
<p>A shorthand notion for CFGs is used in which the first character (L or R) denotes the read direction, the second character denotes the direction of <a href="https://en.wikipedia.org/wiki/Operator_associativity" target="_blank">operator associativity</a> (L or R), and the last character represents the number of lookahead characters (which may be in parentheses). For example, JSON is an example of an LL(1) grammar. Similarly, any LL(1) grammar can be parsed using a Scanner-driven approach.</p>
<p>Although the examples here don&rsquo;t make use of it, CFG nonterminals can be <em>recursive</em>. That is, a production rule can refer to itself. However, to avoid infinite recursion, the self-reference may not be the leftmost element. Should a grammar exhibit left-recursion, it can often be removed through a process called &ldquo;refactoring.&rdquo;</p>
<!-- raw HTML omitted -->
<p>In some cases, the simple error reporting method used in this article&rsquo;s examples won&rsquo;t be enough. For example, it might be important to parse the entire string, reporting <em>all</em> errors found, rather than aborting at the first one. If so, then &ldquo;Panic Mode&rdquo; error recovery may be worth supporting. In Panic Mode, the parser will either log an error and simply continue, or backtrack to a known synchronization point.</p>
<p>For an excellent practical introduction to parsers with a helpful dash of theory, see <a href="http://www.craftinginterpreters.com/parsing-expressions.html" target="_blank">Crafting Interpreters</a>.</p>


<h1 class="relative group">Parser Generators 
    <div id="parser-generators" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#parser-generators" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>The systematic way in which an LL(1) parser can be written raises the obvious question of automation. Can software write the parser for us? The answer is &ldquo;yes!&rdquo;</p>
<p><a href="https://en.wikipedia.org/wiki/Comparison_of_parser_generators" target="_blank">Parser Generators</a> accept as input a grammar which can often be defined in some variant of BNF, and returns a program that will parse strings using the grammar. Some examples of JavaScript-based parser generators include:</p>
<ul>
<li><a href="https://pegjs.org" target="_blank">PEG.js</a></li>
<li><a href="https://nearley.js.org" target="_blank">Nearly</a></li>
<li><a href="http://zaa.ch/jison/" target="_blank">Jison</a></li>
</ul>
<p>Parser generators can be used with good results, but they also come with <a href="https://mortoray.com/2012/07/20/why-i-dont-use-a-parser-generator/" target="_blank">sometimes hidden costs</a>:</p>
<ul>
<li>they output source code, which must be treated differently than a project&rsquo;s other source code;</li>
<li>they can produce stack traces that make debugging a challenge; and</li>
<li>they vary greatly in their support for generating custom representations of the string being parsed.</li>
</ul>
<p>These drawbacks may not matter in your project. Regardless, you&rsquo;ll be better positioned to use a parser generator if you first take the time to practice a few hand-crafted parsers using Scanner-Driven Development.</p>
<p>A variation on the parser generator theme is <a href="https://github.com/dmaevsky/rd-parse" target="_blank">rd-parse</a>. Rather than producing source code, this library allows production rules to be defined in JavaScript. Debugging and producing a syntax representation with rd-parse can nevertheless be challenging.</p>


<h1 class="relative group">Conclusions 
    <div id="conclusions" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#conclusions" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>Parsers developed with a <code>Scanner</code> end up resembling their underlying grammar, making them easier to write, understand, and maintain than parsers written with alternative approaches. Provided that the language to be parsed can be represented in LL(1) form, Scanner-Driven Parser Development leads to running code quickly while avoiding unnecessary detours into theory.</p>

          
          
          
        </div>
        
        

        
        

          
      </div>
     
      
      
        
        
          
          
        
      <script>
        var oid = "views_posts\/2019-01-22-scanner-driven-parser-development.md"
        var oid_likes = "likes_posts\/2019-01-22-scanner-driven-parser-development.md"
      </script>
      
      
      <script type="text/javascript" src="/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js" integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q&#43;oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script>
      
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/articles/2019/01/17/debugging-es-modules-in-node.js-and-mocha-using-vs-code/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Debugging ES Modules in Node.js and Mocha Using VS Code</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2019-01-17T18:30:00&#43;00:00">January 17, 2019</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/articles/2019/01/28/the-nextmove-patent-reaction-dataset/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >The NextMove Patent Reaction Dataset</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2019-01-28T14:30:00&#43;00:00">January 28, 2019</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top" title="Scroll to top">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      &copy;
      2024
      
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js" integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="http://localhost:1313/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
