<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Fast Substructure Search Using Open Source Tools Part 4 - Creating Fingerprints from Chemical Structures | My New Hugo Site</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="The previous articles in this series have detailed the steps needed to build a working fingerprint screening system using nothing more than the open source tools MySQL, Ruby, and ActiveRecord. With this system we can create, read, update, and destroy fingerprints in persistent storage. Although the system meets all of the requirements of a fingerprint screening system, it isn&rsquo;t a substructure search system - yet. For that, we need a way to convert chemical structure representations into fingerprints. This article describes a very simple method for doing so.">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/posts/2008-10-15-fast-substructure-search-using-open-source-tools-part-4-creating-fingerprints-from-chemical-structures/">
    

    <meta property="og:url" content="http://localhost:1313/posts/2008-10-15-fast-substructure-search-using-open-source-tools-part-4-creating-fingerprints-from-chemical-structures/">
  <meta property="og:site_name" content="My New Hugo Site">
  <meta property="og:title" content="Fast Substructure Search Using Open Source Tools Part 4 - Creating Fingerprints from Chemical Structures">
  <meta property="og:description" content="The previous articles in this series have detailed the steps needed to build a working fingerprint screening system using nothing more than the open source tools MySQL, Ruby, and ActiveRecord. With this system we can create, read, update, and destroy fingerprints in persistent storage. Although the system meets all of the requirements of a fingerprint screening system, it isn’t a substructure search system - yet. For that, we need a way to convert chemical structure representations into fingerprints. This article describes a very simple method for doing so.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2008-10-15T00:00:00+00:00">
    <meta property="article:modified_time" content="2008-10-15T00:00:00+00:00">

  <meta itemprop="name" content="Fast Substructure Search Using Open Source Tools Part 4 - Creating Fingerprints from Chemical Structures">
  <meta itemprop="description" content="The previous articles in this series have detailed the steps needed to build a working fingerprint screening system using nothing more than the open source tools MySQL, Ruby, and ActiveRecord. With this system we can create, read, update, and destroy fingerprints in persistent storage. Although the system meets all of the requirements of a fingerprint screening system, it isn’t a substructure search system - yet. For that, we need a way to convert chemical structure representations into fingerprints. This article describes a very simple method for doing so.">
  <meta itemprop="datePublished" content="2008-10-15T00:00:00+00:00">
  <meta itemprop="dateModified" content="2008-10-15T00:00:00+00:00">
  <meta itemprop="wordCount" content="567">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Fast Substructure Search Using Open Source Tools Part 4 - Creating Fingerprints from Chemical Structures">
  <meta name="twitter:description" content="The previous articles in this series have detailed the steps needed to build a working fingerprint screening system using nothing more than the open source tools MySQL, Ruby, and ActiveRecord. With this system we can create, read, update, and destroy fingerprints in persistent storage. Although the system meets all of the requirements of a fingerprint screening system, it isn’t a substructure search system - yet. For that, we need a way to convert chemical structure representations into fingerprints. This article describes a very simple method for doing so.">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        My New Hugo Site
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Fast Substructure Search Using Open Source Tools Part 4 - Creating Fingerprints from Chemical Structures</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2008-10-15T00:00:00Z">October 15, 2008</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>The previous articles in this series have detailed the steps needed to build a working fingerprint screening system using nothing more than the open source tools <a href="http://www.mysql.com/">MySQL</a>, <a href="http://ruby-lang.org">Ruby</a>, and <a href="http://ar.rubyonrails.org/">ActiveRecord</a>. With this system we can create, read, update, and destroy fingerprints in persistent storage. Although the system meets all of the requirements of a fingerprint screening system, it isn&rsquo;t a substructure search system - yet. For that, we need a way to convert chemical structure representations into fingerprints. This article describes a very simple method for doing so.</p>
<p>All Articles in this Series:</p>
<ul>
<li><a href="/articles/2008/10/02/fast-substructure-search-using-open-source-tools-part-1-fingerprints-and-databases">Part 1: Fingerprints and Databases</a></li>
<li><a href="/articles/2008/10/03/fast-substructure-search-using-open-source-tools-part-2-fingerprint-screen-with-sql">Part 2: Fingerprint Screen With SQL</a></li>
<li><a href="/articles/2008/10/06/fast-substructure-search-using-open-source-tools-part-3-a-crud-api-for-fingerprints-in-ruby">Part 3: A CRUD API for Fingerprints in Ruby</a></li>
<li>Part 4: Creating Fingerprints from Chemical Structures</li>
<li><a href="/articles/2008/10/21/fast-substructure-search-using-open-source-tools-part-5-relating-molecules-to-fingerprints-with-sql">Part 5: Relating Molecules to Fingerprints with SQL</a></li>
<li><a href="/articles/2008/10/29/fast-substructure-search-using-open-source-tools-part-6-modelling-a-one-to-many-relationship-between-fingerprints-and-compounds-in-ruby">Part 6: Modelling a One-To-Many Relationship Between Fingerprints and Compounds in Ruby</a></li>
</ul>
<h1 id="a-ruby-fingerprinter-in-eight-lines">A Ruby Fingerprinter in Eight Lines</h1>
<p>Let&rsquo;s create a <code>Fingerprinter</code> class that&rsquo;s capable of converting a SMILES string into a <code>Fingerprint</code> that can be stored and queried. The Ruby code below makes use of Open Babel&rsquo;s <a href="http://openbabel.org/wiki/Babel"><code>babel</code></a> command-line utility:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;fingerprint&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Fingerprinter</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fingerprint_smiles</span> smiles
</span></span><span style="display:flex;"><span>    raw <span style="color:#f92672">=</span> <span style="color:#e6db74">%x[echo &#39;</span><span style="color:#e6db74">#{</span>smiles<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; | babel -ismi -ofpt 2&gt;;/dev/null]</span>
</span></span><span style="display:flex;"><span>    bytes <span style="color:#f92672">=</span> raw<span style="color:#f92672">.</span>gsub(<span style="color:#e6db74">/&gt;;.*?\n/</span>, <span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>gsub(<span style="color:#e6db74">/\n/</span>, <span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>split
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Fingerprint</span><span style="color:#f92672">.</span>new<span style="color:#f92672">.</span>fill_bytes{<span style="color:#f92672">|</span>i<span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">#{</span>bytes<span style="color:#f92672">[</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>i<span style="color:#f92672">]</span><span style="color:#e6db74">}#{</span>bytes<span style="color:#f92672">[</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span><span style="color:#f92672">]</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>hex}
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>This class takes advantage of Ruby&rsquo;s ability to interface directly with the command line through the <code>%x</code> operator in a way similar to that previously described for the <!-- raw HTML omitted -->cInChI command line tool<!-- raw HTML omitted -->. The <code>babel</code> output is then converted into a form suitable for use with our <!-- raw HTML omitted -->previously-defined<!-- raw HTML omitted --> <code>Fingerprint</code> class.</p>
<p>Although quite easy to implement, this approach may not work in every situation. For example, the <code>fingerprint_smiles</code> method opens the possibility that a malicious user could attempt to execute arbitrary shell commands by creating a mis-formed SMILES string. Windows users may need to adapt the code. But for trusted SMILES on Unix machines, this implementation works well and can be used in many different programming environments.</p>
<h1 id="testing-the-fingerprinter">Testing the Fingerprinter</h1>
<p>We can test the Fingerprinter through interactive Ruby (irb):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>irb
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:001:0&gt;; require <span style="color:#e6db74">&#39;lib/fingerprinter&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt;; true
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:002:0&gt;; fp<span style="color:#f92672">=</span>Fingerprinter.new
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt;; <span style="color:#75715e">#&amp;lt;Fingerprinter:0xb7498038&gt;;</span>
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:003:0&gt;; f<span style="color:#f92672">=</span>fp.fingerprint_smiles <span style="color:#e6db74">&#39;c1ccccc1&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt;; <span style="color:#75715e">#&amp;lt;Fingerprint id: nil, byte0: 0, byte1: 512, byte2: 0, byte3: 0, byte4: 2112, byte5: 32768, byte6: 0, byte7: 0, byte8: 0, byte9: 0, byte10: 134217728, byte11: 0, byte12: 0, byte13: 0, byte14: 131072, byte15: 0, hex: nil&gt;;</span>
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:004:0&gt;; f.cardinality
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt;; <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:005:0&gt;; f.bitstring
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt;; <span style="color:#e6db74">&#34;0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000100000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000&#34;</span>
</span></span></code></pre></div><p>As we previously saw, any <code>Fingerprint</code> we create can be stored and later retrieved from a MySQL database. If we&rsquo;ve already stored the fingerprint for benzene it can be found with the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>irb
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:001:0&gt;; require <span style="color:#e6db74">&#39;lib/fingerprinter&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt;; true
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:002:0&gt;; fp<span style="color:#f92672">=</span>Fingerprinter.new
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt;; <span style="color:#75715e">#&amp;lt;Fingerprinter:0xb74ae284&gt;;</span>
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:003:0&gt;; f<span style="color:#f92672">=</span>fp.fingerprint_smiles <span style="color:#e6db74">&#39;c1ccccc1&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt;; <span style="color:#75715e">#&amp;lt;Fingerprint id: nil, byte0: 0, byte1: 512, byte2: 0, byte3: 0, byte4: 2112, byte5: 32768, byte6: 0, byte7: 0, byte8: 0, byte9: 0, byte10: 134217728, byte11: 0, byte12: 0, byte13: 0, byte14: 131072, byte15: 0, hex: nil&gt;;</span>
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:004:0&gt;; Fingerprint.find_by_fingerprint f
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt;; <span style="color:#75715e">#&amp;lt;Fingerprint id: 12687, byte0: 0, byte1: 512, byte2: 0, byte3: 0, byte4: 2112, byte5: 32768, byte6: 0, byte7: 0, byte8: 0, byte9: 0, byte10: 134217728, byte11: 0, byte12: 0, byte13: 0, byte14: 131072, byte15: 0, hex: &#34;000000000000000000000000000002000000000000000000000...&#34;&gt;;</span>
</span></span></code></pre></div><h1 id="conclusions">Conclusions</h1>
<p>We now have the ability to create, store, and query fingerprints created from arbitrary SMILES strings. If there were a 1:1 relationship between molecules and fingerprints, we&rsquo;d be nearly done. But things are not quite that simple. The next article in this series will show how to relate molecules to fingerprints.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  My New Hugo Site 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
