<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Compiling Open Babel to Pure Java Bytecode with NestedVM - An Unsuccessful First Attempt | My New Hugo Site</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Wouldn&rsquo;t it be great to be able to compile code written in languages like FORTRAN, C, and C&#43;&#43; to Java bytecode? NestedVM - almost magically - can do just that. This article documents a failed first attempt to compile the popular cheminformatics toolkit Open Babel, which is written in C and C&#43;&#43;, to pure Java bytecode with NestedVM.
A previous article described the successful compilation of the InChI toolkit, a C library, to a platform-independent executable jarfile.">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/posts/2007-11-19-compiling-open-babel-to-pure-java-bytecode-with-nestedvm-an-unsuccessful-first-attempt/">
    

    <meta property="og:url" content="http://localhost:1313/posts/2007-11-19-compiling-open-babel-to-pure-java-bytecode-with-nestedvm-an-unsuccessful-first-attempt/">
  <meta property="og:site_name" content="My New Hugo Site">
  <meta property="og:title" content="Compiling Open Babel to Pure Java Bytecode with NestedVM - An Unsuccessful First Attempt">
  <meta property="og:description" content="Wouldn’t it be great to be able to compile code written in languages like FORTRAN, C, and C&#43;&#43; to Java bytecode? NestedVM - almost magically - can do just that. This article documents a failed first attempt to compile the popular cheminformatics toolkit Open Babel, which is written in C and C&#43;&#43;, to pure Java bytecode with NestedVM.
A previous article described the successful compilation of the InChI toolkit, a C library, to a platform-independent executable jarfile.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2007-11-19T00:00:00+00:00">
    <meta property="article:modified_time" content="2007-11-19T00:00:00+00:00">

  <meta itemprop="name" content="Compiling Open Babel to Pure Java Bytecode with NestedVM - An Unsuccessful First Attempt">
  <meta itemprop="description" content="Wouldn’t it be great to be able to compile code written in languages like FORTRAN, C, and C&#43;&#43; to Java bytecode? NestedVM - almost magically - can do just that. This article documents a failed first attempt to compile the popular cheminformatics toolkit Open Babel, which is written in C and C&#43;&#43;, to pure Java bytecode with NestedVM.
A previous article described the successful compilation of the InChI toolkit, a C library, to a platform-independent executable jarfile.">
  <meta itemprop="datePublished" content="2007-11-19T00:00:00+00:00">
  <meta itemprop="dateModified" content="2007-11-19T00:00:00+00:00">
  <meta itemprop="wordCount" content="786">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Compiling Open Babel to Pure Java Bytecode with NestedVM - An Unsuccessful First Attempt">
  <meta name="twitter:description" content="Wouldn’t it be great to be able to compile code written in languages like FORTRAN, C, and C&#43;&#43; to Java bytecode? NestedVM - almost magically - can do just that. This article documents a failed first attempt to compile the popular cheminformatics toolkit Open Babel, which is written in C and C&#43;&#43;, to pure Java bytecode with NestedVM.
A previous article described the successful compilation of the InChI toolkit, a C library, to a platform-independent executable jarfile.">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        My New Hugo Site
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Compiling Open Babel to Pure Java Bytecode with NestedVM - An Unsuccessful First Attempt</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2007-11-19T00:00:00Z">November 19, 2007</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>Wouldn&rsquo;t it be great to be able to compile code written in languages like FORTRAN, C, and C++ to Java bytecode? <a href="http://nestedvm.ibex.org/">NestedVM</a> - almost magically - can do just that. This article documents a failed first attempt to compile the popular cheminformatics toolkit <a href="http://openbabel.sf.net">Open Babel</a>, which is written in C and C++, to pure Java bytecode with NestedVM.</p>
<p>A previous article described the <a href="/articles/2007/10/31/jinchi-run-inchi-anywhere-java-runs">successful compilation of the InChI toolkit</a>, a C library, to a platform-independent executable jarfile.</p>
<h1 id="the-problem">The Problem</h1>
<p><a href="http://openbabel.sf.net">Open Babel</a> is one of cheminformatics&rsquo; most <a href="http://sourceforge.net/project/stats/?group_id=40728&amp;ugn=openbabel">widely-used</a> open source packages. It interconverts dozens of molecular languages, performs a host of cheminformatics analyses, and serves as a platform for many programs and Web services.</p>
<p>As useful as Open Babel is, it doesn&rsquo;t run directly on a Java Virtual Machine (JVM). Although an <a href="http://openbabel.sourceforge.net/wiki/Java">Open Babel JNI</a> interface does exist, using it introduces a platform dependency, which in many cases is not acceptable. JNI is a great solution in some cases, but when maintaining a single version of a program is important, or when applets need to be used, or when code needs to work with unusual system configurations, it&rsquo;s a poor choice.</p>
<p>Our goal is to compile Open Babel&rsquo;s &ldquo;babel&rdquo; command-line utility into pure Java bytecode that can be run on any recent JVM without using JNI.</p>
<h1 id="overview-of-nestedvm">Overview of NestedVM</h1>
<p>In a nutshell, NestedVM converts MIPS binaries to Java class files. In theory, this allows software written in any language that can be compiled to a MIPS binary to be run on a JVM.</p>
<p>To do this, NestedVM distributes two categories of tools: (1) a complete MIPS cross-compiler toolchain; and (2) a MIPS binary to Java bytecode compiler and accessories.</p>
<h1 id="building-nestedvm">Building NestedVM</h1>
<p>The preferred method to install NestedVM is to compile it from source found in the project repository. There are a number of prerequisites your system must meet in order to be able to do so. For now, this article assumes your system has all of them. Some of the following steps can be found in <a href="http://wiki.brianweb.net/NestedVM/QuickStartGuide">these instructions</a> as well.</p>
<p>To obtain the source code from the NestedVM darcs repository:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>darcs get --repo-name<span style="color:#f92672">=</span>nestedvm http://nestedvm.ibex.org
</span></span></code></pre></div><p>Then change into the <strong>nestedvm</strong> directory and build the main code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd nestedvm
</span></span><span style="display:flex;"><span>make
</span></span></code></pre></div><p>On my machine, this step takes 10-15 minutes.</p>
<p>To make sure your build works, run the tests:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make test
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>1.574000e+00
</span></span><span style="display:flex;"><span>-4.315000e+01l
</span></span><span style="display:flex;"><span>-43
</span></span><span style="display:flex;"><span>-4.315000e+01
</span></span><span style="display:flex;"><span>4.315000e+01
</span></span><span style="display:flex;"><span>Hello, World
</span></span><span style="display:flex;"><span>7F
</span></span><span style="display:flex;"><span>fabs<span style="color:#f92672">(</span>-2.24<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> 2.34
</span></span><span style="display:flex;"><span>Destructor!
</span></span></code></pre></div><p>NestedVM doesn&rsquo;t build the g++ compiler by default - it&rsquo;s something that needs to be done manually. Fortunately, it&rsquo;s not difficult to do:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make cxxtest
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>java -cp build tests.CXXTest
</span></span><span style="display:flex;"><span>Test<span style="color:#e6db74">&#39;s constructor
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Name: 0x50b40
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Name: PKc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Is pointer: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Name: 0x50b3c
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Name: i
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Is pointer: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Hello, World from Test
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Now throwing an exception
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sayhi threw: const char *:Hello, Exception Handling!
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Test&#39;</span>s destructor
</span></span></code></pre></div><p>Finally, with all tools built, we need to set up our environment:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make env.sh
</span></span><span style="display:flex;"><span>source env.sh
</span></span></code></pre></div><p>We&rsquo;re now ready to cross-compile Open Babel.</p>
<h1 id="cross-compiling-open-babel">Cross-Compiling Open Babel</h1>
<p>For this tutorial, we&rsquo;ll use the <a href="http://sourceforge.net/project/showfiles.php?group_id=40728&amp;package_id=32894&amp;release_id=521581">Open Babel 2.1.1</a> source distribution. Unpack the tarball and change into the directory.</p>
<p>Next, we&rsquo;ll need to set up our cross-compiler environment. Fortunately, NestedVM has made this easy. If you check your environment variables, you&rsquo;ll find that <code>CXX</code> and <code>CC</code> have both been set. All that remains is to notify the configure script that we&rsquo;ll be cross-compiling:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./configure --host<span style="color:#f92672">=</span>mips-unknown-elf
</span></span></code></pre></div><p>Then we build the MIPS binaries:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make
</span></span></code></pre></div><p>Peeking into the <code>tools</code> directory, we can see all of the Open Babel command line tools have been built, including <code>babel</code>.</p>
<p>Unless you&rsquo;re running a MIPS machine, though, this binary won&rsquo;t be executable.</p>
<p>So far, it looks like everything worked. Although it didn&rsquo;t work the first time I tried it, the NestedVM team <a href="http://groups.google.com/group/nestedvm/browse_thread/thread/7373accf6010d6d7">were most helpful</a>.</p>
<h1 id="building-the-java-class-file">Building the Java Class File</h1>
<p>We&rsquo;re now ready for the final stage in the process, converting the MIPS binary to a Java class file. Again, NestedVM makes this simple:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd tools
</span></span><span style="display:flex;"><span>java org.ibex.nestedvm.Compiler -outfile Babel.class Babel babel
</span></span><span style="display:flex;"><span>Exception in thread <span style="color:#e6db74">&#34;main&#34;</span> java.lang.IllegalStateException: unresolved phantom target
</span></span><span style="display:flex;"><span>        at org.ibex.classgen.MethodGen.resolveTarget<span style="color:#f92672">(</span>MethodGen.java:555<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at org.ibex.classgen.MethodGen._generateCode<span style="color:#f92672">(</span>MethodGen.java:664<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at org.ibex.classgen.MethodGen.generateCode<span style="color:#f92672">(</span>MethodGen.java:618<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at org.ibex.classgen.MethodGen.dump<span style="color:#f92672">(</span>MethodGen.java:888<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at org.ibex.classgen.ClassFile._dump<span style="color:#f92672">(</span>ClassFile.java:193<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at org.ibex.classgen.ClassFile.dump<span style="color:#f92672">(</span>ClassFile.java:160<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at org.ibex.nestedvm.ClassFileCompiler.__go<span style="color:#f92672">(</span>ClassFileCompiler.java:380<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at org.ibex.nestedvm.ClassFileCompiler._go<span style="color:#f92672">(</span>ClassFileCompiler.java:72<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        at org.ibex.nestedvm.Compiler.go<span style="color:#f92672">(</span>Compiler.java:259<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Unfortunately, NestedVM has blown up with an exception. Although our target class file, <strong>Babel.class</strong> is now in our working directory, it is not complete and won&rsquo;t run.</p>
<h1 id="what-went-wrong">What Went Wrong?</h1>
<p>After bringing this problem to the <a href="http://groups.google.com/group/nestedvm">NestedVM mailing list</a>, it appears that this is a <a href="http://groups.google.com/group/nestedvm/browse_thread/thread/b5d114a20a6b672b">NestedVM bug</a>.</p>
<p>However, the way <code>babel</code> works is to load its various language modules dynamically. It may be possible to fix the problem by producing a version of <code>babel</code> containing all of its modules in a single binary.</p>
<p>Although there is a major issue to be resolved, this tutorial illustrates the full process of compiling C++ code to Java bytecode using NestedVM.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  My New Hugo Site 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
