<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>TUCAN Canonicalization | My New Hugo Site</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Conceptualizing the selection of a canonical string with TUCAN.">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/posts/2022-04-20-tucan-canonicalization/">
    

    <meta property="og:url" content="http://localhost:1313/posts/2022-04-20-tucan-canonicalization/">
  <meta property="og:site_name" content="My New Hugo Site">
  <meta property="og:title" content="TUCAN Canonicalization">
  <meta property="og:description" content="Conceptualizing the selection of a canonical string with TUCAN.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-04-20T17:00:00+00:00">
    <meta property="article:modified_time" content="2022-04-20T17:00:00+00:00">

  <meta itemprop="name" content="TUCAN Canonicalization">
  <meta itemprop="description" content="Conceptualizing the selection of a canonical string with TUCAN.">
  <meta itemprop="datePublished" content="2022-04-20T17:00:00+00:00">
  <meta itemprop="dateModified" content="2022-04-20T17:00:00+00:00">
  <meta itemprop="wordCount" content="1508">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="TUCAN Canonicalization">
  <meta name="twitter:description" content="Conceptualizing the selection of a canonical string with TUCAN.">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        My New Hugo Site
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">TUCAN Canonicalization</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2022-04-20T17:00:00Z">April 20, 2022</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p><em>Note: This article requires revisions on one or more important points. In particular, the algorithm does not in its current form enumerate every candidate indexing as claimed. See <a href="/articles/2022/05/04/tucan-canonicalization-revisited/">the revised article</a> for details.</em></p>
<p>Molecular identifiers (or &ldquo;chemical names&rdquo;) are everywhere in chemistry. A <a href="/articles/2022/04/06/molecular-identification-with-tucan/">recent post</a> discussed a new kind of molecular identifier called <a href="https://doi.org/10.21203/rs.3.rs-1466562/v1">TUCAN</a>. Serialization was discussed there in some detail, but canonicalization was only outlined. This post picks up where the previous one left off. But rather than discuss the published canonicalization algorithm, this post starts from first principals with a simple, if naive, approach that should work for any molecular graph.</p>
<h1 id="canonicalization-overview">Canonicalization Overview</h1>
<p>Graph canonicalization has been covered at length in a <a href="https://doi.org/10.1002/9783527618279.ch7a">review by Ivanciuc</a>. More recently, I <a href="/articles/2021/10/06/molecular-graph-canonicalization/">summarized this review</a>. The following description contains elements of both works.</p>
<p>The <a href="/articles/2022/04/06/molecular-identification-with-tucan/">serialization rules</a> for TUCAN covered in the previous post enable every TUCAN graph to be represented as a string (aka &ldquo;code&rdquo;). Without any other constraints, however, a TUCAN string generally varies depending on atom indexing. This conflicts with the goal of molecular naming, which requires a string that&rsquo;s invariant with respect to indexing. Such a string is the &ldquo;canonical&rdquo; form.</p>
<p>Using TUCAN as a molecular identifier requires both a definition of the canonical form, and the specification of an algorithm to obtain it. A simple approach is to define the lexicographically smallest (or largest) TUCAN string as the canonical form. To obtain it, we simply iterate over all possible strings for a given molecular graph.</p>
<p>Ivanciuc refers to this brute force enumeration step as <em>canonical code generation by automorphism permutation</em> (CCAP). Generally speaking, if a molecular graph has <em>n</em> atoms there are <em>n</em>! possible permutations, each producing its own string candidate. This extremely poor scalability has led to many innovative shortcuts over the last several decades.</p>
<p>All of the approaches to this problem involve <em>graph invariant atom partitioning</em> (GIAP). This step occurs prior to CCAP with the goal reducing the number of string permutations to consider. As hinted previously, an invariant is a property that&rsquo;s constant with respect to re-indexing. Examples include node degree (neighbor count) and atomic number. If successful, the GIAP step partitions a graph&rsquo;s nodes into two or more groups. This partitioning can improve the otherwise factorial scaling of the CCAP step. However, there are two kinds of limits to what GIAP can do. First, no partitioning scheme is perfect. Some constitutionally-distinguishable nodes will nevertheless fail to be partitioned. Second, symmetry imposes a theoretical limit on partitioning. Some groups will have multiple members regardless of the quality of the GIAP protocol.</p>
<p>To recap, canonicalization is a two-step process:</p>
<ol>
<li>GIAP, which partitions nodes according to graph invariant heuristics.</li>
<li>CCAP, which uses the partitions found by GIAP to reduces then number of enumerations that need to be considered. This ultimately leads to the canonical form.</li>
</ol>
<p>Ivanciuc notes several literature examples in which the subsequent CCAP enumeration step was erroneously thought to be unnecessary. Although molecular canonicalization is possible without GIAP, it is not reliable without a robust CCAP procedure.</p>
<p>The algorithm described here uses only the partitioning enforced by the TUCAN serialization rules. Its goal is to arrive a new atom indexing that can be written as the canonical TUCAN string. The overall approach is to consider the exhaustive, ordered, pairwise exchange of indexes.</p>
<h1 id="default-partitioning">Default Partitioning</h1>
<p>TUCAN uses an unusual serialization format in which atoms have already been subjected to a limited form of GIAP. To recap, atoms are partitioned by increasing atomic number. Hydrogen comes first, followed by helium, lithium, beryllium, and so on. A TUCAN string consists of a Hill formula followed by a sorted edge enumeration. Each edge within the enumeration is configured with
the lowest index appearing first. The result is a string that&rsquo;s already undergone a lot of useful processing. TUCAN strings can be read to re-generate the corresponding molecular graph.</p>
<!-- raw HTML omitted -->
<p>This is the starting point for the algorithm outline that follows. Although it should in principle be possible to apply additional GIAP partitioning heuristics, these will not be considered at this time. This should enable baseline performance metrics to be obtained which could then be used to develop better partitioning methods. Nevertheless, the CCAP enumeration described below will be necessary either way.</p>
<h1 id="the-swap-operation">The <code>swap</code> Operation</h1>
<p>The core of the algorithm is a procedure called <code>swap</code>. <code>swap</code> exchanges an atomic index with another found in the same atomic number group. Source and target indexes of all edges are simultaneously updated to reflect the change. <code>swap</code> is invariant in the sense that the corresponding graphs before and after <code>swap</code> are constitutionally identical.</p>
<p>To visualize <code>swap</code> operations, I&rsquo;ve developed a graphical representation. Atomic indexes are arranged horizontally with one appearing on the left and the maximum index appearing on the right. Bonds, represented as curved arrows, are then directed from source to target. Although a TUCAN molecular graph is undirected, edges are written as if they were directed from low index to high. The diagram captures this property.</p>
<!-- raw HTML omitted -->
<p>Consider performing <code>swap</code> between two hydrogens in the methanol graph depicted above. Swapping constitutionally equivalent hydrogen atoms (e.g., 1 and 2) results in the same diagram and graph. However, swapping constitutionally distinct atoms (e.g., 3 and 4) leads to a change in the diagram and graph.</p>
<!-- raw HTML omitted -->
<p>In a sense, <code>swap</code> doesn&rsquo;t re-index atoms, which always appear in the same sorted order, so much as it rewrites bonds.</p>
<h1 id="approach">Approach</h1>
<p>Using <code>swap</code> as a building block, we can construct an algorithm for canonicalizing TUCAN representations:</p>
<ol>
<li>Consider each pair of atoms (<code>a</code> and <code>b</code>) within a group individually and in order of atomic index.</li>
<li>If the criteria described below are met for the pair, swap <code>a</code> and <code>b</code>.</li>
<li>Otherwise, continue to the next pair of atoms.</li>
<li>If no pairs are available, proceed to the next group having higher atomic number.</li>
<li>If no groups are available, exit.</li>
</ol>
<p>The criteria in Step (2) are:</p>
<ol>
<li>For all inbound edges of <code>a</code> and <code>b</code>, find the one with the greatest length. Does <code>swap</code> decrease the target index of the edge?</li>
<li>If no suitable edges of <code>a</code> or <code>b</code> are available, find the outbound edge of <code>a</code> with the greatest length. Does <code>swap</code> decrease the target index of the edge?</li>
</ol>
<p>A &ldquo;yes&rdquo; to either question, asked in sequence, causes the condition to pass, leading to subsequent execution of <code>swap</code>.</p>
<h1 id="example">Example</h1>
<p>Consider the problem of finding the canonical TUCAN string for acetone. Starting with Step (1), we consider Atoms 1 and 2 as a candidate pair. Atom 1 has one outbound edge, but after swap its target index does not decrease. The same holds for every pairing of Atom 1, so we continue to Atom 2.</p>
<!-- raw HTML omitted -->
<p>Atoms 2 and 3 are considered. Atom 2 has one outbound edge, (2, 9). Its target index would decrease after a swap (2, 8). The swap takes place and the new Atom 3 is considered.</p>
<!-- raw HTML omitted -->
<p>The swaps available to Atom 3 are considered, starting with Atom 4. Each atom has one outbound edge, but with the same target. Swapping can not change the target index, so the pair is rejected. A swap between Atoms 3 and 5 is then considered. Both have one outbound edge. The new Atom 3 would have a target of 8 rather than its current target of 9, so the swap is performed. The algorithm proceeds to the next index.</p>
<!-- raw HTML omitted -->
<p>Swapping Atoms 4 and 5 would lead to no change because both have a single edge pointing to the same target. The same applies to Atoms 4 and 6. Atom 5 is now considered.</p>
<p>As before, swapping Atoms 5 and 6 would lead to no change because both have a single outbound edge pointing to the same target. This concludes the examination of the hydrogen block. As per Step (4) of the algorithm, we continue to the next block containing carbon atoms. The first atom has index 7.</p>
<p>The possible swap between Atoms 7 and 8 is the first time that inbound edges must be considered. The inbound edge (1, 8) is the longest. Swapping atoms 7 and 8 would reduce the target index from 8 to 7. Therefore, the swap is performed. All of the edges involving either atom are reconstructed. Atom 8 is now examined.</p>
<!-- raw HTML omitted -->
<p>A swap between Atoms 8 and 9 is considered. The target index of the longest inbound edge (4, 9) would be reduced from 9 to 8. The swap is therefore performed. This concludes the swap candidates in the carbon block.</p>
<!-- raw HTML omitted -->
<p>The oxygen block contains a single member, Atom 10. We therefore continue to Step 5. Given that there are no further blocks to consider, the algorithm exists. The resulting indexes will now yield the canonical string for acetone, &ldquo;C3H6O/1-7/2-7/3-7/4-8/5-8/6-8/7-9/8-9/9-10&rdquo;.</p>
<h1 id="conclusion">Conclusion</h1>
<p>Molecular canonicalization can be thought of as proceeding in two phases: an initial partitioning step followed by a brute-force iteration. The TUCAN identifier is unique in that its serialization imposes an initial partitioning. This article outlined an iteration procedure with diagrams for visualizing the computation of a canonical TUCAN string starting from an uncanonicalized representation. Several opportunities exist for refining this procedure through better initial partitioning.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  My New Hugo Site 2024 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
